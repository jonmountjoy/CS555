%% Literate Haskell script intended for lhs2TeX.

\documentclass[10pt]{article}
%% ODER: format ==         = "\mathrel{==}"
%% ODER: format /=         = "\neq "
%
%
\makeatletter
\@ifundefined{lhs2tex.lhs2tex.sty.read}%
{\@namedef{lhs2tex.lhs2tex.sty.read}{}%
	\newcommand\SkipToFmtEnd{}%
	\newcommand\EndFmtInput{}%
	\long\def\SkipToFmtEnd#1\EndFmtInput{}%
}\SkipToFmtEnd

\newcommand\ReadOnlyOnce[1]{\@ifundefined{#1}{\@namedef{#1}{}}\SkipToFmtEnd}
\usepackage{amstext}
\usepackage{amssymb}
\usepackage{stmaryrd}
\DeclareFontFamily{OT1}{cmtex}{}
\DeclareFontShape{OT1}{cmtex}{m}{n}
{<5><6><7><8>cmtex8
	<9>cmtex9
	<10><10.95><12><14.4><17.28><20.74><24.88>cmtex10}{}
\DeclareFontShape{OT1}{cmtex}{m}{it}
{<-> ssub * cmtt/m/it}{}
\newcommand{\texfamily}{\fontfamily{cmtex}\selectfont}
\DeclareFontShape{OT1}{cmtt}{bx}{n}
{<5><6><7><8>cmtt8
	<9>cmbtt9
	<10><10.95><12><14.4><17.28><20.74><24.88>cmbtt10}{}
\DeclareFontShape{OT1}{cmtex}{bx}{n}
{<-> ssub * cmtt/bx/n}{}
\newcommand{\tex}[1]{\text{\texfamily#1}}	% NEU

\newcommand{\Sp}{\hskip.33334em\relax}


\newcommand{\Conid}[1]{\mathit{#1}}
\newcommand{\Varid}[1]{\mathit{#1}}
\newcommand{\anonymous}{\kern0.06em \vbox{\hrule\@width.5em}}
\newcommand{\plus}{\mathbin{+\!\!\!+}}
\newcommand{\bind}{\mathbin{>\!\!\!>\mkern-6.7mu=}}
\newcommand{\rbind}{\mathbin{=\mkern-6.7mu<\!\!\!<}}% suggested by Neil Mitchell
\newcommand{\sequ}{\mathbin{>\!\!\!>}}
\renewcommand{\leq}{\leqslant}
\renewcommand{\geq}{\geqslant}
\usepackage{polytable}

%mathindent has to be defined
\@ifundefined{mathindent}%
{\newdimen\mathindent\mathindent\leftmargini}%
{}%

\def\resethooks{%
	\global\let\SaveRestoreHook\empty
	\global\let\ColumnHook\empty}
\newcommand*{\savecolumns}[1][default]%
{\g@addto@macro\SaveRestoreHook{\savecolumns[#1]}}
\newcommand*{\restorecolumns}[1][default]%
{\g@addto@macro\SaveRestoreHook{\restorecolumns[#1]}}
\newcommand*{\aligncolumn}[2]%
{\g@addto@macro\ColumnHook{\column{#1}{#2}}}

\resethooks

\newcommand{\onelinecommentchars}{\quad-{}- }
\newcommand{\commentbeginchars}{\enskip\{-}
\newcommand{\commentendchars}{-\}\enskip}

\newcommand{\visiblecomments}{%
	\let\onelinecomment=\onelinecommentchars
	\let\commentbegin=\commentbeginchars
	\let\commentend=\commentendchars}

\newcommand{\invisiblecomments}{%
	\let\onelinecomment=\empty
	\let\commentbegin=\empty
	\let\commentend=\empty}

\visiblecomments

\newlength{\blanklineskip}
\setlength{\blanklineskip}{0.66084ex}

\newcommand{\hsindent}[1]{\quad}% default is fixed indentation
\let\hspre\empty
\let\hspost\empty
\newcommand{\NB}{\textbf{NB}}
\newcommand{\Todo}[1]{$\langle$\textbf{To do:}~#1$\rangle$}

\EndFmtInput
\makeatother
%
%
%
%
%
%
% This package provides two environments suitable to take the place
% of hscode, called "plainhscode" and "arrayhscode". 
%
% The plain environment surrounds each code block by vertical space,
% and it uses \abovedisplayskip and \belowdisplayskip to get spacing
% similar to formulas. Note that if these dimensions are changed,
% the spacing around displayed math formulas changes as well.
% All code is indented using \leftskip.
%
% Changed 19.08.2004 to reflect changes in colorcode. Should work with
% CodeGroup.sty.
%
\ReadOnlyOnce{polycode.fmt}%
\makeatletter

\newcommand{\hsnewpar}[1]%
{{\parskip=0pt\parindent=0pt\par\vskip #1\noindent}}

% can be used, for instance, to redefine the code size, by setting the
% command to \small or something alike
\newcommand{\hscodestyle}{}

% The command \sethscode can be used to switch the code formatting
% behaviour by mapping the hscode environment in the subst directive
% to a new LaTeX environment.

\newcommand{\sethscode}[1]%
{\expandafter\let\expandafter\hscode\csname #1\endcsname
	\expandafter\let\expandafter\endhscode\csname end#1\endcsname}

% "compatibility" mode restores the non-polycode.fmt layout.

\newenvironment{compathscode}%
{\par\noindent
	\advance\leftskip\mathindent
	\hscodestyle
	\let\\=\@normalcr
	\let\hspre\(\let\hspost\)%
	\pboxed}%
{\endpboxed\)%
	\par\noindent
	\ignorespacesafterend}

\newcommand{\compaths}{\sethscode{compathscode}}

% "plain" mode is the proposed default.
% It should now work with \centering.
% This required some changes. The old version
% is still available for reference as oldplainhscode.

\newenvironment{plainhscode}%
{\hsnewpar\abovedisplayskip
	\advance\leftskip\mathindent
	\hscodestyle
	\let\hspre\(\let\hspost\)%
	\pboxed}%
{\endpboxed%
	\hsnewpar\belowdisplayskip
	\ignorespacesafterend}

\newenvironment{oldplainhscode}%
{\hsnewpar\abovedisplayskip
	\advance\leftskip\mathindent
	\hscodestyle
	\let\\=\@normalcr
	\(\pboxed}%
{\endpboxed\)%
	\hsnewpar\belowdisplayskip
	\ignorespacesafterend}

% Here, we make plainhscode the default environment.

\newcommand{\plainhs}{\sethscode{plainhscode}}
\newcommand{\oldplainhs}{\sethscode{oldplainhscode}}
\plainhs

% The arrayhscode is like plain, but makes use of polytable's
% parray environment which disallows page breaks in code blocks.

\newenvironment{arrayhscode}%
{\hsnewpar\abovedisplayskip
	\advance\leftskip\mathindent
	\hscodestyle
	\let\\=\@normalcr
	\(\parray}%
{\endparray\)%
	\hsnewpar\belowdisplayskip
	\ignorespacesafterend}

\newcommand{\arrayhs}{\sethscode{arrayhscode}}

% The mathhscode environment also makes use of polytable's parray 
% environment. It is supposed to be used only inside math mode 
% (I used it to typeset the type rules in my thesis).

\newenvironment{mathhscode}%
{\parray}{\endparray}

\newcommand{\mathhs}{\sethscode{mathhscode}}

% texths is similar to mathhs, but works in text mode.

\newenvironment{texthscode}%
{\(\parray}{\endparray\)}

\newcommand{\texths}{\sethscode{texthscode}}

% The framed environment places code in a framed box.

\def\codeframewidth{\arrayrulewidth}
\RequirePackage{calc}

\newenvironment{framedhscode}%
{\parskip=\abovedisplayskip\par\noindent
	\hscodestyle
	\arrayrulewidth=\codeframewidth
	\tabular{@{}|p{\linewidth-2\arraycolsep-2\arrayrulewidth-2pt}|@{}}%
	\hline\framedhslinecorrect\\{-1.5ex}%
	\let\endoflinesave=\\
	\let\\=\@normalcr
	\(\pboxed}%
{\endpboxed\)%
	\framedhslinecorrect\endoflinesave{.5ex}\hline
	\endtabular
	\parskip=\belowdisplayskip\par\noindent
	\ignorespacesafterend}

\newcommand{\framedhslinecorrect}[2]%
{#1[#2]}

\newcommand{\framedhs}{\sethscode{framedhscode}}

% The inlinehscode environment is an experimental environment
% that can be used to typeset displayed code inline.

\newenvironment{inlinehscode}%
{\(\def\column##1##2{}%
	\let\>\undefined\let\<\undefined\let\\\undefined
	\newcommand\>[1][]{}\newcommand\<[1][]{}\newcommand\\[1][]{}%
	\def\fromto##1##2##3{##3}%
	\def\nextline{}}{\) }%

\newcommand{\inlinehs}{\sethscode{inlinehscode}}

% The joincode environment is a separate environment that
% can be used to surround and thereby connect multiple code
% blocks.

\newenvironment{joincode}%
{\let\orighscode=\hscode
	\let\origendhscode=\endhscode
	\def\endhscode{\def\hscode{\endgroup\def\@currenvir{hscode}\\}\begingroup}
	%\let\SaveRestoreHook=\empty
	%\let\ColumnHook=\empty
	%\let\resethooks=\empty
	\orighscode\def\hscode{\endgroup\def\@currenvir{hscode}}}%
{\origendhscode
	\global\let\hscode=\orighscode
	\global\let\endhscode=\origendhscode}%

\makeatother
\EndFmtInput
%



\usepackage{fullpage}
\usepackage{mathpazo}
\usepackage{graphicx}
\usepackage{color}
\usepackage[centertags]{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{stmaryrd}
\usepackage{soul}
\usepackage{url}
\usepackage{float}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{graphicx}
\usepackage{multirow}
\usepackage{booktabs}
\usepackage{xcolor}
\usepackage{colortbl}
\usepackage{rotating}
\usepackage{listings}
\usepackage{vmargin}
\setpapersize{USletter}
\setmarginsrb{1.1in}{1.0in}{1.1in}{0.6in}{0.3in}{0.3in}{0.0in}{0.2in}
\parindent 0in  \setlength{\parindent}{0in}  \setlength{\parskip}{1ex}
\usepackage{epsfig}\usepackage{rotating}
\usepackage{mathpazo,amsmath,amssymb}
\usepackage{fancyhdr} % Custom headers and footers
\pagestyle{fancyplain} % Makes all pages in the document conform to the custom headers and footers
\fancyhead{} % No page header - if you want one, create it in the same way as the footers below
\fancyfoot[L]{} % Empty left footer
\fancyfoot[C]{} % Empty center footer
\fancyfoot[R]{\thepage} % Page numbering for right footer
\renewcommand{\headrulewidth}{0pt} % Remove header underlines
\renewcommand{\footrulewidth}{0pt} % Remove footer underlines
\setlength{\headheight}{13.6pt} % Customize the height of the header
\newcommand{\ra}[1]{\renewcommand{\arraystretch}{#1}}
%----------------------------------------------------------------------------------------
%   TITLE SECTION
%----------------------------------------------------------------------------------------
\newcommand{\horrule}[1]{\rule{\linewidth}{#1}}

\title{ 
	\normalfont \normalsize 
	\textsc{CS 555} \\ [25pt] % Your university, school and/or department name(s)
	\horrule{0.5pt} \\[0.4cm] % Thin top horizontal rule
	\huge Exercise 2 \\ % The assignment title
	\horrule{2pt} \\[0.5cm] % Thick bottom horizontal rule
}

\author{Mark Mitchell, Doug Keating} % Your name

\date{} % Today's date or a custom date
\begin{document}
	

	
	
	\setcounter{section}{2}
	
	\maketitle
	
	\subsection{Enriching the Core Lambda Language}
	\label{sec:core}
	\horrule{1pt} \\[0.2cm]
	
\noindent 	We updated our parser and interpreters so that it can handle let expressions and	general recursion using the fix operator.\\
	
	\textbf{Key for Evaluation and Typing Rules}\\
	\begin{align*}
	& Terms: & a,b::=\ \lambda x.\ a\ |\ a_1 a_2\ |\ x\ |\ c\ |\ bool\ |\ \text{if}\ a_1 a_2 a_3\ |\ op(a_1, a_2)\\
	&Constants: & c::=\ |-4294967296|...|-1|0|1|...|4294967296|\\
	&Booleans: & bool::=\ tru\ |\ fls\\
	&Operators: & op::=\ +\ |\ -\ |\ *\ |\ /\ |\ Nand\ |\ ==\ |\ <\\
	&OpNum: & opN::=\ +\ |\ -\ |\ *\ |\ /\ |\ Nand\\
	&OpBool:& opB::=\ eq\ |\ lt\\
	&Values:& v::=\ c\ |\ bool\ |\ \lambda x.\ a\\
	& Types: & T::=\ T\rightarrow T\ |\ Int\ |\ Bool\\
	&Environments: & e::=\ []\ |\ e,x:T\\
	\end{align*}
	
	
	
	\subsubsection*{(Small-Step) Structural Operational Semantics Rules}
	
	\noindent Additional rules for let and fix have been added to the core lambda language.\\
	

	
	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	% SMALL STEP TABLE %
	
	\begin{figure}[H]\centering
	\ra{3}
	\begin{tabular}{@{}rc@{}}\toprule
		\textbf{Small-Step Evaluation Rules}\\
		\midrule
		\textbf{\textit{T-App1}} & $\dfrac{a\rightarrow a'}{ab \rightarrow a'b}$ \\
		\textbf{\textit{T-App2}} & $\dfrac{b\rightarrow b'}{vb \rightarrow vb'}$ \\
		\textbf{\textit{T-Abs}} & $\dfrac{}{(\lambda x.\ a)v \rightarrow [ x \mapsto v ] a} $ \\
		\textbf{\textit{T-If1}} & $\dfrac{a \rightarrow a'}{\text{if}\ a\ b_1\ b_2\ \rightarrow \text{if}\ a'\ b_1\ b_2\ }$ \\
		\textbf{\textit{T-IfTru}} & $\dfrac{}{\text{if}\ fls\ a\ b\ \rightarrow a }$ \\
	\textbf{\textit{T-IfFls}} & $\dfrac{}{\text{if}\ fls\ a\ b\ \rightarrow b }$ \\
\textbf{\textit{T-Op1}} & $\dfrac{a\rightarrow a'}{op(a,b)\rightarrow op(a',b)}$  \\
\textbf{\textit{T-Op2}} & $\dfrac{b\rightarrow b'}{op(v,b)\rightarrow op(v,b')}$ \\
\textbf{\textit{T-Op3}} & $\dfrac{}{op(c_1,c_2)\rightarrow v}$ \\
\textbf{\textit{T-Let1}} & $\dfrac{a \rightarrow a'}{\text{Let}\ x=a\ \text{in}\ b \rightarrow \text{Let}\ x=a'\ \text{in}\ b  }$ \\
\textbf{\textit{T-Let2}} & $\dfrac{}{\text{Let}\ x=v\ \text{in}\ b \rightarrow [x \mapsto v ]b  }$ \\
\textbf{\textit{T-Fix1}} & $\dfrac{a \rightarrow a'}{\text{Fix}\ a \rightarrow \text{Fix}\ a'}$ \\
\textbf{\textit{T-Fix2}} & $\dfrac{}{\text{Fix}\ (\lambda x.\ a) \rightarrow [x \mapsto \text{Fix}\ (\lambda x.\ a)](\lambda x.\ a)}$\\
\\
\bottomrule
	\end{tabular}
\end{figure}

	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	
	
\subsubsection*{(Big-Step)Natural Semantics Rules}

	\noindent The natural semantics rules have been extended to include the let and fix cases.\\
		
	
	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	% BIG STEP TABLE %
	
	\begin{figure}[H]\centering
		\ra{3}
		\begin{tabular}{@{}rc@{}}\toprule
			\textbf{Big-Step Evaluation Rules}\\
			\midrule
			\textbf{\textit{T-TermValue}} & $ a \Rightarrow v$ \\
			\textbf{\textit{T-Constant}} & $c \Rightarrow c$ \\
			\textbf{\textit{T-Abstraction}} & $\lambda x.\ a \Rightarrow \lambda x.\ a $ \\
			\textbf{\textit{T-Application}} & $\dfrac{a \Rightarrow \lambda x.\ a'\quad b \Rightarrow v'\quad [x\mapsto v']a'\Rightarrow v}{ab \Rightarrow v}$ \\
			\textbf{\textit{T-IfTruN}} & $\dfrac{a\Rightarrow tru\quad b_1 \Rightarrow v}{\text{if}\ a\ b_1\ b_2\  \Rightarrow v }$ \\
			\textbf{\textit{T-IfFlsN}} &  $\dfrac{a\Rightarrow fls\quad b_2 \Rightarrow v}{\text{if}\ a\ b_1\ b_2\  \Rightarrow v }$ \\
			\textbf{\textit{T-OpN}} & $\dfrac{a_1 \Rightarrow v_1\quad a_2 \Rightarrow v_2 \quad v = \tilde{op}(v_1,v_2)}{op(a_1,a_2)\Rightarrow v}$  \\
			\textbf{\textit{T-LetN}} & $\dfrac{a\Rightarrow v'\quad [x\mapsto v']b\Rightarrow v}{\text{Let}\ x=a\ \text{in}\ b \Rightarrow v  }$ \\
			\textbf{\textit{T-FixN}} & $\dfrac{a \Rightarrow (\lambda x.\ a')\quad \text{Fix}\ (\lambda x.\ a') \Rightarrow [x \mapsto\ \text{Fix}\ (\lambda x.\ a')](\lambda x.\ a') }{\text{Fix}\ a \Rightarrow [x \mapsto\ \text{Fix}\ (\lambda x.\ a')] (\lambda x.\ a')}$ \\
			\\
			\bottomrule
		\end{tabular}
	\end{figure}

	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
	

\subsubsection*{Formal Typing Rules}

These typing rules include the core lambda calculus and the extended terms let 
and fix.\\	


	\begin{figure}[H]\centering
	\ra{3}
	\begin{tabular}{@{}rc@{}}\toprule
		\textbf{Typing Rules}\\
		\midrule
		\textbf{\textit{Type-Base}} & $ e \vdash t:T$ \\
		\textbf{\textit{Type-Var}} & $\dfrac{x:T\ \text{`member'}\ e}{e \vdash x:T}$ \\
		\textbf{\textit{Type-Abs}} & $\dfrac{e,\ x:T \vdash t:T'\ x\ \text{`not a member'}\ dom(e)}{e \vdash \lambda x:T.t : T\rightarrow T'}$ \\
		\textbf{\textit{Type-App}} & $\dfrac{e\vdash t_1:T\rightarrow T',\ e\vdash t_2:T}{e \vdash t_1\ t_2\ : T'}$ \\
		\textbf{\textit{Type-Int}} & $\dfrac{}{e \vdash c: Int}$ \\
		\textbf{\textit{Type-BoolTrue}} &  $\dfrac{}{e \vdash true: Bool}$ \\
		\textbf{\textit{Type-BoolFalse}} & $\dfrac{}{e \vdash false: Bool}$  \\
		\textbf{\textit{Type-Conditional}} & $\dfrac{e\vdash t_1: Bool,\ e\vdash t_2:T,\ e\vdash t_3:T}{e \vdash\ \text{if}\ t_1\ \text{then}\ t_2\ \text{else}\ t_3:T}$ \\
		\textbf{\textit{Type-OpNum}} & $\dfrac{e \vdash t_1:Int,\ e\vdash t_2:Int}{e \vdash opN(t_1,t_2)}$ (where $opN$ is $+|-|*|/|Nand$) \\
		\textbf{\textit{Type-OpBool}} & $\dfrac{e \vdash t_1:Int,\ e \vdash t_2:Int}{e \vdash opB(t_1,t_2): Bool}$ (where $opB$ is $eq|lt$) \\
		\textbf{\textit{Type-Let}} & $\dfrac{e \vdash t_1: T,\ e,\ x:T\ \vdash t2:T'\ x\ \text{`not a member'}\ dom(e) }{e \vdash\ \text{let}\ x = t_1\ \text{in}\ t_2: T'}$ \\
		\textbf{\textit{Type-Fix}} & $\dfrac{e \vdash t: T\rightarrow T}{e \vdash\ \text{fix}\ t: T}$ \\
		\\
		\bottomrule
	\end{tabular}
\end{figure}


\subsubsection*{Parsing}

This is the parser updated to read this language:\\

\textit{Source Code:}\\

\begin{hscode}\SaveRestoreHook
	\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{3}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{5}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{6}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{7}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{8}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{14}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{15}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{17}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{18}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{19}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{20}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{21}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{22}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{23}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{25}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{27}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{29}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{30}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{31}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{39}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{40}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{43}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{45}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
	\>[B]{}\mathbf{module}\;\Conid{AbstractSyntax}\;\mathbf{where}{}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\mathbf{import}\;\Conid{\Conid{System}.Environment}{}\<[E]%
	\\
	\>[B]{}\mathbf{import}\;\Conid{\Conid{Data}.Char}{}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\mathbf{data}\;\Conid{Token}\mathrel{=}{}\<[15]%
	\>[15]{}\Conid{TkArr}\mid \Conid{TkLPar}\mid \Conid{TkComma}\mid \Conid{TkRPar}\mid \Conid{TkBool}\mid \Conid{TkIntWrd}\mid \Conid{TkVarId}\;\Conid{String}{}\<[E]%
	\\
	\>[B]{}\mid \Conid{TkAbs}\mid \Conid{TkColon}\mid \Conid{TkFullStop}\mid \Conid{TkApp}\mid {}\<[40]%
	\>[40]{}\Conid{TkTrue}\mid \Conid{TkFalse}\mid \Conid{TkIf}\mid \Conid{TkThen}\mid \Conid{TkElse}{}\<[E]%
	\\
	\>[B]{}\mid \Conid{TkFi}\mid \Conid{TkIntLit}\;\Conid{Integer}\mid \Conid{TkPlus}\mid \Conid{TkMinus}\mid \Conid{TkMul}\mid \Conid{TkDiv}\mid \Conid{TkNand}\mid \Conid{TkEq}\mid \Conid{TkLt}{}\<[E]%
	\\
	\>[B]{}\mid \Conid{TkFix}\mid \Conid{TkLet}\mid \Conid{TkIn}\mid \Conid{TkEnd}{}\<[E]%
	\\
	\>[B]{}\mathbf{deriving}\;(\Conid{Show},\Conid{Eq}){}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\mathbf{data}\;\Conid{Type}\mathrel{=}\Conid{TypeArrow}\;\Conid{Type}\;\Conid{Type}\mid \Conid{TypeBool}{}\<[45]%
	\>[45]{}\mid \Conid{TypeInt}\;\mathbf{deriving}\;(\Conid{Eq}){}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\mathbf{type}\;\Conid{Var}\mathrel{=}\Conid{String}{}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\mathbf{data}\;\Conid{Term}\mathrel{=}\Conid{Var}\;\Conid{Var}\mid \Conid{Abs}\;\Conid{Var}\;\Conid{Type}\;\Conid{Term}\mid \Conid{App}\;\Conid{Term}\;\Conid{Term}\mid \Conid{Tru}\mid \Conid{Fls}{}\<[E]%
	\\
	\>[B]{}\mid \Conid{If}\;\Conid{Term}\;\Conid{Term}\;\Conid{Term}\mid \Conid{IntConst}\;\Conid{Integer}\mid \Conid{IntAdd}\;\Conid{Term}\;\Conid{Term}\mid \Conid{IntSub}\;\Conid{Term}\;\Conid{Term}{}\<[E]%
	\\
	\>[B]{}\mid \Conid{IntMul}\;\Conid{Term}\;\Conid{Term}\mid \Conid{IntDiv}\;\Conid{Term}\;\Conid{Term}\mid \Conid{IntNand}\;\Conid{Term}\;\Conid{Term}\mid \Conid{IntEq}\;\Conid{Term}\;\Conid{Term}{}\<[E]%
	\\
	\>[B]{}\mid \Conid{IntLt}\;\Conid{Term}\;\Conid{Term}\mid \Conid{ParTerm}\;\Conid{Term}\mid \Conid{Fix}\;\Conid{Term}\mid \Conid{Let}\;\Conid{Var}\;\Conid{Term}\;\Conid{Term}{}\<[E]%
	\\
	\>[B]{}\mathbf{deriving}\;(\Conid{Eq}){}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\mathbf{instance}\;\Conid{Show}\;\Conid{Type}\;\mathbf{where}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Varid{show}\;(\Conid{TypeArrow}\;\Varid{x}\;\Varid{y})\mathrel{=}\text{\tt \char34 ->(\char34}\plus (\Varid{show}\;\Varid{x})\plus \text{\tt \char34 ,\char34}\plus (\Varid{show}\;\Varid{y})\plus \text{\tt \char34 )\char34}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Varid{show}\;\Conid{TypeBool}{}\<[18]%
	\>[18]{}\mathrel{=}\text{\tt \char34 Bool\char34}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Varid{show}\;\Conid{TypeInt}{}\<[18]%
	\>[18]{}\mathrel{=}\text{\tt \char34 Int\char34}{}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\mathbf{instance}\;\Conid{Show}\;\Conid{Term}\;\mathbf{where}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Varid{show}\;(\Conid{Var}\;\Varid{x}){}\<[22]%
	\>[22]{}\mathrel{=}\Varid{x}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Varid{show}\;(\Conid{Abs}\;\Varid{x}\;\Varid{y}\;\Varid{z}){}\<[22]%
	\>[22]{}\mathrel{=}\text{\tt \char34 abs(\char34}\plus \Varid{x}\plus \text{\tt \char34 :\char34}\plus (\Varid{show}\;\Varid{y})\plus \text{\tt \char34 .\char34}\plus (\Varid{show}\;\Varid{z})\plus \text{\tt \char34 )\char34}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Varid{show}\;(\Conid{App}\;\Varid{x}\;\Varid{y}){}\<[22]%
	\>[22]{}\mathrel{=}\text{\tt \char34 app(\char34}\plus (\Varid{show}\;\Varid{x})\plus \text{\tt \char34 ,\char34}\plus (\Varid{show}\;\Varid{y})\plus \text{\tt \char34 )\char34}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Varid{show}\;\Conid{Tru}{}\<[22]%
	\>[22]{}\mathrel{=}\text{\tt \char34 true\char34}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Varid{show}\;\Conid{Fls}{}\<[22]%
	\>[22]{}\mathrel{=}\text{\tt \char34 false\char34}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Varid{show}\;(\Conid{If}\;\Varid{x}\;\Varid{y}\;\Varid{z}){}\<[22]%
	\>[22]{}\mathrel{=}\text{\tt \char34 if~\char34}\plus (\Varid{show}\;\Varid{x})\plus \text{\tt \char34 ~then~\char34}\plus (\Varid{show}\;\Varid{y})\plus \text{\tt \char34 ~else~\char34}\plus (\Varid{show}\;\Varid{z}){}\<[E]%
	\\
	\>[22]{}\hsindent{1}{}\<[23]%
	\>[23]{}\plus \text{\tt \char34 ~fi\char34}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Varid{show}\;(\Conid{Fix}\;\Varid{x}){}\<[22]%
	\>[22]{}\mathrel{=}\text{\tt \char34 fix~\char34}\plus (\Varid{show}\;\Varid{x}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Varid{show}\;(\Conid{Let}\;\Varid{x}\;\Varid{y}\;\Varid{z}){}\<[22]%
	\>[22]{}\mathrel{=}\text{\tt \char34 let~\char34}\plus \Varid{x}\plus \text{\tt \char34 ~=~\char34}\plus (\Varid{show}\;\Varid{y})\plus \text{\tt \char34 ~in~\char34}\plus (\Varid{show}\;\Varid{z})\plus \text{\tt \char34 ~end\char34}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Varid{show}\;(\Conid{IntConst}\;\Varid{x}){}\<[22]%
	\>[22]{}\mathrel{=}\Varid{show}\;\Varid{x}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Varid{show}\;(\Conid{IntAdd}\;\Varid{x}\;\Varid{y}){}\<[22]%
	\>[22]{}\mathrel{=}\text{\tt \char34 +(\char34}\plus (\Varid{show}\;\Varid{x})\plus \text{\tt \char34 ,\char34}\plus (\Varid{show}\;\Varid{y})\plus \text{\tt \char34 )\char34}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Varid{show}\;(\Conid{IntSub}\;\Varid{x}\;\Varid{y}){}\<[22]%
	\>[22]{}\mathrel{=}\text{\tt \char34 -(\char34}\plus (\Varid{show}\;\Varid{x})\plus \text{\tt \char34 ,\char34}\plus (\Varid{show}\;\Varid{y})\plus \text{\tt \char34 )\char34}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Varid{show}\;(\Conid{IntMul}\;\Varid{x}\;\Varid{y}){}\<[22]%
	\>[22]{}\mathrel{=}\text{\tt \char34 *(\char34}\plus (\Varid{show}\;\Varid{x})\plus \text{\tt \char34 ,\char34}\plus (\Varid{show}\;\Varid{y})\plus \text{\tt \char34 )\char34}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Varid{show}\;(\Conid{IntDiv}\;\Varid{x}\;\Varid{y}){}\<[22]%
	\>[22]{}\mathrel{=}\text{\tt \char34 /(\char34}\plus (\Varid{show}\;\Varid{x})\plus \text{\tt \char34 ,\char34}\plus (\Varid{show}\;\Varid{y})\plus \text{\tt \char34 )\char34}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Varid{show}\;(\Conid{IntNand}\;\Varid{x}\;\Varid{y})\mathrel{=}\text{\tt \char34 \char94 (\char34}\plus (\Varid{show}\;\Varid{x})\plus \text{\tt \char34 ,\char34}\plus (\Varid{show}\;\Varid{y})\plus \text{\tt \char34 )\char34}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Varid{show}\;(\Conid{IntEq}\;\Varid{x}\;\Varid{y}){}\<[22]%
	\>[22]{}\mathrel{=}\text{\tt \char34 =(\char34}\plus (\Varid{show}\;\Varid{x})\plus \text{\tt \char34 ,\char34}\plus (\Varid{show}\;\Varid{y})\plus \text{\tt \char34 )\char34}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Varid{show}\;(\Conid{IntLt}\;\Varid{x}\;\Varid{y}){}\<[22]%
	\>[22]{}\mathrel{=}\text{\tt \char34 <(\char34}\plus (\Varid{show}\;\Varid{x})\plus \text{\tt \char34 ,\char34}\plus (\Varid{show}\;\Varid{y})\plus \text{\tt \char34 )\char34}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Varid{show}\;(\Conid{ParTerm}\;\Varid{x}){}\<[22]%
	\>[22]{}\mathrel{=}\text{\tt \char34 (\char34}\plus (\Varid{show}\;\Varid{x})\plus \text{\tt \char34 )\char34}{}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\Varid{commaSeperated}\mathbin{::}[\mskip1.5mu \Conid{Token}\mskip1.5mu]{}\<[E]%
	\\
	\>[B]{}\Varid{commaSeperated}\mathrel{=}[\mskip1.5mu \Conid{TkArr},\Conid{TkApp},\Conid{TkPlus},\Conid{TkMinus},\Conid{TkMul},\Conid{TkDiv},\Conid{TkNand},\Conid{TkEq},\Conid{TkLt}\mskip1.5mu]{}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\mbox{\onelinecomment  Take a string and converts it to tokens}{}\<[E]%
	\\
	\>[B]{}\Varid{makeTokens}\mathbin{::}[\mskip1.5mu \Conid{Char}\mskip1.5mu]\to [\mskip1.5mu \Conid{Token}\mskip1.5mu]{}\<[E]%
	\\
	\>[B]{}\Varid{makeTokens}\;\Varid{cs}\mathrel{=}\Varid{makeTokenList}\;[\mskip1.5mu \mskip1.5mu]\;\Varid{cs}{}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\mbox{\onelinecomment  Builds token list, ignores spaces}{}\<[E]%
	\\
	\>[B]{}\Varid{makeTokenList}\mathbin{::}[\mskip1.5mu \Conid{Token}\mskip1.5mu]\to [\mskip1.5mu \Conid{Char}\mskip1.5mu]\to [\mskip1.5mu \Conid{Token}\mskip1.5mu]{}\<[E]%
	\\
	\>[B]{}\Varid{makeTokenList}\;\Varid{ls}\;[\mskip1.5mu \mskip1.5mu]\mathrel{=}\Varid{reverse}\;\Varid{ls}{}\<[E]%
	\\
	\>[B]{}\Varid{makeTokenList}\;\Varid{ls}\;(\Varid{x}\mathbin{:}\Varid{xs})\mid (\Varid{x}\equiv \text{\tt '-'})\mathrel{\wedge}((\Varid{head}\;\Varid{xs})\equiv \text{\tt '>'}){}\<[E]%
	\\
	\>[B]{}\hsindent{27}{}\<[27]%
	\>[27]{}\mathrel{=}\Varid{makeTokenList}\;(\Conid{TkArr}\mathbin{:}\Varid{ls})\;(\Varid{tail}\;\Varid{xs}){}\<[E]%
	\\
	\>[B]{}\hsindent{25}{}\<[25]%
	\>[25]{}\mid \Varid{x}\equiv \text{\tt '('}\mathrel{=}\Varid{makeTokenList}\;(\Conid{TkLPar}\mathbin{:}\Varid{ls})\;\Varid{xs}{}\<[E]%
	\\
	\>[B]{}\hsindent{25}{}\<[25]%
	\>[25]{}\mid \Varid{x}\equiv \text{\tt ','}\mathrel{=}\Varid{makeTokenList}\;(\Conid{TkComma}\mathbin{:}\Varid{ls})\;\Varid{xs}{}\<[E]%
	\\
	\>[B]{}\hsindent{25}{}\<[25]%
	\>[25]{}\mid \Varid{x}\equiv \text{\tt ')'}\mathrel{=}\Varid{makeTokenList}\;(\Conid{TkRPar}\mathbin{:}\Varid{ls})\;\Varid{xs}{}\<[E]%
	\\
	\>[B]{}\hsindent{25}{}\<[25]%
	\>[25]{}\mid \Varid{x}\equiv \text{\tt ':'}\mathrel{=}\Varid{makeTokenList}\;(\Conid{TkColon}\mathbin{:}\Varid{ls})\;\Varid{xs}{}\<[E]%
	\\
	\>[B]{}\hsindent{25}{}\<[25]%
	\>[25]{}\mid \Varid{x}\equiv \text{\tt '.'}\mathrel{=}\Varid{makeTokenList}\;(\Conid{TkFullStop}\mathbin{:}\Varid{ls})\;\Varid{xs}{}\<[E]%
	\\
	\>[B]{}\hsindent{25}{}\<[25]%
	\>[25]{}\mid \Varid{x}\equiv \text{\tt '+'}\mathrel{=}\Varid{makeTokenList}\;(\Conid{TkPlus}\mathbin{:}\Varid{ls})\;\Varid{xs}{}\<[E]%
	\\
	\>[B]{}\hsindent{25}{}\<[25]%
	\>[25]{}\mid \Varid{x}\equiv \text{\tt '-'}\mathrel{=}\Varid{makeTokenList}\;(\Conid{TkMinus}\mathbin{:}\Varid{ls})\;\Varid{xs}{}\<[E]%
	\\
	\>[B]{}\hsindent{25}{}\<[25]%
	\>[25]{}\mid \Varid{x}\equiv \text{\tt '*'}\mathrel{=}\Varid{makeTokenList}\;(\Conid{TkMul}\mathbin{:}\Varid{ls})\;\Varid{xs}{}\<[E]%
	\\
	\>[B]{}\hsindent{25}{}\<[25]%
	\>[25]{}\mid \Varid{x}\equiv \text{\tt '/'}\mathrel{=}\Varid{makeTokenList}\;(\Conid{TkDiv}\mathbin{:}\Varid{ls})\;\Varid{xs}{}\<[E]%
	\\
	\>[B]{}\hsindent{25}{}\<[25]%
	\>[25]{}\mid \Varid{x}\equiv \text{\tt '\char94 '}\mathrel{=}\Varid{makeTokenList}\;(\Conid{TkNand}\mathbin{:}\Varid{ls})\;\Varid{xs}{}\<[E]%
	\\
	\>[B]{}\hsindent{25}{}\<[25]%
	\>[25]{}\mid \Varid{x}\equiv \text{\tt '='}\mathrel{=}\Varid{makeTokenList}\;(\Conid{TkEq}\mathbin{:}\Varid{ls})\;\Varid{xs}{}\<[E]%
	\\
	\>[B]{}\hsindent{25}{}\<[25]%
	\>[25]{}\mid \Varid{x}\equiv \text{\tt '<'}\mathrel{=}\Varid{makeTokenList}\;(\Conid{TkLt}\mathbin{:}\Varid{ls})\;\Varid{xs}{}\<[E]%
	\\
	\>[B]{}\hsindent{25}{}\<[25]%
	\>[25]{}\mid \Varid{isSpace}\;\Varid{x}\mathrel{=}\Varid{makeTokenList}\;\Varid{ls}\;\Varid{xs}{}\<[E]%
	\\
	\>[B]{}\hsindent{25}{}\<[25]%
	\>[25]{}\mid \Varid{isAlphaNum}\;\Varid{x}\mathrel{=}\mathbf{let}\;\Varid{alphas}\mathrel{=}\Varid{takeWhile}\;\Varid{isAlphaNum}\;(\Varid{x}\mathbin{:}\Varid{xs}){}\<[E]%
	\\
	\>[25]{}\hsindent{20}{}\<[45]%
	\>[45]{}\Varid{rest}\mathrel{=}\Varid{dropWhile}\;\Varid{isAlphaNum}\;(\Varid{x}\mathbin{:}\Varid{xs}){}\<[E]%
	\\
	\>[25]{}\hsindent{14}{}\<[39]%
	\>[39]{}\mathbf{in}\;{}\<[43]%
	\>[43]{}\Varid{makeTokenList}{}\<[E]%
	\\
	\>[25]{}\hsindent{14}{}\<[39]%
	\>[39]{}((\Varid{matchToken}\;\Varid{alphas})\mathbin{:}\Varid{ls})\;\Varid{rest}{}\<[E]%
	\\
	\>[B]{}\hsindent{25}{}\<[25]%
	\>[25]{}\mid \Varid{otherwise}\mathrel{=}\Varid{error}\;(\text{\tt \char34 unrecognized~character~\char34}{}\<[E]%
	\\
	\>[25]{}\hsindent{2}{}\<[27]%
	\>[27]{}\plus \Varid{show}\;\Varid{x}){}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\mbox{\onelinecomment  Multiple char cases such as key words are handled by this function}{}\<[E]%
	\\
	\>[B]{}\Varid{matchToken}\mathbin{::}[\mskip1.5mu \Conid{Char}\mskip1.5mu]\to \Conid{Token}{}\<[E]%
	\\
	\>[B]{}\Varid{matchToken}\;\text{\tt \char34 Bool\char34}{}\<[21]%
	\>[21]{}\mathrel{=}\Conid{TkBool}{}\<[E]%
	\\
	\>[B]{}\Varid{matchToken}\;\text{\tt \char34 Int\char34}{}\<[21]%
	\>[21]{}\mathrel{=}\Conid{TkIntWrd}{}\<[E]%
	\\
	\>[B]{}\Varid{matchToken}\;\text{\tt \char34 abs\char34}{}\<[21]%
	\>[21]{}\mathrel{=}\Conid{TkAbs}{}\<[E]%
	\\
	\>[B]{}\Varid{matchToken}\;\text{\tt \char34 app\char34}{}\<[21]%
	\>[21]{}\mathrel{=}\Conid{TkApp}{}\<[E]%
	\\
	\>[B]{}\Varid{matchToken}\;\text{\tt \char34 true\char34}{}\<[21]%
	\>[21]{}\mathrel{=}\Conid{TkTrue}{}\<[E]%
	\\
	\>[B]{}\Varid{matchToken}\;\text{\tt \char34 false\char34}{}\<[21]%
	\>[21]{}\mathrel{=}\Conid{TkFalse}{}\<[E]%
	\\
	\>[B]{}\Varid{matchToken}\;\text{\tt \char34 if\char34}{}\<[21]%
	\>[21]{}\mathrel{=}\Conid{TkIf}{}\<[E]%
	\\
	\>[B]{}\Varid{matchToken}\;\text{\tt \char34 then\char34}{}\<[21]%
	\>[21]{}\mathrel{=}\Conid{TkThen}{}\<[E]%
	\\
	\>[B]{}\Varid{matchToken}\;\text{\tt \char34 else\char34}{}\<[21]%
	\>[21]{}\mathrel{=}\Conid{TkElse}{}\<[E]%
	\\
	\>[B]{}\Varid{matchToken}\;\text{\tt \char34 fi\char34}{}\<[21]%
	\>[21]{}\mathrel{=}\Conid{TkFi}{}\<[E]%
	\\
	\>[B]{}\Varid{matchToken}\;\text{\tt \char34 fix\char34}{}\<[21]%
	\>[21]{}\mathrel{=}\Conid{TkFix}{}\<[E]%
	\\
	\>[B]{}\Varid{matchToken}\;\text{\tt \char34 let\char34}{}\<[21]%
	\>[21]{}\mathrel{=}\Conid{TkLet}{}\<[E]%
	\\
	\>[B]{}\Varid{matchToken}\;\text{\tt \char34 in\char34}{}\<[21]%
	\>[21]{}\mathrel{=}\Conid{TkIn}{}\<[E]%
	\\
	\>[B]{}\Varid{matchToken}\;\text{\tt \char34 end\char34}{}\<[21]%
	\>[21]{}\mathrel{=}\Conid{TkEnd}{}\<[E]%
	\\
	\>[B]{}\Varid{matchToken}\;\Varid{x}{}\<[21]%
	\>[21]{}\mathrel{=}\mathbf{if}\;(\Varid{isInt}\;\Varid{x})\;\mathbf{then}\;\Conid{TkIntLit}\;(\Varid{read}\;\Varid{x}\mathbin{::}\Conid{Integer})\;\mathbf{else}\;\Conid{TkVarId}\;\Varid{x}{}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\Varid{isInt}\mathbin{::}[\mskip1.5mu \Conid{Char}\mskip1.5mu]\to \Conid{Bool}{}\<[E]%
	\\
	\>[B]{}\Varid{isInt}\;\Varid{xs}\mathrel{=}\Varid{foldr}\;(\lambda \Varid{x}\;\Varid{y}\to (\Varid{elem}\;\Varid{x}\;[\mskip1.5mu \text{\tt '0'}\mathinner{\ldotp\ldotp}\text{\tt '9'}\mskip1.5mu])\mathrel{\wedge}\Varid{y})\;\Conid{True}\;\Varid{xs}{}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\mbox{\onelinecomment  returns type from tokens}{}\<[E]%
	\\
	\>[B]{}\Varid{tokenType}\mathbin{::}[\mskip1.5mu \Conid{Token}\mskip1.5mu]\to \Conid{Type}{}\<[E]%
	\\
	\>[B]{}\Varid{tokenType}\;[\mskip1.5mu \Conid{TkIntWrd}\mskip1.5mu]\mathrel{=}\Conid{TypeInt}{}\<[E]%
	\\
	\>[B]{}\Varid{tokenType}\;[\mskip1.5mu \Conid{TkBool}\mskip1.5mu]{}\<[22]%
	\>[22]{}\mathrel{=}\Conid{TypeBool}{}\<[E]%
	\\
	\>[B]{}\Varid{tokenType}\;[\mskip1.5mu \Conid{TkArr}\mskip1.5mu]{}\<[22]%
	\>[22]{}\mathrel{=}\Varid{error}\;(\text{\tt \char34 Improper~Token~used~for~type\char34}){}\<[E]%
	\\
	\>[B]{}\Varid{tokenType}\;(\Conid{TkArr}\mathbin{:}\Varid{xs})\mathrel{=}\mathbf{if}\;((\Varid{head}\;\Varid{xs})\equiv \Conid{TkLPar})\;\mathbf{then}\;\Varid{typeArrHelp}\;(\Varid{xs}){}\<[E]%
	\\
	\>[B]{}\hsindent{27}{}\<[27]%
	\>[27]{}\mathbf{else}\;\Varid{error}\;(\text{\tt \char34 Improper~Token~used~for~type\char34}){}\<[E]%
	\\
	\>[B]{}\Varid{tokenType}\;\Varid{xs}{}\<[22]%
	\>[22]{}\mathrel{=}\Varid{error}\;(\text{\tt \char34 Improper~Token~used~for~type\char34}){}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\mbox{\onelinecomment  Gets the String that is designated as the variable}{}\<[E]%
	\\
	\>[B]{}\Varid{getVar}\mathbin{::}\Conid{Token}\to \Conid{Var}{}\<[E]%
	\\
	\>[B]{}\Varid{getVar}\;(\Conid{TkVarId}\;\Varid{x})\mathrel{=}\Varid{x}{}\<[E]%
	\\
	\>[B]{}\Varid{getVar}\;\Varid{x}\mathrel{=}\Varid{error}\;(\text{\tt \char34 Improper~variable~\char34}\plus \Varid{show}\;\Varid{x}){}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\mbox{\onelinecomment  Creates an arrow type from a list of tokens}{}\<[E]%
	\\
	\>[B]{}\Varid{typeArrHelp}\mathbin{::}[\mskip1.5mu \Conid{Token}\mskip1.5mu]\to \Conid{Type}{}\<[E]%
	\\
	\>[B]{}\Varid{typeArrHelp}\;\Varid{xs}\mathrel{=}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\mathbf{let}\;\Varid{arrTypes}\mathrel{=}(\Varid{caseHelper}\;(\Varid{parRemove}\;\Varid{xs})\;\Varid{commaSeperated}\;\Conid{TkComma}\;\mathrm{0}\;[\mskip1.5mu \mskip1.5mu]){}\<[E]%
	\\
	\>[3]{}\hsindent{3}{}\<[6]%
	\>[6]{}\mathbf{in}\;\Conid{TypeArrow}\;(\Varid{tokenType}\;(\Varid{fst}\;\Varid{arrTypes}))\;(\Varid{tokenType}\;(\Varid{snd}\;\Varid{arrTypes})){}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\mbox{\onelinecomment  Takes tokens that return terminal terms that do not contain other terms}{}\<[E]%
	\\
	\>[B]{}\Varid{makeSingleTerm}\mathbin{::}\Conid{Token}\to \Conid{Term}{}\<[E]%
	\\
	\>[B]{}\Varid{makeSingleTerm}\;\Conid{TkTrue}\mathrel{=}\Conid{Tru}{}\<[E]%
	\\
	\>[B]{}\Varid{makeSingleTerm}\;\Conid{TkFalse}\mathrel{=}\Conid{Fls}{}\<[E]%
	\\
	\>[B]{}\Varid{makeSingleTerm}\;(\Conid{TkVarId}\;\Varid{x})\mathrel{=}\Conid{Var}\;\Varid{x}{}\<[E]%
	\\
	\>[B]{}\Varid{makeSingleTerm}\;(\Conid{TkIntLit}\;\Varid{x})\mathrel{=}\Conid{IntConst}\;\Varid{x}{}\<[E]%
	\\
	\>[B]{}\Varid{makeSingleTerm}\;\Varid{x}\mathrel{=}\Varid{error}\;(\text{\tt \char34 Undefined~Term~for~token~\char34}\plus \Varid{show}\;\Varid{x}){}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\mbox{\onelinecomment  Takes a list of tokens to return a single term}{}\<[E]%
	\\
	\>[B]{}\Varid{buildTerm}\mathbin{::}[\mskip1.5mu \Conid{Token}\mskip1.5mu]\to \Conid{Term}{}\<[E]%
	\\
	\>[B]{}\Varid{buildTerm}\;[\mskip1.5mu \mskip1.5mu]\mathrel{=}\Varid{error}\;(\text{\tt \char34 No~tokens~provided\char34}){}\<[E]%
	\\
	\>[B]{}\Varid{buildTerm}\;[\mskip1.5mu \Varid{x}\mskip1.5mu]\mathrel{=}\Varid{makeSingleTerm}\;\Varid{x}{}\<[E]%
	\\
	\>[B]{}\Varid{buildTerm}\;(\Varid{x}\mathbin{:}\Varid{xs}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\mid \Varid{x}\equiv \Conid{TkAbs}\mathrel{=}\Varid{absTerm}\;\Varid{xs}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\mid \Varid{x}\equiv \Conid{TkApp}\mathrel{=}\Varid{appTerm}\;\Varid{xs}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\mid \Varid{x}\equiv \Conid{TkIf}{}\<[15]%
	\>[15]{}\mathrel{=}\Varid{ifTerm}\;\Varid{xs}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\mid \Varid{x}\equiv \Conid{TkLPar}\mathrel{=}\Conid{ParTerm}\;(\Varid{parCase}\;\Varid{xs}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\mid (\Varid{x}\equiv \Conid{TkFix})\mathrel{\wedge}((\Varid{head}\;\Varid{xs})\equiv \Conid{TkLPar})\mathrel{=}\Conid{Fix}\;(\Varid{parCase}\;(\Varid{tail}\;\Varid{xs})){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\mid \Varid{x}\equiv \Conid{TkLet}\mathrel{=}\Varid{letTerm}\;\Varid{xs}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\mid (\Varid{x}\equiv \Conid{TkPlus})\mathrel{\wedge}((\Varid{head}\;\Varid{xs})\equiv \Conid{TkLPar})\mathrel{=}{}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\mathbf{let}\;\Varid{operands}\mathrel{=}(\Varid{caseHelper}\;(\Varid{parRemove}\;\Varid{xs})\;\Varid{commaSeperated}\;\Conid{TkComma}\;\mathrm{0}\;[\mskip1.5mu \mskip1.5mu]){}\<[E]%
	\\
	\>[5]{}\hsindent{3}{}\<[8]%
	\>[8]{}\mathbf{in}\;\Conid{IntAdd}\;(\Varid{buildTerm}\;(\Varid{fst}\;\Varid{operands}))\;(\Varid{buildTerm}\;(\Varid{snd}\;\Varid{operands})){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\mid (\Varid{x}\equiv \Conid{TkMinus})\mathrel{\wedge}((\Varid{head}\;\Varid{xs})\equiv \Conid{TkLPar})\mathrel{=}{}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\mathbf{let}\;\Varid{operands}\mathrel{=}(\Varid{caseHelper}\;(\Varid{parRemove}\;\Varid{xs})\;\Varid{commaSeperated}\;\Conid{TkComma}\;\mathrm{0}\;[\mskip1.5mu \mskip1.5mu]){}\<[E]%
	\\
	\>[5]{}\hsindent{3}{}\<[8]%
	\>[8]{}\mathbf{in}\;\Conid{IntSub}\;(\Varid{buildTerm}\;(\Varid{fst}\;\Varid{operands}))\;(\Varid{buildTerm}\;(\Varid{snd}\;\Varid{operands})){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\mid (\Varid{x}\equiv \Conid{TkMul})\mathrel{\wedge}((\Varid{head}\;\Varid{xs})\equiv \Conid{TkLPar})\mathrel{=}{}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\mathbf{let}\;\Varid{operands}\mathrel{=}(\Varid{caseHelper}\;(\Varid{parRemove}\;\Varid{xs})\;\Varid{commaSeperated}\;\Conid{TkComma}\;\mathrm{0}\;[\mskip1.5mu \mskip1.5mu]){}\<[E]%
	\\
	\>[5]{}\hsindent{3}{}\<[8]%
	\>[8]{}\mathbf{in}\;\Conid{IntMul}\;(\Varid{buildTerm}\;(\Varid{fst}\;\Varid{operands}))\;(\Varid{buildTerm}\;(\Varid{snd}\;\Varid{operands})){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\mid (\Varid{x}\equiv \Conid{TkDiv})\mathrel{\wedge}((\Varid{head}\;\Varid{xs})\equiv \Conid{TkLPar})\mathrel{=}{}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\mathbf{let}\;\Varid{operands}\mathrel{=}(\Varid{caseHelper}\;(\Varid{parRemove}\;\Varid{xs})\;\Varid{commaSeperated}\;\Conid{TkComma}\;\mathrm{0}\;[\mskip1.5mu \mskip1.5mu]){}\<[E]%
	\\
	\>[5]{}\hsindent{3}{}\<[8]%
	\>[8]{}\mathbf{in}\;\Conid{IntDiv}\;(\Varid{buildTerm}\;(\Varid{fst}\;\Varid{operands}))\;(\Varid{buildTerm}\;(\Varid{snd}\;\Varid{operands})){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\mid (\Varid{x}\equiv \Conid{TkNand})\mathrel{\wedge}((\Varid{head}\;\Varid{xs})\equiv \Conid{TkLPar})\mathrel{=}{}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\mathbf{let}\;\Varid{operands}\mathrel{=}(\Varid{caseHelper}\;(\Varid{parRemove}\;\Varid{xs})\;\Varid{commaSeperated}\;\Conid{TkComma}\;\mathrm{0}\;[\mskip1.5mu \mskip1.5mu]){}\<[E]%
	\\
	\>[5]{}\hsindent{3}{}\<[8]%
	\>[8]{}\mathbf{in}\;\Conid{IntNand}\;(\Varid{buildTerm}\;(\Varid{fst}\;\Varid{operands}))\;(\Varid{buildTerm}\;(\Varid{snd}\;\Varid{operands})){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\mid (\Varid{x}\equiv \Conid{TkEq})\mathrel{\wedge}((\Varid{head}\;\Varid{xs})\equiv \Conid{TkLPar})\mathrel{=}{}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\mathbf{let}\;\Varid{operands}\mathrel{=}(\Varid{caseHelper}\;(\Varid{parRemove}\;\Varid{xs})\;\Varid{commaSeperated}\;\Conid{TkComma}\;\mathrm{0}\;[\mskip1.5mu \mskip1.5mu]){}\<[E]%
	\\
	\>[5]{}\hsindent{3}{}\<[8]%
	\>[8]{}\mathbf{in}\;\Conid{IntEq}\;(\Varid{buildTerm}\;(\Varid{fst}\;\Varid{operands}))\;(\Varid{buildTerm}\;(\Varid{snd}\;\Varid{operands})){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\mid (\Varid{x}\equiv \Conid{TkLt})\mathrel{\wedge}((\Varid{head}\;\Varid{xs})\equiv \Conid{TkLPar})\mathrel{=}{}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\mathbf{let}\;\Varid{operands}\mathrel{=}(\Varid{caseHelper}\;(\Varid{parRemove}\;\Varid{xs})\;\Varid{commaSeperated}\;\Conid{TkComma}\;\mathrm{0}\;[\mskip1.5mu \mskip1.5mu]){}\<[E]%
	\\
	\>[5]{}\hsindent{3}{}\<[8]%
	\>[8]{}\mathbf{in}\;\Conid{IntLt}\;(\Varid{buildTerm}\;(\Varid{fst}\;\Varid{operands}))\;(\Varid{buildTerm}\;(\Varid{snd}\;\Varid{operands})){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\mid \Varid{otherwise}\mathrel{=}\Varid{error}\;(\text{\tt \char34 Undefined~Term~on~token~\char34}\plus \Varid{show}\;\Varid{x}){}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\mbox{\onelinecomment  Helper function for the abs case}{}\<[E]%
	\\
	\>[B]{}\Varid{absTerm}\mathbin{::}[\mskip1.5mu \Conid{Token}\mskip1.5mu]\to \Conid{Term}{}\<[E]%
	\\
	\>[B]{}\Varid{absTerm}\;\Varid{xs}\mathrel{=}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\mathbf{let}\;\Varid{absCase}\mathrel{=}\Varid{caseHelper}\;(\Varid{parRemove}\;\Varid{xs})\;[\mskip1.5mu \Conid{TkAbs}\mskip1.5mu]\;\Conid{TkColon}\;\mathrm{0}\;[\mskip1.5mu \mskip1.5mu]{}\<[E]%
	\\
	\>[3]{}\hsindent{4}{}\<[7]%
	\>[7]{}\mathbf{in}\;\mathbf{let}\;\Varid{colDot}\mathrel{=}\Varid{caseHelper}\;(\Varid{snd}\;\Varid{absCase})\;[\mskip1.5mu \Conid{TkAbs}\mskip1.5mu]\;\Conid{TkFullStop}\;\mathrm{0}\;[\mskip1.5mu \mskip1.5mu]{}\<[E]%
	\\
	\>[7]{}\hsindent{7}{}\<[14]%
	\>[14]{}\mathbf{in}\;\Conid{Abs}\;(\Varid{getVar}\;(\Varid{head}\;(\Varid{fst}\;\Varid{absCase})))\;(\Varid{tokenType}\;(\Varid{fst}\;\Varid{colDot}))\;{}\<[E]%
	\\
	\>[14]{}\hsindent{5}{}\<[19]%
	\>[19]{}(\Varid{buildTerm}\;(\Varid{snd}\;\Varid{colDot})){}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\mbox{\onelinecomment  Helper function for the app case}{}\<[E]%
	\\
	\>[B]{}\Varid{appTerm}\mathbin{::}[\mskip1.5mu \Conid{Token}\mskip1.5mu]\to \Conid{Term}{}\<[E]%
	\\
	\>[B]{}\Varid{appTerm}\;\Varid{xs}\mathrel{=}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\mathbf{let}\;\Varid{appCase}\mathrel{=}\Varid{caseHelper}\;(\Varid{parRemove}\;\Varid{xs})\;\Varid{commaSeperated}\;\Conid{TkComma}\;\mathrm{0}\;[\mskip1.5mu \mskip1.5mu]{}\<[E]%
	\\
	\>[3]{}\hsindent{4}{}\<[7]%
	\>[7]{}\mathbf{in}\;\Conid{App}\;(\Varid{buildTerm}\;(\Varid{fst}\;\Varid{appCase}))\;(\Varid{buildTerm}\;(\Varid{snd}\;\Varid{appCase})){}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\mbox{\onelinecomment  Function removes the first and last parenthese of term or group of terms}{}\<[E]%
	\\
	\>[B]{}\Varid{parRemove}\mathbin{::}[\mskip1.5mu \Conid{Token}\mskip1.5mu]\to [\mskip1.5mu \Conid{Token}\mskip1.5mu]{}\<[E]%
	\\
	\>[B]{}\Varid{parRemove}\;\Varid{xs}\mathrel{=}\mathbf{if}\;(((\Varid{head}\;\Varid{xs})\equiv \Conid{TkLPar})\mathrel{\wedge}((\Varid{last}\;\Varid{xs})\equiv \Conid{TkRPar})){}\<[E]%
	\\
	\>[B]{}\hsindent{7}{}\<[7]%
	\>[7]{}\mathbf{then}\;(\Varid{tail}\;(\Varid{init}\;\Varid{xs}))\;\mathbf{else}\;\Varid{error}\;(\text{\tt \char34 Mismatched~parentheses\char34}){}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\mbox{\onelinecomment  Helper function for the let case}{}\<[E]%
	\\
	\>[B]{}\Varid{letTerm}\mathbin{::}[\mskip1.5mu \Conid{Token}\mskip1.5mu]\to \Conid{Term}{}\<[E]%
	\\
	\>[B]{}\Varid{letTerm}\;(\Varid{x}\mathbin{:}\Varid{xs})\mathrel{=}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\mathbf{let}\;\Varid{letCase}\mathrel{=}\Varid{caseHelper}\;(\Varid{letFix}\;\Varid{xs})\;[\mskip1.5mu \Conid{TkLet}\mskip1.5mu]\;\Conid{TkIn}\;\mathrm{0}\;[\mskip1.5mu \mskip1.5mu]{}\<[E]%
	\\
	\>[3]{}\hsindent{4}{}\<[7]%
	\>[7]{}\mathbf{in}\;\Conid{Let}\;(\Varid{getVar}\;\Varid{x})\;(\Varid{buildTerm}\;(\Varid{fst}\;\Varid{letCase}))\;(\Varid{buildTerm}\;(\Varid{snd}\;\Varid{letCase})){}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\mbox{\onelinecomment  Function checks for closing end term for let functions}{}\<[E]%
	\\
	\>[B]{}\Varid{letFix}\mathbin{::}[\mskip1.5mu \Conid{Token}\mskip1.5mu]\to [\mskip1.5mu \Conid{Token}\mskip1.5mu]{}\<[E]%
	\\
	\>[B]{}\Varid{letFix}\;(\Varid{x}\mathbin{:}\Varid{xs})\mathrel{=}\mathbf{if}\;((\Varid{x}\equiv \Conid{TkEq})\mathrel{\wedge}(\Varid{last}\;\Varid{xs}\equiv \Conid{TkEnd}))\;\mathbf{then}\;(\Varid{init}\;\Varid{xs}){}\<[E]%
	\\
	\>[B]{}\hsindent{17}{}\<[17]%
	\>[17]{}\mathbf{else}\;\Varid{error}\;(\text{\tt \char34 missing~end~word\char34}){}\<[E]%
	\\
	\>[B]{}\Varid{letFix}\;\anonymous \mathrel{=}\Varid{error}\;(\text{\tt \char34 Improper~use~of~let~expression\char34}){}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\mbox{\onelinecomment  Helper function for the if case}{}\<[E]%
	\\
	\>[B]{}\Varid{ifTerm}\mathbin{::}[\mskip1.5mu \Conid{Token}\mskip1.5mu]\to \Conid{Term}{}\<[E]%
	\\
	\>[B]{}\Varid{ifTerm}\;\Varid{xs}\mathrel{=}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\mathbf{let}\;\Varid{ifCase}\mathrel{=}\Varid{caseHelper}\;(\Varid{ifFix}\;\Varid{xs})\;[\mskip1.5mu \Conid{TkIf}\mskip1.5mu]\;\Conid{TkThen}\;\mathrm{0}\;[\mskip1.5mu \mskip1.5mu]{}\<[E]%
	\\
	\>[3]{}\hsindent{4}{}\<[7]%
	\>[7]{}\mathbf{in}\;\mathbf{let}\;\Varid{thenElse}\mathrel{=}\Varid{caseHelper}\;(\Varid{snd}\;\Varid{ifCase})\;[\mskip1.5mu \Conid{TkIf}\mskip1.5mu]\;\Conid{TkElse}\;\mathrm{0}\;[\mskip1.5mu \mskip1.5mu]{}\<[E]%
	\\
	\>[7]{}\hsindent{7}{}\<[14]%
	\>[14]{}\mathbf{in}\;\Conid{If}\;(\Varid{buildTerm}\;(\Varid{fst}\;\Varid{ifCase}))\;(\Varid{buildTerm}\;(\Varid{fst}\;\Varid{thenElse}))\;{}\<[E]%
	\\
	\>[14]{}\hsindent{5}{}\<[19]%
	\>[19]{}(\Varid{buildTerm}\;(\Varid{snd}\;\Varid{thenElse})){}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\mbox{\onelinecomment  Function checks for closing fi term for if functions}{}\<[E]%
	\\
	\>[B]{}\Varid{ifFix}\mathbin{::}[\mskip1.5mu \Conid{Token}\mskip1.5mu]\to [\mskip1.5mu \Conid{Token}\mskip1.5mu]{}\<[E]%
	\\
	\>[B]{}\Varid{ifFix}\;\Varid{xs}\mathrel{=}\mathbf{if}\;(\Varid{last}\;\Varid{xs}\equiv \Conid{TkFi})\;\mathbf{then}\;(\Varid{init}\;\Varid{xs})\;\mathbf{else}\;\Varid{error}\;(\text{\tt \char34 missing~fi\char34}){}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\mbox{\onelinecomment  Expression that contain multiple terms or types needs to be broken up }{}\<[E]%
	\\
	\>[B]{}\mbox{\onelinecomment  at key points i.e. if cases seperate terms at the then and else tokens, }{}\<[E]%
	\\
	\>[B]{}\mbox{\onelinecomment  however nested if cases are ignored via a counter such that the tokens are }{}\<[E]%
	\\
	\>[B]{}\mbox{\onelinecomment   not partitioned at this point inside nested terms. }{}\<[E]%
	\\
	\>[B]{}\Varid{caseHelper}\mathbin{::}[\mskip1.5mu \Conid{Token}\mskip1.5mu]\to [\mskip1.5mu \Conid{Token}\mskip1.5mu]\to \Conid{Token}\to \Conid{Int}\to [\mskip1.5mu \Conid{Token}\mskip1.5mu]\to ([\mskip1.5mu \Conid{Token}\mskip1.5mu],[\mskip1.5mu \Conid{Token}\mskip1.5mu]){}\<[E]%
	\\
	\>[B]{}\Varid{caseHelper}\;[\mskip1.5mu \mskip1.5mu]\;\Varid{tk0}\;\anonymous \;\anonymous \;\anonymous \mathrel{=}\Varid{error}\;(\text{\tt \char34 Incomplete~\char34}\plus (\Varid{show}\;(\Varid{head}\;\Varid{tk0}))\plus \text{\tt \char34 ~statement\char34}){}\<[E]%
	\\
	\>[B]{}\Varid{caseHelper}\;(\Varid{x}\mathbin{:}\Varid{xs})\;\Varid{tk0}\;\Varid{tk}\;\Varid{n}\;\Varid{ys}\mid ((\Varid{n}\equiv \mathrm{0})\mathrel{\wedge}(\Varid{x}\equiv \Varid{tk}))\mathrel{=}(\Varid{ys},\Varid{xs}){}\<[E]%
	\\
	\>[B]{}\hsindent{29}{}\<[29]%
	\>[29]{}\mid ((\neg \;(\Varid{n}\equiv \mathrm{0}))\mathrel{\wedge}(\Varid{x}\equiv \Varid{tk}))\mathrel{=}{}\<[E]%
	\\
	\>[29]{}\hsindent{2}{}\<[31]%
	\>[31]{}\Varid{caseHelper}\;\Varid{xs}\;\Varid{tk0}\;\Varid{tk}\;(\Varid{n}\mathbin{-}\mathrm{1})\;(\Varid{ys}\plus [\mskip1.5mu \Varid{x}\mskip1.5mu]){}\<[E]%
	\\
	\>[B]{}\hsindent{29}{}\<[29]%
	\>[29]{}\mid \Varid{x}\in \Varid{tk0}\mathrel{=}\Varid{caseHelper}\;\Varid{xs}\;\Varid{tk0}\;\Varid{tk}\;(\Varid{n}\mathbin{+}\mathrm{1})\;(\Varid{ys}\plus [\mskip1.5mu \Varid{x}\mskip1.5mu]){}\<[E]%
	\\
	\>[B]{}\hsindent{29}{}\<[29]%
	\>[29]{}\mid \Varid{otherwise}\mathrel{=}\Varid{caseHelper}\;\Varid{xs}\;\Varid{tk0}\;\Varid{tk}\;\Varid{n}\;(\Varid{ys}\plus [\mskip1.5mu \Varid{x}\mskip1.5mu]){}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\mbox{\onelinecomment  Handles the ParTerm case}{}\<[E]%
	\\
	\>[B]{}\Varid{parCase}\mathbin{::}[\mskip1.5mu \Conid{Token}\mskip1.5mu]\to \Conid{Term}{}\<[E]%
	\\
	\>[B]{}\Varid{parCase}\;\Varid{xs}\mathrel{=}\mathbf{if}\;(\Varid{last}\;\Varid{xs}\equiv \Conid{TkRPar})\;\mathbf{then}\;(\Varid{buildTerm}\;(\Varid{init}\;\Varid{xs})){}\<[E]%
	\\
	\>[B]{}\hsindent{7}{}\<[7]%
	\>[7]{}\mathbf{else}\;\Varid{error}\;(\text{\tt \char34 missing~parentheses\char34}){}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\Varid{fv}\mathbin{::}\Conid{Term}\to [\mskip1.5mu \Conid{Var}\mskip1.5mu]{}\<[E]%
	\\
	\>[B]{}\Varid{fv}\;(\Conid{Var}\;\Varid{x}){}\<[20]%
	\>[20]{}\mathrel{=}[\mskip1.5mu \Varid{x}\mskip1.5mu]{}\<[E]%
	\\
	\>[B]{}\Varid{fv}\;(\Conid{Abs}\;\Varid{x}\;\anonymous \;\Varid{t}){}\<[20]%
	\>[20]{}\mathrel{=}[\mskip1.5mu \Varid{y}\mid \Varid{y}\leftarrow (\Varid{fv}\;\Varid{t}),\Varid{x}\not\equiv \Varid{y}\mskip1.5mu]{}\<[E]%
	\\
	\>[B]{}\Varid{fv}\;(\Conid{If}\;\Varid{t}_{1}\;\Varid{t}_{2}\;\Varid{t}_{3}){}\<[20]%
	\>[20]{}\mathrel{=}(\Varid{fv}\;\Varid{t}_{1})\plus (\Varid{fv}\;\Varid{t}_{2})\plus (\Varid{fv}\;\Varid{t}_{3}){}\<[E]%
	\\
	\>[B]{}\Varid{fv}\;(\Conid{ParTerm}\;\Varid{t}){}\<[20]%
	\>[20]{}\mathrel{=}\Varid{fv}\;\Varid{t}{}\<[E]%
	\\
	\>[B]{}\Varid{fv}\;(\Conid{App}\;\Varid{t}_{1}\;\Varid{t}_{2}){}\<[20]%
	\>[20]{}\mathrel{=}(\Varid{fv}\;\Varid{t}_{1})\plus (\Varid{fv}\;\Varid{t}_{2}){}\<[E]%
	\\
	\>[B]{}\Varid{fv}\;(\Conid{IntAdd}\;\Varid{t}_{1}\;\Varid{t}_{2}){}\<[20]%
	\>[20]{}\mathrel{=}(\Varid{fv}\;\Varid{t}_{1})\plus (\Varid{fv}\;\Varid{t}_{2}){}\<[E]%
	\\
	\>[B]{}\Varid{fv}\;(\Conid{IntSub}\;\Varid{t}_{1}\;\Varid{t}_{2}){}\<[20]%
	\>[20]{}\mathrel{=}(\Varid{fv}\;\Varid{t}_{1})\plus (\Varid{fv}\;\Varid{t}_{2}){}\<[E]%
	\\
	\>[B]{}\Varid{fv}\;(\Conid{IntMul}\;\Varid{t}_{1}\;\Varid{t}_{2}){}\<[20]%
	\>[20]{}\mathrel{=}(\Varid{fv}\;\Varid{t}_{1})\plus (\Varid{fv}\;\Varid{t}_{2}){}\<[E]%
	\\
	\>[B]{}\Varid{fv}\;(\Conid{IntDiv}\;\Varid{t}_{1}\;\Varid{t}_{2}){}\<[20]%
	\>[20]{}\mathrel{=}(\Varid{fv}\;\Varid{t}_{1})\plus (\Varid{fv}\;\Varid{t}_{2}){}\<[E]%
	\\
	\>[B]{}\Varid{fv}\;(\Conid{IntNand}\;\Varid{t}_{1}\;\Varid{t}_{2})\mathrel{=}(\Varid{fv}\;\Varid{t}_{1})\plus (\Varid{fv}\;\Varid{t}_{2}){}\<[E]%
	\\
	\>[B]{}\Varid{fv}\;(\Conid{IntEq}\;\Varid{t}_{1}\;\Varid{t}_{2}){}\<[20]%
	\>[20]{}\mathrel{=}(\Varid{fv}\;\Varid{t}_{1})\plus (\Varid{fv}\;\Varid{t}_{2}){}\<[E]%
	\\
	\>[B]{}\Varid{fv}\;(\Conid{IntLt}\;\Varid{t}_{1}\;\Varid{t}_{2}){}\<[20]%
	\>[20]{}\mathrel{=}(\Varid{fv}\;\Varid{t}_{1})\plus (\Varid{fv}\;\Varid{t}_{2}){}\<[E]%
	\\
	\>[B]{}\Varid{fv}\;(\Conid{Fix}\;\Varid{t}){}\<[20]%
	\>[20]{}\mathrel{=}\Varid{fv}\;\Varid{t}{}\<[E]%
	\\
	\>[B]{}\Varid{fv}\;(\Conid{Let}\;\Varid{x}\;\Varid{t}_{1}\;\Varid{t}_{2}){}\<[20]%
	\>[20]{}\mathrel{=}(\Varid{fv}\;\Varid{t}_{1})\plus [\mskip1.5mu \Varid{y}\mid \Varid{y}\leftarrow (\Varid{fv}\;\Varid{t}_{2}),\Varid{x}\not\equiv \Varid{y}\mskip1.5mu]{}\<[E]%
	\\
	\>[B]{}\Varid{fv}\;\anonymous {}\<[20]%
	\>[20]{}\mathrel{=}[\mskip1.5mu \mskip1.5mu]{}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\mbox{\onelinecomment  Checking the free variables prevents overwriting an inner abstraction }{}\<[E]%
	\\
	\>[B]{}\mbox{\onelinecomment  variable name when that variable is set from its innermost lambda}{}\<[E]%
	\\
	\>[B]{}\Varid{subst}\mathbin{::}\Conid{Var}\to \Conid{Term}\to \Conid{Term}\to \Conid{Term}{}\<[E]%
	\\
	\>[B]{}\Varid{subst}\;\Varid{x}\;\Varid{s}\;\Varid{t}\mathrel{=}\mathbf{if}\;(\Varid{elem}\;\Varid{x}\;(\Varid{fv}\;\Varid{t}))\;\mathbf{then}\;\Varid{subHelper}\;\Varid{x}\;\Varid{s}\;\Varid{t}\;\mathbf{else}\;\Varid{t}{}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\mbox{\onelinecomment  Abs case already checked for free variables,}{}\<[E]%
	\\
	\>[B]{}\Varid{subHelper}\mathbin{::}\Conid{Var}\to \Conid{Term}\to \Conid{Term}\to \Conid{Term}{}\<[E]%
	\\
	\>[B]{}\Varid{subHelper}\;\Varid{x}\;\Varid{s}\;(\Conid{Var}\;\Varid{y}){}\<[30]%
	\>[30]{}\mathrel{=}\mathbf{if}\;(\Varid{y}\equiv \Varid{x})\;\mathbf{then}\;\Varid{s}\;\mathbf{else}\;(\Conid{Var}\;\Varid{y}){}\<[E]%
	\\
	\>[B]{}\Varid{subHelper}\;\Varid{x}\;\Varid{s}\;(\Conid{Abs}\;\Varid{y}\;\Varid{tp}\;\Varid{t}){}\<[30]%
	\>[30]{}\mathrel{=}\Conid{Abs}\;\Varid{y}\;\Varid{tp}\;(\Varid{subHelper}\;\Varid{x}\;\Varid{s}\;\Varid{t}){}\<[E]%
	\\
	\>[B]{}\Varid{subHelper}\;\Varid{x}\;\Varid{s}\;(\Conid{App}\;\Varid{t}_{1}\;\Varid{t}_{2}){}\<[30]%
	\>[30]{}\mathrel{=}\Conid{App}\;(\Varid{subst}\;\Varid{x}\;\Varid{s}\;\Varid{t}_{1})\;(\Varid{subst}\;\Varid{x}\;\Varid{s}\;\Varid{t}_{2}){}\<[E]%
	\\
	\>[B]{}\Varid{subHelper}\;\Varid{x}\;\Varid{s}\;(\Conid{If}\;\Varid{t}_{1}\;\Varid{t}_{2}\;\Varid{t}_{3}){}\<[30]%
	\>[30]{}\mathrel{=}\Conid{If}\;(\Varid{subst}\;\Varid{x}\;\Varid{s}\;\Varid{t}_{1})\;(\Varid{subst}\;\Varid{x}\;\Varid{s}\;\Varid{t}_{2})\;(\Varid{subst}\;\Varid{x}\;\Varid{s}\;\Varid{t}_{3}){}\<[E]%
	\\
	\>[B]{}\Varid{subHelper}\;\Varid{x}\;\Varid{s}\;(\Conid{IntAdd}\;\Varid{t}_{1}\;\Varid{t}_{2})\mathrel{=}\Conid{IntAdd}\;(\Varid{subst}\;\Varid{x}\;\Varid{s}\;\Varid{t}_{1})\;(\Varid{subst}\;\Varid{x}\;\Varid{s}\;\Varid{t}_{2}){}\<[E]%
	\\
	\>[B]{}\Varid{subHelper}\;\Varid{x}\;\Varid{s}\;(\Conid{IntSub}\;\Varid{t}_{1}\;\Varid{t}_{2})\mathrel{=}\Conid{IntSub}\;(\Varid{subst}\;\Varid{x}\;\Varid{s}\;\Varid{t}_{1})\;(\Varid{subst}\;\Varid{x}\;\Varid{s}\;\Varid{t}_{2}){}\<[E]%
	\\
	\>[B]{}\Varid{subHelper}\;\Varid{x}\;\Varid{s}\;(\Conid{IntMul}\;\Varid{t}_{1}\;\Varid{t}_{2})\mathrel{=}\Conid{IntMul}\;(\Varid{subst}\;\Varid{x}\;\Varid{s}\;\Varid{t}_{1})\;(\Varid{subst}\;\Varid{x}\;\Varid{s}\;\Varid{t}_{2}){}\<[E]%
	\\
	\>[B]{}\Varid{subHelper}\;\Varid{x}\;\Varid{s}\;(\Conid{IntDiv}\;\Varid{t}_{1}\;\Varid{t}_{2})\mathrel{=}\Conid{IntDiv}\;(\Varid{subst}\;\Varid{x}\;\Varid{s}\;\Varid{t}_{1})\;(\Varid{subst}\;\Varid{x}\;\Varid{s}\;\Varid{t}_{2}){}\<[E]%
	\\
	\>[B]{}\Varid{subHelper}\;\Varid{x}\;\Varid{s}\;(\Conid{IntNand}\;\Varid{t}_{1}\;\Varid{t}_{2})\mathrel{=}\Conid{IntNand}\;(\Varid{subst}\;\Varid{x}\;\Varid{s}\;\Varid{t}_{1})\;(\Varid{subst}\;\Varid{x}\;\Varid{s}\;\Varid{t}_{2}){}\<[E]%
	\\
	\>[B]{}\Varid{subHelper}\;\Varid{x}\;\Varid{s}\;(\Conid{IntEq}\;\Varid{t}_{1}\;\Varid{t}_{2}){}\<[30]%
	\>[30]{}\mathrel{=}\Conid{IntEq}\;(\Varid{subst}\;\Varid{x}\;\Varid{s}\;\Varid{t}_{1})\;(\Varid{subst}\;\Varid{x}\;\Varid{s}\;\Varid{t}_{2}){}\<[E]%
	\\
	\>[B]{}\Varid{subHelper}\;\Varid{x}\;\Varid{s}\;(\Conid{IntLt}\;\Varid{t}_{1}\;\Varid{t}_{2}){}\<[30]%
	\>[30]{}\mathrel{=}\Conid{IntLt}\;(\Varid{subst}\;\Varid{x}\;\Varid{s}\;\Varid{t}_{1})\;(\Varid{subst}\;\Varid{x}\;\Varid{s}\;\Varid{t}_{2}){}\<[E]%
	\\
	\>[B]{}\Varid{subHelper}\;\Varid{x}\;\Varid{s}\;(\Conid{ParTerm}\;\Varid{t}){}\<[30]%
	\>[30]{}\mathrel{=}\Conid{ParTerm}\;(\Varid{subHelper}\;\Varid{x}\;\Varid{s}\;\Varid{t}){}\<[E]%
	\\
	\>[B]{}\Varid{subHelper}\;\Varid{x}\;\Varid{s}\;(\Conid{Fix}\;\Varid{t}){}\<[30]%
	\>[30]{}\mathrel{=}\Conid{Fix}\;(\Varid{subHelper}\;\Varid{x}\;\Varid{s}\;\Varid{t}){}\<[E]%
	\\
	\>[B]{}\Varid{subHelper}\;\Varid{x}\;\Varid{s}\;(\Conid{Let}\;\Varid{y}\;\Varid{t}_{1}\;\Varid{t}_{2}){}\<[30]%
	\>[30]{}\mathrel{=}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{Let}\;\Varid{y}\;(\Varid{subst}\;\Varid{x}\;\Varid{s}\;\Varid{t}_{1})\;(\mathbf{if}\;\Varid{x}\equiv \Varid{y}\;\mathbf{then}\;\Varid{t}_{2}\;\mathbf{else}\;(\Varid{subst}\;\Varid{x}\;\Varid{s}\;\Varid{t}_{2})){}\<[E]%
	\\
	\>[B]{}\Varid{subHelper}\;\anonymous \;\anonymous \;\Varid{z}{}\<[30]%
	\>[30]{}\mathrel{=}\Varid{z}{}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\Varid{isValue}\mathbin{::}\Conid{Term}\to \Conid{Bool}{}\<[E]%
	\\
	\>[B]{}\Varid{isValue}\;(\Conid{Abs}\;\anonymous \;\anonymous \;\anonymous )\mathrel{=}\Conid{True}{}\<[E]%
	\\
	\>[B]{}\Varid{isValue}\;\Conid{Tru}{}\<[21]%
	\>[21]{}\mathrel{=}\Conid{True}{}\<[E]%
	\\
	\>[B]{}\Varid{isValue}\;\Conid{Fls}{}\<[21]%
	\>[21]{}\mathrel{=}\Conid{True}{}\<[E]%
	\\
	\>[B]{}\Varid{isValue}\;(\Conid{IntConst}\;\anonymous )\mathrel{=}\Conid{True}{}\<[E]%
	\\
	\>[B]{}\Varid{isValue}\;\anonymous {}\<[21]%
	\>[21]{}\mathrel{=}\Conid{False}{}\<[E]%
	\ColumnHook
\end{hscode}\resethooks

\horrule{0.5pt} \\[0.2cm]	

\subsubsection*{Updated Structural Operational Semantics}

\noindent This is the code used to express the small-step semantics:\\

\textit{Source Code:}\\
		
\begin{hscode}\SaveRestoreHook
	\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{3}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{5}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{8}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{11}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{14}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{16}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{21}{@{}>{\hspre}c<{\hspost}@{}}%
	\column{21E}{@{}l@{}}%
	\column{23}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{24}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{26}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{27}{@{}>{\hspre}c<{\hspost}@{}}%
	\column{27E}{@{}l@{}}%
	\column{29}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
	\>[B]{}\mathbf{module}\;\Conid{StructuralOperationalSemantics}\;\mathbf{where}{}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\mathbf{import}\;\Conid{\Conid{Data}.List}{}\<[E]%
	\\
	\>[B]{}\mathbf{import}\;\Varid{qualified}\;\Conid{AbstractSyntax}\;\Varid{as}\;\Conid{S}{}\<[E]%
	\\
	\>[B]{}\mathbf{import}\;\Varid{qualified}\;\Conid{IntegerArithmetic}\;\Varid{as}\;\Conid{I}{}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\Varid{termToInt}\mathbin{::}\Conid{\Conid{S}.Term}\to \Conid{Integer}{}\<[E]%
	\\
	\>[B]{}\Varid{termToInt}\;(\Conid{\Conid{S}.IntConst}\;\Varid{x})\mathrel{=}\Varid{x}{}\<[E]%
	\\
	\>[B]{}\Varid{termToInt}\;\anonymous {}\<[26]%
	\>[26]{}\mathrel{=}\Varid{error}\;(\text{\tt \char34 Non~integer~in~arithmetic~application\char34}){}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\Varid{justVal}\mathbin{::}\Conid{Maybe}\;\Conid{\Conid{S}.Term}\to \Conid{\Conid{S}.Term}{}\<[E]%
	\\
	\>[B]{}\Varid{justVal}\;(\Conid{Just}\;\Varid{x})\mathrel{=}\Varid{x}{}\<[E]%
	\\
	\>[B]{}\Varid{justVal}\;\anonymous \mathrel{=}\Varid{error}\;(\text{\tt \char34 incorrect~use~of~justVal\char34}){}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\Varid{eval1}\mathbin{::}\Conid{\Conid{S}.Term}\to \Conid{Maybe}\;\Conid{\Conid{S}.Term}{}\<[E]%
	\\
	\>[B]{}\Varid{eval1}\;\Varid{t}\mathrel{=}\mathbf{case}\;\Varid{t}\;\mathbf{of}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.App}\;(\Conid{\Conid{S}.Abs}\;\Varid{x}\;\tau_{11}\;\Varid{t}_{12})\;\Varid{t}_{2}{}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\mid {}\<[8]%
	\>[8]{}\Varid{\Conid{S}.isValue}\;\Varid{t}_{2}\to \Conid{Just}\;(\Varid{\Conid{S}.subst}\;\Varid{x}\;\Varid{t}_{2}\;\Varid{t}_{12}){}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\mid {}\<[8]%
	\>[8]{}\Varid{otherwise}{}\<[21]%
	\>[21]{}\to {}\<[21E]%
	\\
	\>[8]{}\mathbf{let}\;\Varid{newT2}\mathrel{=}(\Varid{eval1}\;\Varid{t}_{2}){}\<[E]%
	\\
	\>[8]{}\hsindent{3}{}\<[11]%
	\>[11]{}\mathbf{in}\;\mathbf{if}\;(\Varid{newT2}\equiv \Conid{Nothing})\;\mathbf{then}\;\Conid{Nothing}{}\<[E]%
	\\
	\>[11]{}\hsindent{3}{}\<[14]%
	\>[14]{}\mathbf{else}\;\Conid{Just}\;(\Conid{\Conid{S}.App}\;(\Conid{\Conid{S}.Abs}\;\Varid{x}\;\tau_{11}\;\Varid{t}_{12})\;(\Varid{justVal}\;\Varid{newT2})){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.App}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\mid {}\<[8]%
	\>[8]{}\Varid{\Conid{S}.isValue}\;\Varid{t}_{1}\to \Conid{Nothing}{}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\mid {}\<[8]%
	\>[8]{}\Varid{otherwise}\to \mathbf{let}\;\Varid{newT1}\mathrel{=}(\Varid{eval1}\;\Varid{t}_{1}){}\<[E]%
	\\
	\>[8]{}\hsindent{16}{}\<[24]%
	\>[24]{}\mathbf{in}\;\mathbf{if}\;(\Varid{newT1}\equiv \Conid{Nothing})\;\mathbf{then}\;\Conid{Nothing}{}\<[E]%
	\\
	\>[24]{}\hsindent{5}{}\<[29]%
	\>[29]{}\mathbf{else}\;\Conid{Just}\;(\Conid{\Conid{S}.App}\;(\Varid{justVal}\;\Varid{newT1})\;\Varid{t}_{2}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.If}\;\Varid{t}_{1}\;\Varid{t}_{2}\;\Varid{t}_{3}{}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\mid {}\<[8]%
	\>[8]{}\neg \;(\Varid{\Conid{S}.isValue}\;\Varid{t}_{1})\to {}\<[E]%
	\\
	\>[8]{}\mathbf{let}\;\Varid{newT1}\mathrel{=}(\Varid{eval1}\;\Varid{t}_{1}){}\<[E]%
	\\
	\>[8]{}\hsindent{3}{}\<[11]%
	\>[11]{}\mathbf{in}\;\mathbf{if}\;(\Varid{newT1}\equiv \Conid{Nothing})\;\mathbf{then}\;\Conid{Nothing}{}\<[E]%
	\\
	\>[11]{}\hsindent{3}{}\<[14]%
	\>[14]{}\mathbf{else}\;\Conid{Just}\;(\Conid{\Conid{S}.If}\;(\Varid{justVal}\;\Varid{newT1})\;\Varid{t}_{2}\;\Varid{t}_{3}){}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\mid {}\<[8]%
	\>[8]{}\Varid{t}_{1}\equiv \Conid{\Conid{S}.Tru}\to \Conid{Just}\;\Varid{t}_{2}{}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\mid {}\<[8]%
	\>[8]{}\Varid{t}_{1}\equiv \Conid{\Conid{S}.Fls}\to \Conid{Just}\;\Varid{t}_{3}{}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\mid {}\<[8]%
	\>[8]{}\Varid{otherwise}\to \Conid{Nothing}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.Fix}\;(\Conid{\Conid{S}.Abs}\;\Varid{x}\;\Varid{y}\;\Varid{t}_{1})\to \Conid{Just}\;(\Varid{\Conid{S}.subst}\;\Varid{x}\;(\Conid{\Conid{S}.Fix}\;(\Conid{\Conid{S}.Abs}\;\Varid{x}\;\Varid{y}\;\Varid{t}_{1}))\;\Varid{t}_{1}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.Fix}\;\Varid{t}\to \mathbf{if}\;((\Varid{eval1}\;\Varid{t})\equiv \Conid{Nothing})\;\mathbf{then}\;\Conid{Nothing}{}\<[E]%
	\\
	\>[3]{}\hsindent{11}{}\<[14]%
	\>[14]{}\mathbf{else}\;\Conid{Just}\;(\Conid{\Conid{S}.Fix}\;(\Varid{justVal}\;(\Varid{eval1}\;\Varid{t}))){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.Let}\;\Varid{x}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\mid \Varid{\Conid{S}.isValue}\;\Varid{t}_{1}\to \Conid{Just}\;(\Varid{\Conid{S}.subst}\;\Varid{x}\;\Varid{t}_{1}\;\Varid{t}_{2}){}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\mid \Varid{otherwise}\to \mathbf{let}\;\Varid{newT1}\mathrel{=}(\Varid{eval1}\;\Varid{t}_{1}){}\<[E]%
	\\
	\>[5]{}\hsindent{19}{}\<[24]%
	\>[24]{}\mathbf{in}\;\mathbf{if}\;(\Varid{newT1}\equiv \Conid{Nothing})\;\mathbf{then}\;\Conid{Nothing}{}\<[E]%
	\\
	\>[24]{}\hsindent{5}{}\<[29]%
	\>[29]{}\mathbf{else}\;\Conid{Just}\;(\Conid{\Conid{S}.Let}\;\Varid{x}\;(\Varid{justVal}\;\Varid{newT1})\;\Varid{t}_{2}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.IntAdd}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\mid {}\<[8]%
	\>[8]{}\neg \;(\Varid{\Conid{S}.isValue}\;\Varid{t}_{1}){}\<[27]%
	\>[27]{}\to {}\<[27E]%
	\\
	\>[8]{}\mathbf{let}\;\Varid{newT1}\mathrel{=}(\Varid{eval1}\;\Varid{t}_{1}){}\<[E]%
	\\
	\>[8]{}\hsindent{3}{}\<[11]%
	\>[11]{}\mathbf{in}\;\mathbf{if}\;(\Varid{newT1}\equiv \Conid{Nothing})\;\mathbf{then}\;\Conid{Nothing}{}\<[E]%
	\\
	\>[11]{}\hsindent{3}{}\<[14]%
	\>[14]{}\mathbf{else}\;\Conid{Just}\;(\Conid{\Conid{S}.IntAdd}\;(\Varid{justVal}\;\Varid{newT1})\;\Varid{t}_{2}){}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\mid {}\<[8]%
	\>[8]{}\neg \;(\Varid{\Conid{S}.isValue}\;\Varid{t}_{2}){}\<[27]%
	\>[27]{}\to {}\<[27E]%
	\\
	\>[8]{}\mathbf{let}\;\Varid{newT2}\mathrel{=}(\Varid{eval1}\;\Varid{t}_{2}){}\<[E]%
	\\
	\>[8]{}\hsindent{3}{}\<[11]%
	\>[11]{}\mathbf{in}\;\mathbf{if}\;(\Varid{newT2}\equiv \Conid{Nothing})\;\mathbf{then}\;\Conid{Nothing}{}\<[E]%
	\\
	\>[11]{}\hsindent{3}{}\<[14]%
	\>[14]{}\mathbf{else}\;\Conid{Just}\;(\Conid{\Conid{S}.IntAdd}\;\Varid{t}_{1}\;(\Varid{justVal}\;\Varid{newT2})){}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\mid {}\<[8]%
	\>[8]{}\Varid{otherwise}\to \Conid{Just}\;(\Conid{\Conid{S}.IntConst}\;(\Varid{\Conid{I}.intAdd}\;(\Varid{termToInt}\;\Varid{t}_{1})\;(\Varid{termToInt}\;\Varid{t}_{2}))){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.IntSub}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\mid {}\<[8]%
	\>[8]{}\neg \;(\Varid{\Conid{S}.isValue}\;\Varid{t}_{1}){}\<[27]%
	\>[27]{}\to {}\<[27E]%
	\\
	\>[8]{}\mathbf{let}\;\Varid{newT1}\mathrel{=}(\Varid{eval1}\;\Varid{t}_{1}){}\<[E]%
	\\
	\>[8]{}\hsindent{3}{}\<[11]%
	\>[11]{}\mathbf{in}\;\mathbf{if}\;(\Varid{newT1}\equiv \Conid{Nothing})\;\mathbf{then}\;\Conid{Nothing}{}\<[E]%
	\\
	\>[11]{}\hsindent{3}{}\<[14]%
	\>[14]{}\mathbf{else}\;\Conid{Just}\;(\Conid{\Conid{S}.IntSub}\;(\Varid{justVal}\;\Varid{newT1})\;\Varid{t}_{2}){}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\mid {}\<[8]%
	\>[8]{}\neg \;(\Varid{\Conid{S}.isValue}\;\Varid{t}_{2}){}\<[27]%
	\>[27]{}\to {}\<[27E]%
	\\
	\>[8]{}\mathbf{let}\;\Varid{newT2}\mathrel{=}(\Varid{eval1}\;\Varid{t}_{2}){}\<[E]%
	\\
	\>[8]{}\hsindent{3}{}\<[11]%
	\>[11]{}\mathbf{in}\;\mathbf{if}\;(\Varid{newT2}\equiv \Conid{Nothing})\;\mathbf{then}\;\Conid{Nothing}{}\<[E]%
	\\
	\>[11]{}\hsindent{3}{}\<[14]%
	\>[14]{}\mathbf{else}\;\Conid{Just}\;(\Conid{\Conid{S}.IntSub}\;\Varid{t}_{1}\;(\Varid{justVal}\;\Varid{newT2})){}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\mid {}\<[8]%
	\>[8]{}\Varid{otherwise}\to \Conid{Just}\;(\Conid{\Conid{S}.IntConst}\;(\Varid{\Conid{I}.intSub}\;(\Varid{termToInt}\;\Varid{t}_{1})\;(\Varid{termToInt}\;\Varid{t}_{2}))){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.IntMul}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\mid {}\<[8]%
	\>[8]{}\neg \;(\Varid{\Conid{S}.isValue}\;\Varid{t}_{1}){}\<[27]%
	\>[27]{}\to {}\<[27E]%
	\\
	\>[8]{}\mathbf{let}\;\Varid{newT1}\mathrel{=}(\Varid{eval1}\;\Varid{t}_{1}){}\<[E]%
	\\
	\>[8]{}\hsindent{3}{}\<[11]%
	\>[11]{}\mathbf{in}\;\mathbf{if}\;(\Varid{newT1}\equiv \Conid{Nothing})\;\mathbf{then}\;\Conid{Nothing}{}\<[E]%
	\\
	\>[11]{}\hsindent{3}{}\<[14]%
	\>[14]{}\mathbf{else}\;\Conid{Just}\;(\Conid{\Conid{S}.IntMul}\;(\Varid{justVal}\;\Varid{newT1})\;\Varid{t}_{2}){}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\mid {}\<[8]%
	\>[8]{}\neg \;(\Varid{\Conid{S}.isValue}\;\Varid{t}_{2}){}\<[27]%
	\>[27]{}\to {}\<[27E]%
	\\
	\>[8]{}\mathbf{let}\;\Varid{newT2}\mathrel{=}(\Varid{eval1}\;\Varid{t}_{2}){}\<[E]%
	\\
	\>[8]{}\hsindent{3}{}\<[11]%
	\>[11]{}\mathbf{in}\;\mathbf{if}\;(\Varid{newT2}\equiv \Conid{Nothing})\;\mathbf{then}\;\Conid{Nothing}{}\<[E]%
	\\
	\>[11]{}\hsindent{3}{}\<[14]%
	\>[14]{}\mathbf{else}\;\Conid{Just}\;(\Conid{\Conid{S}.IntMul}\;\Varid{t}_{1}\;(\Varid{justVal}\;\Varid{newT2})){}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\mid {}\<[8]%
	\>[8]{}\Varid{otherwise}\to \Conid{Just}\;(\Conid{\Conid{S}.IntConst}\;(\Varid{\Conid{I}.intMul}\;(\Varid{termToInt}\;\Varid{t}_{1})\;(\Varid{termToInt}\;\Varid{t}_{2}))){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.IntDiv}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\mid {}\<[8]%
	\>[8]{}\neg \;(\Varid{\Conid{S}.isValue}\;\Varid{t}_{1}){}\<[27]%
	\>[27]{}\to {}\<[27E]%
	\\
	\>[8]{}\mathbf{let}\;\Varid{newT1}\mathrel{=}(\Varid{eval1}\;\Varid{t}_{1}){}\<[E]%
	\\
	\>[8]{}\hsindent{3}{}\<[11]%
	\>[11]{}\mathbf{in}\;\mathbf{if}\;(\Varid{newT1}\equiv \Conid{Nothing})\;\mathbf{then}\;\Conid{Nothing}{}\<[E]%
	\\
	\>[11]{}\hsindent{3}{}\<[14]%
	\>[14]{}\mathbf{else}\;\Conid{Just}\;(\Conid{\Conid{S}.IntDiv}\;(\Varid{justVal}\;\Varid{newT1})\;\Varid{t}_{2}){}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\mid {}\<[8]%
	\>[8]{}\neg \;(\Varid{\Conid{S}.isValue}\;\Varid{t}_{2}){}\<[27]%
	\>[27]{}\to {}\<[27E]%
	\\
	\>[8]{}\mathbf{let}\;\Varid{newT2}\mathrel{=}(\Varid{eval1}\;\Varid{t}_{2}){}\<[E]%
	\\
	\>[8]{}\hsindent{3}{}\<[11]%
	\>[11]{}\mathbf{in}\;\mathbf{if}\;(\Varid{newT2}\equiv \Conid{Nothing})\;\mathbf{then}\;\Conid{Nothing}{}\<[E]%
	\\
	\>[11]{}\hsindent{3}{}\<[14]%
	\>[14]{}\mathbf{else}\;\Conid{Just}\;(\Conid{\Conid{S}.IntDiv}\;\Varid{t}_{1}\;(\Varid{justVal}\;\Varid{newT2})){}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\mid {}\<[8]%
	\>[8]{}\Varid{otherwise}\to \Conid{Just}\;(\Conid{\Conid{S}.IntConst}\;(\Varid{\Conid{I}.intDiv}\;(\Varid{termToInt}\;\Varid{t}_{1})\;(\Varid{termToInt}\;\Varid{t}_{2}))){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.IntNand}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\mid {}\<[8]%
	\>[8]{}\neg \;(\Varid{\Conid{S}.isValue}\;\Varid{t}_{1}){}\<[27]%
	\>[27]{}\to {}\<[27E]%
	\\
	\>[8]{}\mathbf{let}\;\Varid{newT1}\mathrel{=}(\Varid{eval1}\;\Varid{t}_{1}){}\<[E]%
	\\
	\>[8]{}\hsindent{3}{}\<[11]%
	\>[11]{}\mathbf{in}\;\mathbf{if}\;(\Varid{newT1}\equiv \Conid{Nothing})\;\mathbf{then}\;\Conid{Nothing}{}\<[E]%
	\\
	\>[11]{}\hsindent{3}{}\<[14]%
	\>[14]{}\mathbf{else}\;\Conid{Just}\;(\Conid{\Conid{S}.IntNand}\;(\Varid{justVal}\;\Varid{newT1})\;\Varid{t}_{2}){}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\mid {}\<[8]%
	\>[8]{}\neg \;(\Varid{\Conid{S}.isValue}\;\Varid{t}_{2}){}\<[27]%
	\>[27]{}\to {}\<[27E]%
	\\
	\>[8]{}\mathbf{let}\;\Varid{newT2}\mathrel{=}(\Varid{eval1}\;\Varid{t}_{2}){}\<[E]%
	\\
	\>[8]{}\hsindent{3}{}\<[11]%
	\>[11]{}\mathbf{in}\;\mathbf{if}\;(\Varid{newT2}\equiv \Conid{Nothing})\;\mathbf{then}\;\Conid{Nothing}{}\<[E]%
	\\
	\>[11]{}\hsindent{3}{}\<[14]%
	\>[14]{}\mathbf{else}\;\Conid{Just}\;(\Conid{\Conid{S}.IntNand}\;\Varid{t}_{1}\;(\Varid{justVal}\;\Varid{newT2})){}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\mid {}\<[8]%
	\>[8]{}\Varid{otherwise}\to \Conid{Just}\;(\Conid{\Conid{S}.IntConst}\;(\Varid{\Conid{I}.intNand}\;(\Varid{termToInt}\;\Varid{t}_{1})\;(\Varid{termToInt}\;\Varid{t}_{2}))){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.IntEq}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\mid {}\<[8]%
	\>[8]{}\neg \;(\Varid{\Conid{S}.isValue}\;\Varid{t}_{1}){}\<[27]%
	\>[27]{}\to {}\<[27E]%
	\\
	\>[8]{}\mathbf{let}\;\Varid{newT1}\mathrel{=}(\Varid{eval1}\;\Varid{t}_{1}){}\<[E]%
	\\
	\>[8]{}\hsindent{3}{}\<[11]%
	\>[11]{}\mathbf{in}\;\mathbf{if}\;(\Varid{newT1}\equiv \Conid{Nothing})\;\mathbf{then}\;\Conid{Nothing}{}\<[E]%
	\\
	\>[11]{}\hsindent{3}{}\<[14]%
	\>[14]{}\mathbf{else}\;\Conid{Just}\;(\Conid{\Conid{S}.IntEq}\;(\Varid{justVal}\;\Varid{newT1})\;\Varid{t}_{2}){}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\mid {}\<[8]%
	\>[8]{}\neg \;(\Varid{\Conid{S}.isValue}\;\Varid{t}_{2}){}\<[27]%
	\>[27]{}\to {}\<[27E]%
	\\
	\>[8]{}\mathbf{let}\;\Varid{newT2}\mathrel{=}(\Varid{eval1}\;\Varid{t}_{2}){}\<[E]%
	\\
	\>[8]{}\hsindent{3}{}\<[11]%
	\>[11]{}\mathbf{in}\;\mathbf{if}\;(\Varid{newT2}\equiv \Conid{Nothing})\;\mathbf{then}\;\Conid{Nothing}{}\<[E]%
	\\
	\>[11]{}\hsindent{3}{}\<[14]%
	\>[14]{}\mathbf{else}\;\Conid{Just}\;(\Conid{\Conid{S}.IntEq}\;\Varid{t}_{1}\;(\Varid{justVal}\;\Varid{newT2})){}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\mid {}\<[8]%
	\>[8]{}\Varid{otherwise}\to \mathbf{if}\;(\Varid{\Conid{I}.intEq}\;(\Varid{termToInt}\;\Varid{t}_{1})\;(\Varid{termToInt}\;\Varid{t}_{2})){}\<[E]%
	\\
	\>[8]{}\hsindent{15}{}\<[23]%
	\>[23]{}\mathbf{then}\;\Conid{Just}\;\Conid{\Conid{S}.Tru}\;\mathbf{else}\;\Conid{Just}\;\Conid{\Conid{S}.Fls}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.IntLt}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\mid {}\<[8]%
	\>[8]{}\neg \;(\Varid{\Conid{S}.isValue}\;\Varid{t}_{1}){}\<[27]%
	\>[27]{}\to {}\<[27E]%
	\\
	\>[8]{}\mathbf{let}\;\Varid{newT1}\mathrel{=}(\Varid{eval1}\;\Varid{t}_{1}){}\<[E]%
	\\
	\>[8]{}\hsindent{3}{}\<[11]%
	\>[11]{}\mathbf{in}\;\mathbf{if}\;(\Varid{newT1}\equiv \Conid{Nothing})\;\mathbf{then}\;\Conid{Nothing}{}\<[E]%
	\\
	\>[11]{}\hsindent{3}{}\<[14]%
	\>[14]{}\mathbf{else}\;\Conid{Just}\;(\Conid{\Conid{S}.IntLt}\;(\Varid{justVal}\;\Varid{newT1})\;\Varid{t}_{2}){}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\mid {}\<[8]%
	\>[8]{}\neg \;(\Varid{\Conid{S}.isValue}\;\Varid{t}_{2}){}\<[27]%
	\>[27]{}\to {}\<[27E]%
	\\
	\>[8]{}\mathbf{let}\;\Varid{newT2}\mathrel{=}(\Varid{eval1}\;\Varid{t}_{2}){}\<[E]%
	\\
	\>[8]{}\hsindent{3}{}\<[11]%
	\>[11]{}\mathbf{in}\;\mathbf{if}\;(\Varid{newT2}\equiv \Conid{Nothing})\;\mathbf{then}\;\Conid{Nothing}{}\<[E]%
	\\
	\>[11]{}\hsindent{3}{}\<[14]%
	\>[14]{}\mathbf{else}\;\Conid{Just}\;(\Conid{\Conid{S}.IntLt}\;\Varid{t}_{1}\;(\Varid{justVal}\;\Varid{newT2})){}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\mid {}\<[8]%
	\>[8]{}\Varid{otherwise}\to \mathbf{if}\;(\Varid{\Conid{I}.intLt}\;(\Varid{termToInt}\;\Varid{t}_{1})\;(\Varid{termToInt}\;\Varid{t}_{2})){}\<[E]%
	\\
	\>[8]{}\hsindent{15}{}\<[23]%
	\>[23]{}\mathbf{then}\;\Conid{Just}\;\Conid{\Conid{S}.Tru}\;\mathbf{else}\;\Conid{Just}\;\Conid{\Conid{S}.Fls}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.ParTerm}\;\Varid{t}{}\<[16]%
	\>[16]{}\to (\Varid{eval1}\;\Varid{t}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.Tru}{}\<[16]%
	\>[16]{}\to \Conid{Nothing}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.Fls}{}\<[16]%
	\>[16]{}\to \Conid{Nothing}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.IntConst}\;\anonymous \to \Conid{Nothing}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.Var}\;\anonymous {}\<[16]%
	\>[16]{}\to \Conid{Nothing}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.Abs}\;\anonymous \;\anonymous \;\anonymous {}\<[16]%
	\>[16]{}\to \Conid{Nothing}{}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\Varid{eval}\mathbin{::}\Conid{\Conid{S}.Term}\to \Conid{\Conid{S}.Term}{}\<[E]%
	\\
	\>[B]{}\Varid{eval}\;\Varid{t}\mathrel{=}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\mathbf{case}\;\Varid{eval1}\;\Varid{t}\;\mathbf{of}{}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\Conid{Just}\;\Varid{t'}\to \Varid{eval}\;\Varid{t'}{}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\Conid{Nothing}\to \Varid{t}{}\<[E]%
	\ColumnHook
\end{hscode}\resethooks


\subsubsection*{Updated Natural Semantics}

\noindent The natural semantics are very similar to the structural operational semantics, but instead of using single step evaluation, it uses big step evaluation to allow for terms to be reduced without returning the program to the root of the evaluation tree. Effectively natural semantics allow for evaluation to occur nearby to where the most work has been done.  We implemented the following code for Natural Semantics:\\
		
\textit{Source Code:}\\
		
		\begin{hscode}\SaveRestoreHook
			\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
			\column{3}{@{}>{\hspre}l<{\hspost}@{}}%
			\column{6}{@{}>{\hspre}l<{\hspost}@{}}%
			\column{9}{@{}>{\hspre}l<{\hspost}@{}}%
			\column{10}{@{}>{\hspre}l<{\hspost}@{}}%
			\column{26}{@{}>{\hspre}c<{\hspost}@{}}%
			\column{26E}{@{}l@{}}%
			\column{28}{@{}>{\hspre}l<{\hspost}@{}}%
			\column{31}{@{}>{\hspre}l<{\hspost}@{}}%
			\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
			\>[B]{}\mathbf{module}\;\Conid{NaturalSemantics}\;\mathbf{where}{}\<[E]%
			\\
			\>[B]{}\mathbf{import}\;\Conid{\Conid{Data}.List}{}\<[E]%
			\\
			\>[B]{}\mathbf{import}\;\Varid{qualified}\;\Conid{AbstractSyntax}\;\Varid{as}\;\Conid{S}{}\<[E]%
			\\
			\>[B]{}\mathbf{import}\;\Varid{qualified}\;\Conid{IntegerArithmetic}\;\Varid{as}\;\Conid{I}{}\<[E]%
			\\[\blanklineskip]%
			\>[B]{}\Varid{eval}\mathbin{::}\Conid{\Conid{S}.Term}\to \Conid{\Conid{S}.Term}{}\<[E]%
			\\
			\>[B]{}\Varid{eval}\;\Varid{t}\mathrel{=}\mathbf{if}\;(\Varid{\Conid{S}.isValue}\;\Varid{t})\;\mathbf{then}\;\Varid{t}{}\<[E]%
			\\
			\>[B]{}\hsindent{10}{}\<[10]%
			\>[10]{}\mathbf{else}\;\Varid{evalPattern}\;\Varid{t}{}\<[E]%
			\\[\blanklineskip]%
			\>[B]{}\Varid{evalPattern}\mathbin{::}\Conid{\Conid{S}.Term}\to \Conid{\Conid{S}.Term}{}\<[E]%
			\\
			\>[B]{}\Varid{evalPattern}\;(\Conid{\Conid{S}.ParTerm}\;\Varid{t}){}\<[31]%
			\>[31]{}\mathrel{=}\Varid{eval}\;\Varid{t}{}\<[E]%
			\\
			\>[B]{}\Varid{evalPattern}\;(\Conid{\Conid{S}.If}\;\Varid{t}_{1}\;\Varid{t}_{2}\;\Varid{t}_{3}){}\<[31]%
			\>[31]{}\mathrel{=}\mathbf{if}\;((\Varid{eval}\;\Varid{t}_{1})\equiv \Conid{\Conid{S}.Tru})\;\mathbf{then}\;\Varid{eval}\;\Varid{t}_{2}\;\mathbf{else}\;\Varid{eval}\;\Varid{t}_{3}{}\<[E]%
			\\
			\>[B]{}\Varid{evalPattern}\;(\Conid{\Conid{S}.App}\;\Varid{t}_{1}\;\Varid{t}_{2}){}\<[31]%
			\>[31]{}\mathrel{=}\Varid{appHelp}\;(\Varid{eval}\;\Varid{t}_{1})\;\Varid{t}_{2}{}\<[E]%
			\\
			\>[B]{}\Varid{evalPattern}\;(\Conid{\Conid{S}.Fix}\;\Varid{t}){}\<[31]%
			\>[31]{}\mathrel{=}\Varid{fixHelp}\;(\Varid{eval}\;\Varid{t})\;(\Conid{\Conid{S}.Fix}\;\Varid{t}){}\<[E]%
			\\
			\>[B]{}\Varid{evalPattern}\;(\Conid{\Conid{S}.Let}\;\Varid{x}\;\Varid{t}_{1}\;\Varid{t}_{2}){}\<[31]%
			\>[31]{}\mathrel{=}\Varid{eval}\;(\Varid{\Conid{S}.subst}\;\Varid{x}\;(\Varid{eval}\;\Varid{t}_{1})\;\Varid{t}_{2}){}\<[E]%
			\\
			\>[B]{}\Varid{evalPattern}\;\Varid{x}{}\<[31]%
			\>[31]{}\mathrel{=}\Varid{binaryOp}\;\Varid{x}{}\<[E]%
			\\[\blanklineskip]%
			\>[B]{}\Varid{binaryOp}\mathbin{::}\Conid{\Conid{S}.Term}\to \Conid{\Conid{S}.Term}{}\<[E]%
			\\
			\>[B]{}\Varid{binaryOp}\;(\Conid{\Conid{S}.IntAdd}\;\Varid{t}_{1}\;\Varid{t}_{2}){}\<[28]%
			\>[28]{}\mathrel{=}\Conid{\Conid{S}.IntConst}\;(\Varid{\Conid{I}.intAdd}\;(\Varid{termToInt}\;\Varid{t}_{1})\;(\Varid{termToInt}\;\Varid{t}_{2})){}\<[E]%
			\\
			\>[B]{}\Varid{binaryOp}\;(\Conid{\Conid{S}.IntSub}\;\Varid{t}_{1}\;\Varid{t}_{2}){}\<[28]%
			\>[28]{}\mathrel{=}\Conid{\Conid{S}.IntConst}\;(\Varid{\Conid{I}.intSub}\;(\Varid{termToInt}\;\Varid{t}_{1})\;(\Varid{termToInt}\;\Varid{t}_{2})){}\<[E]%
			\\
			\>[B]{}\Varid{binaryOp}\;(\Conid{\Conid{S}.IntMul}\;\Varid{t}_{1}\;\Varid{t}_{2}){}\<[28]%
			\>[28]{}\mathrel{=}\Conid{\Conid{S}.IntConst}\;(\Varid{\Conid{I}.intMul}\;(\Varid{termToInt}\;\Varid{t}_{1})\;(\Varid{termToInt}\;\Varid{t}_{2})){}\<[E]%
			\\
			\>[B]{}\Varid{binaryOp}\;(\Conid{\Conid{S}.IntDiv}\;\Varid{t}_{1}\;\Varid{t}_{2}){}\<[28]%
			\>[28]{}\mathrel{=}\Conid{\Conid{S}.IntConst}\;(\Varid{\Conid{I}.intDiv}\;(\Varid{termToInt}\;\Varid{t}_{1})\;(\Varid{termToInt}\;\Varid{t}_{2})){}\<[E]%
			\\
			\>[B]{}\Varid{binaryOp}\;(\Conid{\Conid{S}.IntNand}\;\Varid{t}_{1}\;\Varid{t}_{2})\mathrel{=}\Conid{\Conid{S}.IntConst}\;(\Varid{\Conid{I}.intNand}\;(\Varid{termToInt}\;\Varid{t}_{1})\;(\Varid{termToInt}\;\Varid{t}_{2})){}\<[E]%
			\\
			\>[B]{}\Varid{binaryOp}\;(\Conid{\Conid{S}.IntEq}\;\Varid{t}_{1}\;\Varid{t}_{2}){}\<[28]%
			\>[28]{}\mathrel{=}{}\<[E]%
			\\
			\>[B]{}\hsindent{3}{}\<[3]%
			\>[3]{}\mathbf{if}\;(\Varid{\Conid{I}.intEq}\;(\Varid{termToInt}\;\Varid{t}_{1})\;(\Varid{termToInt}\;\Varid{t}_{2}))\;\mathbf{then}\;\Conid{\Conid{S}.Tru}\;\mathbf{else}\;\Conid{\Conid{S}.Fls}{}\<[E]%
			\\
			\>[B]{}\Varid{binaryOp}\;(\Conid{\Conid{S}.IntLt}\;\Varid{t}_{1}\;\Varid{t}_{2}){}\<[28]%
			\>[28]{}\mathrel{=}{}\<[E]%
			\\
			\>[B]{}\hsindent{3}{}\<[3]%
			\>[3]{}\mathbf{if}\;(\Varid{\Conid{I}.intLt}\;(\Varid{termToInt}\;\Varid{t}_{1})\;(\Varid{termToInt}\;\Varid{t}_{2}))\;\mathbf{then}\;\Conid{\Conid{S}.Tru}\;\mathbf{else}\;\Conid{\Conid{S}.Fls}{}\<[E]%
			\\
			\>[B]{}\Varid{binaryOp}\;\Varid{x}{}\<[28]%
			\>[28]{}\mathrel{=}\Varid{x}{}\<[E]%
			\\
			\>[B]{}\mbox{\onelinecomment  Type is not correct so it returns x since it is stuck}{}\<[E]%
			\\[\blanklineskip]%
			\>[B]{}\Varid{appHelp}\mathbin{::}\Conid{\Conid{S}.Term}\to \Conid{\Conid{S}.Term}\to \Conid{\Conid{S}.Term}{}\<[E]%
			\\
			\>[B]{}\Varid{appHelp}\;(\Conid{\Conid{S}.Abs}\;\Varid{x}\;\anonymous \;\Varid{t}_{1})\;\Varid{t}_{2}\mathrel{=}\Varid{eval}\;(\Varid{\Conid{S}.subst}\;\Varid{x}\;(\Varid{eval}\;\Varid{t}_{2})\;\Varid{t}_{1}){}\<[E]%
			\\
			\>[B]{}\Varid{apphelp}\;\Varid{x}\;\Varid{y}\mathrel{=}\Conid{\Conid{S}.App}\;\Varid{x}\;\Varid{y}{}\<[E]%
			\\
			\>[B]{}\mbox{\onelinecomment  Type is not correct so it returns S.App x y since it is stuck}{}\<[E]%
			\\[\blanklineskip]%
			\>[B]{}\mbox{\onelinecomment  Just like apphelp but don't evalute the fix term inside right away}{}\<[E]%
			\\
			\>[B]{}\Varid{fixHelp}\mathbin{::}\Conid{\Conid{S}.Term}\to \Conid{\Conid{S}.Term}\to \Conid{\Conid{S}.Term}{}\<[E]%
			\\
			\>[B]{}\Varid{fixHelp}\;(\Conid{\Conid{S}.Abs}\;\Varid{x}\;\anonymous \;\Varid{t}_{1})\;\Varid{t}_{2}\mathrel{=}\Varid{eval}\;(\Varid{\Conid{S}.subst}\;\Varid{x}\;\Varid{t}_{2}\;\Varid{t}_{1}){}\<[E]%
			\\
			\>[B]{}\Varid{fixHelp}\;\anonymous \;\Varid{x}\mathrel{=}\Varid{x}{}\<[E]%
			\\
			\>[B]{}\mbox{\onelinecomment  Type is not correct so it returns x since it is stuck}{}\<[E]%
			\\[\blanklineskip]%
			\>[B]{}\Varid{termToInt}\mathbin{::}\Conid{\Conid{S}.Term}\to \Conid{Integer}{}\<[E]%
			\\
			\>[B]{}\Varid{termToInt}\;(\Conid{\Conid{S}.IntConst}\;\Varid{x})\mathrel{=}\Varid{x}{}\<[E]%
			\\
			\>[B]{}\Varid{termToInt}\;\Varid{x}{}\<[26]%
			\>[26]{}\mathrel{=}{}\<[26E]%
			\\
			\>[B]{}\hsindent{3}{}\<[3]%
			\>[3]{}\mathbf{let}\;\Varid{newX}\mathrel{=}\Varid{eval}\;\Varid{x}{}\<[E]%
			\\
			\>[3]{}\hsindent{3}{}\<[6]%
			\>[6]{}\mathbf{in}\;\mathbf{if}\;\Varid{x}\not\equiv \Varid{newX}\;\mathbf{then}\;\Varid{termToInt}\;(\Varid{eval}\;\Varid{newX}){}\<[E]%
			\\
			\>[6]{}\hsindent{3}{}\<[9]%
			\>[9]{}\mathbf{else}\;\Varid{error}\;(\text{\tt \char34 Non~integer~in~arithmetic~application\char34}){}\<[E]%
			\ColumnHook
		\end{hscode}\resethooks

\horrule{0.5pt} \\[0.2cm]	
	
\subsubsection*{Integer Arithmetic}

\noindent The code used for the IntegerArithmetic module is identical to that used in Exercise 1.\\

\textit{Source Code:}\\

\begin{hscode}\SaveRestoreHook
	\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{3}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{10}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{13}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{15}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{16}{@{}>{\hspre}c<{\hspost}@{}}%
	\column{16E}{@{}l@{}}%
	\column{19}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
	\>[B]{}\mathbf{module}\;\Conid{IntegerArithmetic}\;\mathbf{where}{}\<[E]%
	\\
	\>[B]{}\mathbf{import}\;\Conid{\Conid{Data}.Bits}{}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\Varid{intRestrictRangeAddMul}\mathbin{::}\Conid{Integer}\to \Conid{Integer}{}\<[E]%
	\\
	\>[B]{}\Varid{intRestrictRangeAddMul}\;\Varid{m}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\mid \Varid{m}\geq \mathrm{0}\mathrel{=}{}\<[15]%
	\>[15]{}\Varid{m}\mathbin{\Varid{`mod`}}\mathrm{4294967296}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\mid \Varid{otherwise}\mathrel{=}\mathbin{-}((\mathbin{-}\Varid{m})\mathbin{\Varid{`mod`}}\mathrm{4294967296}){}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\Varid{intAdd}\mathbin{::}\Conid{Integer}\to \Conid{Integer}\to \Conid{Integer}{}\<[E]%
	\\
	\>[B]{}\Varid{intAdd}\;{}\<[10]%
	\>[10]{}\Varid{m}\;{}\<[13]%
	\>[13]{}\Varid{n}{}\<[16]%
	\>[16]{}\mathrel{=}{}\<[16E]%
	\>[19]{}\Varid{intRestrictRangeAddMul}\;(\Varid{m}\mathbin{+}\Varid{n}){}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\Varid{intSub}\mathbin{::}\Conid{Integer}\to \Conid{Integer}\to \Conid{Integer}{}\<[E]%
	\\
	\>[B]{}\Varid{intSub}\;\Varid{m}\;\Varid{n}\mathrel{=}\Varid{intRestrictRangeAddMul}\;(\Varid{m}\mathbin{-}\Varid{n}){}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\Varid{intMul}\mathbin{::}\Conid{Integer}\to \Conid{Integer}\to \Conid{Integer}{}\<[E]%
	\\
	\>[B]{}\Varid{intMul}\;\Varid{m}\;\Varid{n}\mathrel{=}\Varid{intRestrictRangeAddMul}\;(\Varid{m}\mathbin{*}\Varid{n}){}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\Varid{intDiv}\mathbin{::}\Conid{Integer}\to \Conid{Integer}\to \Conid{Integer}{}\<[E]%
	\\
	\>[B]{}\Varid{intDiv}\;{}\<[10]%
	\>[10]{}\Varid{m}\;{}\<[13]%
	\>[13]{}\Varid{n}{}\<[16]%
	\>[16]{}\mathrel{=}{}\<[16E]%
	\>[19]{}\mathbf{if}\;\Varid{n}\equiv \mathrm{0}\;\mathbf{then}\;\Varid{error}\;\text{\tt \char34 integer~division~by~zero\char34}{}\<[E]%
	\\
	\>[19]{}\mathbf{else}\;\Varid{intRestrictRangeAddMul}\;(\Varid{m}\mathbin{\Varid{`div`}}\Varid{n}){}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\Varid{intNand}\mathbin{::}\Conid{Integer}\to \Conid{Integer}\to \Conid{Integer}{}\<[E]%
	\\
	\>[B]{}\Varid{intNand}\;\Varid{m}\;\Varid{n}\mathrel{=}\Varid{intRestrictRangeAddMul}\;(\Varid{complement}\;(\Varid{m}\mathbin{.\&.}\Varid{n})){}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\Varid{intEq}\mathbin{::}\Conid{Integer}\to \Conid{Integer}\to \Conid{Bool}{}\<[E]%
	\\
	\>[B]{}\Varid{intEq}\;{}\<[10]%
	\>[10]{}\Varid{m}\;{}\<[13]%
	\>[13]{}\Varid{n}{}\<[16]%
	\>[16]{}\mathrel{=}{}\<[16E]%
	\>[19]{}\Varid{m}\equiv \Varid{n}{}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\Varid{intLt}\mathbin{::}\Conid{Integer}\to \Conid{Integer}\to \Conid{Bool}{}\<[E]%
	\\
	\>[B]{}\Varid{intLt}\;{}\<[10]%
	\>[10]{}\Varid{m}\;{}\<[13]%
	\>[13]{}\Varid{n}{}\<[16]%
	\>[16]{}\mathrel{=}{}\<[16E]%
	\>[19]{}\Varid{m}\mathbin{<}\Varid{n}{}\<[E]%
	\ColumnHook
\end{hscode}\resethooks
	
\horrule{0.5pt} \\[0.2cm]		
	
\subsubsection*{Type Checker}

\noindent We used the provided code for type checking for the core lambda language and then extended it for the let and fix operations.\\

\textit{Source Code:}\\

\begin{hscode}\SaveRestoreHook
		\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
		\column{3}{@{}>{\hspre}l<{\hspost}@{}}%
		\column{5}{@{}>{\hspre}l<{\hspost}@{}}%
		\column{15}{@{}>{\hspre}l<{\hspost}@{}}%
		\column{17}{@{}>{\hspre}l<{\hspost}@{}}%
		\column{18}{@{}>{\hspre}l<{\hspost}@{}}%
		\column{20}{@{}>{\hspre}l<{\hspost}@{}}%
		\column{21}{@{}>{\hspre}l<{\hspost}@{}}%
		\column{23}{@{}>{\hspre}l<{\hspost}@{}}%
		\column{24}{@{}>{\hspre}c<{\hspost}@{}}%
		\column{24E}{@{}l@{}}%
		\column{27}{@{}>{\hspre}l<{\hspost}@{}}%
		\column{31}{@{}>{\hspre}c<{\hspost}@{}}%
		\column{31E}{@{}l@{}}%
		\column{34}{@{}>{\hspre}l<{\hspost}@{}}%
		\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
		\>[B]{}\mathbf{module}\;\Conid{Typing}\;\mathbf{where}{}\<[E]%
		\\[\blanklineskip]%
		\>[B]{}\mathbf{import}\;\Conid{\Conid{Data}.Maybe}{}\<[E]%
		\\
		\>[B]{}\mathbf{import}\;\Conid{\Conid{Data}.List}{}\<[E]%
		\\
		\>[B]{}\mathbf{import}\;\Varid{qualified}\;\Conid{AbstractSyntax}\;\Varid{as}\;\Conid{S}{}\<[E]%
		\\[\blanklineskip]%
		\>[B]{}\mathbf{data}\;\Conid{Context}{}\<[15]%
		\>[15]{}\mathrel{=}{}\<[18]%
		\>[18]{}\Conid{Empty}{}\<[E]%
		\\
		\>[15]{}\mid {}\<[18]%
		\>[18]{}\Conid{Bind}\;\Conid{Context}\;\Conid{\Conid{S}.Var}\;\Conid{\Conid{S}.Type}{}\<[E]%
		\\
		\>[15]{}\mathbf{deriving}\;\Conid{Eq}{}\<[E]%
		\\[\blanklineskip]%
		\>[B]{}\mathbf{instance}\;\Conid{Show}\;\Conid{Context}\;\mathbf{where}{}\<[E]%
		\\
		\>[B]{}\hsindent{3}{}\<[3]%
		\>[3]{}\Varid{show}\;\Conid{Empty}{}\<[31]%
		\>[31]{}\mathrel{=}{}\<[31E]%
		\>[34]{}\text{\tt \char34 <>\char34}{}\<[E]%
		\\
		\>[B]{}\hsindent{3}{}\<[3]%
		\>[3]{}\Varid{show}\;(\Conid{Bind}\;\Gamma\;\Varid{x}\;\tau){}\<[31]%
		\>[31]{}\mathrel{=}{}\<[31E]%
		\>[34]{}\Varid{show}\;\Gamma\plus \text{\tt \char34 ,\char34}\plus \Varid{x}\plus \text{\tt \char34 :\char34}\plus \Varid{show}\;\tau{}\<[E]%
		\\[\blanklineskip]%
		\>[B]{}\Varid{contextLookup}\mathbin{::}\Conid{\Conid{S}.Var}\to \Conid{Context}\to \Conid{Maybe}\;\Conid{\Conid{S}.Type}{}\<[E]%
		\\
		\>[B]{}\Varid{contextLookup}\;\Varid{x}\;\Conid{Empty}{}\<[24]%
		\>[24]{}\mathrel{=}{}\<[24E]%
		\>[27]{}\Conid{Nothing}{}\<[E]%
		\\
		\>[B]{}\Varid{contextLookup}\;\Varid{x}\;(\Conid{Bind}\;\Gamma\;\Varid{y}\;\tau){}\<[E]%
		\\
		\>[B]{}\hsindent{3}{}\<[3]%
		\>[3]{}\mid \Varid{x}\equiv \Varid{y}{}\<[17]%
		\>[17]{}\mathrel{=}{}\<[20]%
		\>[20]{}\Conid{Just}\;\tau{}\<[E]%
		\\
		\>[B]{}\hsindent{3}{}\<[3]%
		\>[3]{}\mid \Varid{otherwise}{}\<[17]%
		\>[17]{}\mathrel{=}{}\<[20]%
		\>[20]{}\Varid{contextLookup}\;\Varid{x}\;\Gamma{}\<[E]%
		\\[\blanklineskip]%
		\>[B]{}\Varid{typing}\mathbin{::}\Conid{Context}\to \Conid{\Conid{S}.Term}\to \Conid{Maybe}\;\Conid{\Conid{S}.Type}{}\<[E]%
		\\
		\>[B]{}\Varid{typing}\;\Gamma\;\Varid{t}\mathrel{=}\mathbf{case}\;\Varid{t}\;\mathbf{of}{}\<[E]%
		\\
		\>[B]{}\hsindent{3}{}\<[3]%
		\>[3]{}\Conid{\Conid{S}.Var}\;\Varid{x}\to \Varid{contextLookup}\;\Varid{x}\;\Gamma{}\<[E]%
		\\
		\>[B]{}\hsindent{3}{}\<[3]%
		\>[3]{}\Conid{\Conid{S}.Abs}\;\Varid{x}\;\tau_{1}\;\Varid{t}_{2}\to \mathbf{do}\;\tau_{2}\leftarrow \Varid{typing}\;(\Conid{Bind}\;\Gamma\;\Varid{x}\;\tau_{1})\;\Varid{t}_{2};\Conid{Just}\;(\Conid{\Conid{S}.TypeArrow}\;\tau_{1}\;\tau_{2}){}\<[E]%
		\\
		\>[B]{}\hsindent{3}{}\<[3]%
		\>[3]{}\Conid{\Conid{S}.App}\;\Varid{t}_{1}\;\Varid{t}_{2}\to \mathbf{do}\;\Conid{\Conid{S}.TypeArrow}\;\tau_{11}\;\tau_{12}\leftarrow \Varid{typing}\;\Gamma\;\Varid{t}_{1}{}\<[E]%
		\\
		\>[3]{}\hsindent{18}{}\<[21]%
		\>[21]{}\tau\leftarrow \Varid{typing}\;\Gamma\;\Varid{t}_{2}{}\<[E]%
		\\
		\>[3]{}\hsindent{18}{}\<[21]%
		\>[21]{}\mathbf{if}\;\tau\equiv \tau_{11}\;\mathbf{then}\;\Conid{Just}\;\tau_{12}\;\mathbf{else}\;\Conid{Nothing}{}\<[E]%
		\\
		\>[B]{}\hsindent{3}{}\<[3]%
		\>[3]{}\Conid{\Conid{S}.Tru}\to \Conid{Just}\;\Conid{\Conid{S}.TypeBool}{}\<[E]%
		\\
		\>[B]{}\hsindent{3}{}\<[3]%
		\>[3]{}\Conid{\Conid{S}.Fls}\to \Conid{Just}\;\Conid{\Conid{S}.TypeBool}{}\<[E]%
		\\
		\>[B]{}\hsindent{3}{}\<[3]%
		\>[3]{}\Conid{\Conid{S}.If}\;\Varid{t}_{1}\;\Varid{t}_{2}\;\Varid{t}_{3}\to \mathbf{do}\;\Conid{\Conid{S}.TypeBool}\leftarrow \Varid{typing}\;\Gamma\;\Varid{t}_{1}{}\<[E]%
		\\
		\>[3]{}\hsindent{20}{}\<[23]%
		\>[23]{}\tau\leftarrow \Varid{typing}\;\Gamma\;\Varid{t}_{2}{}\<[E]%
		\\
		\>[3]{}\hsindent{20}{}\<[23]%
		\>[23]{}\Varid{tau'}\leftarrow \Varid{typing}\;\Gamma\;\Varid{t}_{3}{}\<[E]%
		\\
		\>[3]{}\hsindent{20}{}\<[23]%
		\>[23]{}\mathbf{if}\;\Varid{tau'}\equiv \tau\;\mathbf{then}\;\Conid{Just}\;\tau\;\mathbf{else}\;\Conid{Nothing}{}\<[E]%
		\\
		\>[B]{}\hsindent{3}{}\<[3]%
		\>[3]{}\Conid{\Conid{S}.Let}\;\Varid{x}\;\Varid{t}_{1}\;\Varid{t}_{2}\to \mathbf{do}\;\tau_{1}\leftarrow \Varid{typing}\;\Gamma\;\Varid{t}_{1}{}\<[E]%
		\\
		\>[3]{}\hsindent{20}{}\<[23]%
		\>[23]{}\Varid{typing}\;(\Conid{Bind}\;\Gamma\;\Varid{x}\;\tau_{1})\;\Varid{t}_{2}{}\<[E]%
		\\
		\>[B]{}\hsindent{3}{}\<[3]%
		\>[3]{}\Conid{\Conid{S}.Fix}\;\Varid{t}\to \mathbf{do}\;(\Conid{\Conid{S}.TypeArrow}\;\tau_{1}\;\tau_{2})\leftarrow \Varid{typing}\;\Gamma\;\Varid{t}{}\<[E]%
		\\
		\>[3]{}\hsindent{14}{}\<[17]%
		\>[17]{}\Conid{Just}\;\tau_{2}{}\<[E]%
		\\
		\>[B]{}\hsindent{3}{}\<[3]%
		\>[3]{}\Conid{\Conid{S}.IntConst}\;\anonymous \to \Conid{Just}\;\Conid{\Conid{S}.TypeInt}{}\<[E]%
		\\
		\>[B]{}\hsindent{3}{}\<[3]%
		\>[3]{}\Conid{\Conid{S}.IntAdd}\;\Varid{t}_{1}\;\Varid{t}_{2}\to \Varid{arith}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[E]%
		\\
		\>[B]{}\hsindent{3}{}\<[3]%
		\>[3]{}\Conid{\Conid{S}.IntSub}\;\Varid{t}_{1}\;\Varid{t}_{2}\to \Varid{arith}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[E]%
		\\
		\>[B]{}\hsindent{3}{}\<[3]%
		\>[3]{}\Conid{\Conid{S}.IntMul}\;\Varid{t}_{1}\;\Varid{t}_{2}\to \Varid{arith}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[E]%
		\\
		\>[B]{}\hsindent{3}{}\<[3]%
		\>[3]{}\Conid{\Conid{S}.IntDiv}\;\Varid{t}_{1}\;\Varid{t}_{2}\to \Varid{arith}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[E]%
		\\
		\>[B]{}\hsindent{3}{}\<[3]%
		\>[3]{}\Conid{\Conid{S}.IntNand}\;\Varid{t}_{1}\;\Varid{t}_{2}\to \Varid{arith}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[E]%
		\\
		\>[B]{}\hsindent{3}{}\<[3]%
		\>[3]{}\Conid{\Conid{S}.IntEq}\;\Varid{t}_{1}\;\Varid{t}_{2}\to \Varid{rel}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[E]%
		\\
		\>[B]{}\hsindent{3}{}\<[3]%
		\>[3]{}\Conid{\Conid{S}.IntLt}\;\Varid{t}_{1}\;\Varid{t}_{2}\to \Varid{rel}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[E]%
		\\
		\>[B]{}\hsindent{3}{}\<[3]%
		\>[3]{}\mathbf{where}{}\<[E]%
		\\
		\>[3]{}\hsindent{2}{}\<[5]%
		\>[5]{}\Varid{arith}\;\Varid{t}_{1}\;\Varid{t}_{2}\mathrel{=}\mathbf{do}\;\Conid{\Conid{S}.TypeInt}\leftarrow \Varid{typing}\;\Gamma\;\Varid{t}_{1};\Conid{\Conid{S}.TypeInt}\leftarrow \Varid{typing}\;\Gamma\;\Varid{t}_{2};\Conid{Just}\;\Conid{\Conid{S}.TypeInt}{}\<[E]%
		\\
		\>[3]{}\hsindent{2}{}\<[5]%
		\>[5]{}\Varid{rel}\;\Varid{t}_{1}\;\Varid{t}_{2}\mathrel{=}\mathbf{do}\;\Conid{\Conid{S}.TypeInt}\leftarrow \Varid{typing}\;\Gamma\;\Varid{t}_{1};\Conid{\Conid{S}.TypeInt}\leftarrow \Varid{typing}\;\Gamma\;\Varid{t}_{2};\Conid{Just}\;\Conid{\Conid{S}.TypeBool}{}\<[E]%
		\\[\blanklineskip]%
		\>[B]{}\Varid{typeCheck}\mathbin{::}\Conid{\Conid{S}.Term}\to \Conid{\Conid{S}.Type}{}\<[E]%
		\\
		\>[B]{}\Varid{typeCheck}\;\Varid{t}\mathrel{=}{}\<[E]%
		\\
		\>[B]{}\hsindent{3}{}\<[3]%
		\>[3]{}\mathbf{case}\;\Varid{typing}\;\Conid{Empty}\;\Varid{t}\;\mathbf{of}{}\<[E]%
		\\
		\>[3]{}\hsindent{2}{}\<[5]%
		\>[5]{}\Conid{Just}\;\tau\to \tau{}\<[E]%
		\\
		\>[3]{}\hsindent{2}{}\<[5]%
		\>[5]{}\anonymous \to \Varid{error}\;\text{\tt \char34 type~error\char34}{}\<[E]%
		\ColumnHook
	\end{hscode}\resethooks

\horrule{0.5pt} \\[0.2cm]	
	
\subsubsection*{Main Program}

\noindent Our main program reads from a text file a string, this is sent to the parser to be tokenized and converted to a term.  This term is type checked to see if the entire program can be interpreted.  Then the term is sent to the updated small-step and big-step evaluation modules, following this the ReductionSemantics, CCMachine, SCCMachine, CKMachine, and the CEKMachine are called.  The reduction semantics, CC Machine and SCC machine all use a context to handle reductions.  All of these modules produce the same term in the test cases provided at the bottom. \\

\noindent The reduction semantics returns an updated term and rebuilds its context for every reduction.  The CC and SCC machines carry the context along with the current term to be reduced, this allows the reductions to be handled down inside the context tree.  However the context tree must be recursed through when it is updated so that a new context will reflect the most recent reduction.  The CK and CEK machines do not need to do this sort of recursive decent through the program.  By using the continuation structure all reductions are effectively done inside of the context of whatever structure is at the head of a list of program instructions.  This is far more effective as the program can be updated in constant time once a term is reduced.\\
	
\textit{Source Code:}\\
	
\begin{hscode}\SaveRestoreHook
	\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{3}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
	\>[B]{}\mathbf{import}\;\Conid{\Conid{System}.Environment}{}\<[E]%
	\\
	\>[B]{}\mathbf{import}\;\Conid{\Conid{Data}.Char}{}\<[E]%
	\\
	\>[B]{}\mathbf{import}\;\Varid{qualified}\;\Conid{Typing}\;\Varid{as}\;\Conid{T}{}\<[E]%
	\\
	\>[B]{}\mathbf{import}\;\Varid{qualified}\;\Conid{AbstractSyntax}\;\Varid{as}\;\Conid{S}{}\<[E]%
	\\
	\>[B]{}\mathbf{import}\;\Varid{qualified}\;\Conid{StructuralOperationalSemantics}\;\Varid{as}\;\Conid{O}{}\<[E]%
	\\
	\>[B]{}\mathbf{import}\;\Varid{qualified}\;\Conid{NaturalSemantics}\;\Varid{as}\;\Conid{N}{}\<[E]%
	\\
	\>[B]{}\mbox{\onelinecomment import qualified ReductionSemantics as R}{}\<[E]%
	\\
	\>[B]{}\mathbf{import}\;\Varid{qualified}\;\Conid{CCMachine}\;\Varid{as}\;\Conid{C}{}\<[E]%
	\\
	\>[B]{}\mathbf{import}\;\Varid{qualified}\;\Conid{SCCMachine}\;\Varid{as}\;\Conid{D}{}\<[E]%
	\\
	\>[B]{}\mathbf{import}\;\Varid{qualified}\;\Conid{CKMachine}\;\Varid{as}\;\Conid{K}{}\<[E]%
	\\
	\>[B]{}\mathbf{import}\;\Varid{qualified}\;\Conid{CEKMachine}\;\Varid{as}\;\Conid{L}{}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\Varid{main}\mathrel{=}\mathbf{do}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Varid{args}\leftarrow \Varid{getArgs}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Varid{str}\leftarrow \Varid{mapM}\;\Varid{readFile}\;\Varid{args}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Varid{putStrLn}\;\text{\tt \char34 ---Input:---\char34}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Varid{putStrLn}\;(\Varid{head}\;\Varid{str}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Varid{putStrLn}\;\text{\tt \char34 ---Term:---\char34}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\mathbf{let}\;\Varid{tokens}\mathrel{=}(\Varid{\Conid{S}.makeTokens}\;(\Varid{head}\;\Varid{str})){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\mathbf{let}\;\Varid{term}\mathrel{=}\Varid{\Conid{S}.buildTerm}\;\Varid{tokens}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Varid{putStrLn}\mathbin{\$}\Varid{show}\;\Varid{term}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Varid{putStrLn}\;\text{\tt \char34 ---Type:---\char34}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\mathbf{let}\;\Varid{exprType}\mathrel{=}\Varid{\Conid{T}.typeCheck}\;\Varid{term}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Varid{putStrLn}\mathbin{\$}\Varid{show}\;\Varid{exprType}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Varid{putStrLn}\;\text{\tt \char34 ---Structural~Semantics~-~Normal~form:---\char34}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\mathbf{let}\;\Varid{newTerm1}\mathrel{=}\Varid{\Conid{O}.eval}\;\Varid{term}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Varid{putStrLn}\mathbin{\$}\Varid{show}\;\Varid{newTerm1}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Varid{putStrLn}\;\text{\tt \char34 ---Natural~Semantics~-~Normal~form:---\char34}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\mathbf{let}\;\Varid{newTerm2}\mathrel{=}\Varid{\Conid{N}.eval}\;\Varid{term}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Varid{putStrLn}\mathbin{\$}\Varid{show}\;\Varid{newTerm2}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\mbox{\onelinecomment putStrLn "---Reduction Semantics - Normal form:---"}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\mbox{\onelinecomment let newTerm3 = R.textualMachineEval term}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\mbox{\onelinecomment putStrLn \$ show newTerm3}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Varid{putStrLn}\;\text{\tt \char34 ---CCMachine~-~Normal~form:---\char34}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\mathbf{let}\;\Varid{newTerm4}\mathrel{=}\Varid{\Conid{C}.ccMachineEval}\;\Varid{term}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Varid{putStrLn}\mathbin{\$}\Varid{show}\;\Varid{newTerm4}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Varid{putStrLn}\;\text{\tt \char34 ---SCCMachine~-~Normal~form:---\char34}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\mathbf{let}\;\Varid{newTerm5}\mathrel{=}\Varid{\Conid{D}.sccMachineEval}\;\Varid{term}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Varid{putStrLn}\mathbin{\$}\Varid{show}\;\Varid{newTerm5}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Varid{putStrLn}\;\text{\tt \char34 ---CKMachine~-~Normal~form:---\char34}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\mathbf{let}\;\Varid{newTerm6}\mathrel{=}\Varid{\Conid{K}.ckMachineEval}\;\Varid{term}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Varid{putStrLn}\mathbin{\$}\Varid{show}\;\Varid{newTerm6}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Varid{putStrLn}\;\text{\tt \char34 ---CEKMachine~-~Normal~form:---\char34}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\mathbf{let}\;\Varid{newTerm7}\mathrel{=}\Varid{\Conid{L}.cekMachineEval}\;\Varid{term}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Varid{putStrLn}\mathbin{\$}\Varid{show}\;\Varid{newTerm7}{}\<[E]%
	\ColumnHook
	\end{hscode}\resethooks

\horrule{0.5pt} \\[0.2cm]
	
\subsection{Reduction Semantics}
\horrule{1pt} \\[0.2cm]

\subsubsection{Evaluation Contexts}

The following code was used to implement evaluation contexts:\\

\textit{Source Code:}\\

\begin{hscode}\SaveRestoreHook
	\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{5}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{8}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{15}{@{}>{\hspre}c<{\hspost}@{}}%
	\column{15E}{@{}l@{}}%
	\column{17}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{18}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{19}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{21}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{23}{@{}>{\hspre}c<{\hspost}@{}}%
	\column{23E}{@{}l@{}}%
	\column{27}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
	\>[B]{}\mathbf{module}\;\Conid{EvaluationContext}\;\mathbf{where}{}\<[E]%
	\\
	\>[B]{}\mathbf{import}\;\Varid{qualified}\;\Conid{AbstractSyntax}\;\Varid{as}\;\Conid{S}{}\<[E]%
	\\
	\>[B]{}\mathbf{data}\;\Conid{Context}{}\<[15]%
	\>[15]{}\mathrel{=}{}\<[15E]%
	\>[18]{}\square{}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\mid {}\<[8]%
	\>[8]{}\Conid{AppT}\;{}\<[21]%
	\>[21]{}\Conid{Context}\;\Conid{\Conid{S}.Term}{}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\mid {}\<[8]%
	\>[8]{}\Conid{AppV}\;{}\<[21]%
	\>[21]{}\Conid{\Conid{S}.Term}\;\Conid{Context}{}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\mid {}\<[8]%
	\>[8]{}\Conid{If}\;{}\<[21]%
	\>[21]{}\Conid{Context}\;\Conid{\Conid{S}.Term}\;\Conid{\Conid{S}.Term}{}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\mid {}\<[8]%
	\>[8]{}\Conid{IntAddT}\;{}\<[19]%
	\>[19]{}\Conid{Context}\;\Conid{\Conid{S}.Term}{}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\mid {}\<[8]%
	\>[8]{}\Conid{IntAddV}\;{}\<[19]%
	\>[19]{}\Conid{\Conid{S}.Term}\;\Conid{Context}{}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\mid {}\<[8]%
	\>[8]{}\Conid{IntSubT}\;{}\<[19]%
	\>[19]{}\Conid{Context}\;\Conid{\Conid{S}.Term}{}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\mid {}\<[8]%
	\>[8]{}\Conid{IntSubV}\;{}\<[19]%
	\>[19]{}\Conid{\Conid{S}.Term}\;\Conid{Context}{}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\mid {}\<[8]%
	\>[8]{}\Conid{IntMulT}\;{}\<[19]%
	\>[19]{}\Conid{Context}\;\Conid{\Conid{S}.Term}{}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\mid {}\<[8]%
	\>[8]{}\Conid{IntMulV}\;{}\<[19]%
	\>[19]{}\Conid{\Conid{S}.Term}\;\Conid{Context}{}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\mid {}\<[8]%
	\>[8]{}\Conid{IntDivT}\;{}\<[19]%
	\>[19]{}\Conid{Context}\;\Conid{\Conid{S}.Term}{}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\mid {}\<[8]%
	\>[8]{}\Conid{IntDivV}\;{}\<[19]%
	\>[19]{}\Conid{\Conid{S}.Term}\;\Conid{Context}{}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\mid {}\<[8]%
	\>[8]{}\Conid{IntNandT}\;{}\<[19]%
	\>[19]{}\Conid{Context}\;\Conid{\Conid{S}.Term}{}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\mid {}\<[8]%
	\>[8]{}\Conid{IntNandV}\;{}\<[19]%
	\>[19]{}\Conid{\Conid{S}.Term}\;\Conid{Context}{}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\mid {}\<[8]%
	\>[8]{}\Conid{IntEqT}\;{}\<[17]%
	\>[17]{}\Conid{Context}\;\Conid{\Conid{S}.Term}{}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\mid {}\<[8]%
	\>[8]{}\Conid{IntEqV}\;{}\<[19]%
	\>[19]{}\Conid{\Conid{S}.Term}\;\Conid{Context}{}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\mid {}\<[8]%
	\>[8]{}\Conid{IntLtT}\;{}\<[19]%
	\>[19]{}\Conid{Context}\;\Conid{\Conid{S}.Term}{}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\mid {}\<[8]%
	\>[8]{}\Conid{IntLtV}\;{}\<[19]%
	\>[19]{}\Conid{\Conid{S}.Term}\;\Conid{Context}{}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\mid {}\<[8]%
	\>[8]{}\Conid{ParTerm}\;{}\<[19]%
	\>[19]{}\Conid{Context}{}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\mid {}\<[8]%
	\>[8]{}\Conid{Fix}\;{}\<[17]%
	\>[17]{}\Conid{Context}{}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\mid {}\<[8]%
	\>[8]{}\Conid{LetT}\;{}\<[17]%
	\>[17]{}\Conid{\Conid{S}.Var}\;\Conid{Context}\;\Conid{\Conid{S}.Term}{}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\mid {}\<[8]%
	\>[8]{}\Conid{LetV}\;{}\<[17]%
	\>[17]{}\Conid{\Conid{S}.Var}\;\Conid{\Conid{S}.Term}\;\Conid{Context}{}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\Varid{fillWithTerm}\mathbin{::}\Conid{Context}\to \Conid{\Conid{S}.Term}\to \Conid{\Conid{S}.Term}{}\<[E]%
	\\
	\>[B]{}\Varid{fillWithTerm}\;\Varid{c}\;\Varid{t}\mathrel{=}\mathbf{case}\;\Varid{c}\;\mathbf{of}{}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\square{}\<[23]%
	\>[23]{}\to {}\<[23E]%
	\>[27]{}\Varid{t}{}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\Conid{AppT}\;\Varid{c1}\;\Varid{t}_{2}{}\<[23]%
	\>[23]{}\to {}\<[23E]%
	\>[27]{}\Conid{\Conid{S}.App}\;(\Varid{fillWithTerm}\;\Varid{c1}\;\Varid{t})\;\Varid{t}_{2}{}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\Conid{AppV}\;\Varid{t}_{1}\;\Varid{c2}{}\<[23]%
	\>[23]{}\to {}\<[23E]%
	\>[27]{}\Conid{\Conid{S}.App}\;\Varid{t}_{1}\;(\Varid{fillWithTerm}\;\Varid{c2}\;\Varid{t}){}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\Conid{If}\;\Varid{c1}\;\Varid{t}_{2}\;\Varid{t}_{3}{}\<[23]%
	\>[23]{}\to {}\<[23E]%
	\>[27]{}\Conid{\Conid{S}.If}\;(\Varid{fillWithTerm}\;\Varid{c1}\;\Varid{t})\;\Varid{t}_{2}\;\Varid{t}_{3}{}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\Conid{IntAddT}\;\Varid{c1}\;\Varid{t}_{2}{}\<[23]%
	\>[23]{}\to {}\<[23E]%
	\>[27]{}\Conid{\Conid{S}.IntAdd}\;(\Varid{fillWithTerm}\;\Varid{c1}\;\Varid{t})\;\Varid{t}_{2}{}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\Conid{IntAddV}\;\Varid{t}_{1}\;\Varid{c2}{}\<[23]%
	\>[23]{}\to {}\<[23E]%
	\>[27]{}\Conid{\Conid{S}.IntAdd}\;\Varid{t}_{1}\;(\Varid{fillWithTerm}\;\Varid{c2}\;\Varid{t}){}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\Conid{IntSubT}\;\Varid{c1}\;\Varid{t}_{2}{}\<[23]%
	\>[23]{}\to {}\<[23E]%
	\>[27]{}\Conid{\Conid{S}.IntSub}\;(\Varid{fillWithTerm}\;\Varid{c1}\;\Varid{t})\;\Varid{t}_{2}{}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\Conid{IntSubV}\;\Varid{t}_{1}\;\Varid{c2}{}\<[23]%
	\>[23]{}\to {}\<[23E]%
	\>[27]{}\Conid{\Conid{S}.IntSub}\;\Varid{t}_{1}\;(\Varid{fillWithTerm}\;\Varid{c2}\;\Varid{t}){}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\Conid{IntMulT}\;\Varid{c1}\;\Varid{t}_{2}{}\<[23]%
	\>[23]{}\to {}\<[23E]%
	\>[27]{}\Conid{\Conid{S}.IntMul}\;(\Varid{fillWithTerm}\;\Varid{c1}\;\Varid{t})\;\Varid{t}_{2}{}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\Conid{IntMulV}\;\Varid{t}_{1}\;\Varid{c2}{}\<[23]%
	\>[23]{}\to {}\<[23E]%
	\>[27]{}\Conid{\Conid{S}.IntMul}\;\Varid{t}_{1}\;(\Varid{fillWithTerm}\;\Varid{c2}\;\Varid{t}){}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\Conid{IntDivT}\;\Varid{c1}\;\Varid{t}_{2}{}\<[23]%
	\>[23]{}\to {}\<[23E]%
	\>[27]{}\Conid{\Conid{S}.IntDiv}\;(\Varid{fillWithTerm}\;\Varid{c1}\;\Varid{t})\;\Varid{t}_{2}{}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\Conid{IntDivV}\;\Varid{t}_{1}\;\Varid{c2}{}\<[23]%
	\>[23]{}\to {}\<[23E]%
	\>[27]{}\Conid{\Conid{S}.IntDiv}\;\Varid{t}_{1}\;(\Varid{fillWithTerm}\;\Varid{c2}\;\Varid{t}){}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\Conid{IntNandT}\;\Varid{c1}\;\Varid{t}_{2}{}\<[23]%
	\>[23]{}\to {}\<[23E]%
	\>[27]{}\Conid{\Conid{S}.IntNand}\;(\Varid{fillWithTerm}\;\Varid{c1}\;\Varid{t})\;\Varid{t}_{2}{}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\Conid{IntNandV}\;\Varid{t}_{1}\;\Varid{c2}{}\<[23]%
	\>[23]{}\to {}\<[23E]%
	\>[27]{}\Conid{\Conid{S}.IntNand}\;\Varid{t}_{1}\;(\Varid{fillWithTerm}\;\Varid{c2}\;\Varid{t}){}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\Conid{IntEqT}\;\Varid{c1}\;\Varid{t}_{2}{}\<[23]%
	\>[23]{}\to {}\<[23E]%
	\>[27]{}\Conid{\Conid{S}.IntEq}\;(\Varid{fillWithTerm}\;\Varid{c1}\;\Varid{t})\;\Varid{t}_{2}{}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\Conid{IntEqV}\;\Varid{t}_{1}\;\Varid{c2}{}\<[23]%
	\>[23]{}\to {}\<[23E]%
	\>[27]{}\Conid{\Conid{S}.IntEq}\;\Varid{t}_{1}\;(\Varid{fillWithTerm}\;\Varid{c2}\;\Varid{t}){}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\Conid{IntLtT}\;\Varid{c1}\;\Varid{t}_{2}{}\<[23]%
	\>[23]{}\to {}\<[23E]%
	\>[27]{}\Conid{\Conid{S}.IntLt}\;(\Varid{fillWithTerm}\;\Varid{c1}\;\Varid{t})\;\Varid{t}_{2}{}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\Conid{IntLtV}\;\Varid{t}_{1}\;\Varid{c2}{}\<[23]%
	\>[23]{}\to {}\<[23E]%
	\>[27]{}\Conid{\Conid{S}.IntLt}\;\Varid{t}_{1}\;(\Varid{fillWithTerm}\;\Varid{c2}\;\Varid{t}){}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\Conid{ParTerm}\;\Varid{c1}{}\<[23]%
	\>[23]{}\to {}\<[23E]%
	\>[27]{}\Conid{\Conid{S}.ParTerm}\;(\Varid{fillWithTerm}\;\Varid{c1}\;\Varid{t}){}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\Conid{Fix}\;\Varid{c1}{}\<[23]%
	\>[23]{}\to {}\<[23E]%
	\>[27]{}\Conid{\Conid{S}.Fix}\;(\Varid{fillWithTerm}\;\Varid{c1}\;\Varid{t}){}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\Conid{LetT}\;\Varid{v1}\;\Varid{c2}\;\Varid{t}_{3}{}\<[23]%
	\>[23]{}\to {}\<[23E]%
	\>[27]{}\Conid{\Conid{S}.Let}\;\Varid{v1}\;(\Varid{fillWithTerm}\;\Varid{c2}\;\Varid{t})\;\Varid{t}_{3}{}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\Conid{LetV}\;\Varid{v1}\;\Varid{t}_{2}\;\Varid{c3}{}\<[23]%
	\>[23]{}\to {}\<[23E]%
	\>[27]{}\Conid{\Conid{S}.Let}\;\Varid{v1}\;\Varid{t}_{2}\;(\Varid{fillWithTerm}\;\Varid{c3}\;\Varid{t}){}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\Varid{fillWithContext}\mathbin{::}\Conid{Context}\to \Conid{Context}\to \Conid{Context}{}\<[E]%
	\\
	\>[B]{}\Varid{fillWithContext}\;\Varid{c}\;\Varid{c'}\mathrel{=}\mathbf{case}\;\Varid{c}\;\mathbf{of}{}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\square{}\<[23]%
	\>[23]{}\to {}\<[23E]%
	\>[27]{}\Varid{c'}{}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\Conid{AppT}\;\Varid{c1}\;\Varid{t}_{2}{}\<[23]%
	\>[23]{}\to {}\<[23E]%
	\>[27]{}\Conid{AppT}\;(\Varid{fillWithContext}\;\Varid{c1}\;\Varid{c'})\;\Varid{t}_{2}{}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\Conid{AppV}\;\Varid{t}_{1}\;\Varid{c2}{}\<[23]%
	\>[23]{}\to {}\<[23E]%
	\>[27]{}\Conid{AppV}\;\Varid{t}_{1}\;(\Varid{fillWithContext}\;\Varid{c2}\;\Varid{c'}){}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\Conid{If}\;\Varid{c1}\;\Varid{t}_{2}\;\Varid{t}_{3}{}\<[23]%
	\>[23]{}\to {}\<[23E]%
	\>[27]{}\Conid{If}\;(\Varid{fillWithContext}\;\Varid{c1}\;\Varid{c'})\;\Varid{t}_{2}\;\Varid{t}_{3}{}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\Conid{IntAddT}\;\Varid{c1}\;\Varid{t}_{2}{}\<[23]%
	\>[23]{}\to {}\<[23E]%
	\>[27]{}\Conid{IntAddT}\;(\Varid{fillWithContext}\;\Varid{c1}\;\Varid{c'})\;\Varid{t}_{2}{}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\Conid{IntAddV}\;\Varid{t}_{1}\;\Varid{c2}{}\<[23]%
	\>[23]{}\to {}\<[23E]%
	\>[27]{}\Conid{IntAddV}\;\Varid{t}_{1}\;(\Varid{fillWithContext}\;\Varid{c2}\;\Varid{c'}){}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\Conid{IntSubT}\;\Varid{c1}\;\Varid{t}_{2}{}\<[23]%
	\>[23]{}\to {}\<[23E]%
	\>[27]{}\Conid{IntSubT}\;(\Varid{fillWithContext}\;\Varid{c1}\;\Varid{c'})\;\Varid{t}_{2}{}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\Conid{IntSubV}\;\Varid{t}_{1}\;\Varid{c2}{}\<[23]%
	\>[23]{}\to {}\<[23E]%
	\>[27]{}\Conid{IntSubV}\;\Varid{t}_{1}\;(\Varid{fillWithContext}\;\Varid{c2}\;\Varid{c'}){}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\Conid{IntMulT}\;\Varid{c1}\;\Varid{t}_{2}{}\<[23]%
	\>[23]{}\to {}\<[23E]%
	\>[27]{}\Conid{IntMulT}\;(\Varid{fillWithContext}\;\Varid{c1}\;\Varid{c'})\;\Varid{t}_{2}{}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\Conid{IntMulV}\;\Varid{t}_{1}\;\Varid{c2}{}\<[23]%
	\>[23]{}\to {}\<[23E]%
	\>[27]{}\Conid{IntMulV}\;\Varid{t}_{1}\;(\Varid{fillWithContext}\;\Varid{c2}\;\Varid{c'}){}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\Conid{IntDivT}\;\Varid{c1}\;\Varid{t}_{2}{}\<[23]%
	\>[23]{}\to {}\<[23E]%
	\>[27]{}\Conid{IntDivT}\;(\Varid{fillWithContext}\;\Varid{c1}\;\Varid{c'})\;\Varid{t}_{2}{}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\Conid{IntDivV}\;\Varid{t}_{1}\;\Varid{c2}{}\<[23]%
	\>[23]{}\to {}\<[23E]%
	\>[27]{}\Conid{IntDivV}\;\Varid{t}_{1}\;(\Varid{fillWithContext}\;\Varid{c2}\;\Varid{c'}){}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\Conid{IntNandT}\;\Varid{c1}\;\Varid{t}_{2}{}\<[23]%
	\>[23]{}\to {}\<[23E]%
	\>[27]{}\Conid{IntNandT}\;(\Varid{fillWithContext}\;\Varid{c1}\;\Varid{c'})\;\Varid{t}_{2}{}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\Conid{IntNandV}\;\Varid{t}_{1}\;\Varid{c2}{}\<[23]%
	\>[23]{}\to {}\<[23E]%
	\>[27]{}\Conid{IntNandV}\;\Varid{t}_{1}\;(\Varid{fillWithContext}\;\Varid{c2}\;\Varid{c'}){}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\Conid{IntEqT}\;\Varid{c1}\;\Varid{t}_{2}{}\<[23]%
	\>[23]{}\to {}\<[23E]%
	\>[27]{}\Conid{IntEqT}\;(\Varid{fillWithContext}\;\Varid{c1}\;\Varid{c'})\;\Varid{t}_{2}{}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\Conid{IntEqV}\;\Varid{t}_{1}\;\Varid{c2}{}\<[23]%
	\>[23]{}\to {}\<[23E]%
	\>[27]{}\Conid{IntEqV}\;\Varid{t}_{1}\;(\Varid{fillWithContext}\;\Varid{c2}\;\Varid{c'}){}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\Conid{IntLtT}\;\Varid{c1}\;\Varid{t}_{2}{}\<[23]%
	\>[23]{}\to {}\<[23E]%
	\>[27]{}\Conid{IntLtT}\;(\Varid{fillWithContext}\;\Varid{c1}\;\Varid{c'})\;\Varid{t}_{2}{}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\Conid{IntLtV}\;\Varid{t}_{1}\;\Varid{c2}{}\<[23]%
	\>[23]{}\to {}\<[23E]%
	\>[27]{}\Conid{IntLtV}\;\Varid{t}_{1}\;(\Varid{fillWithContext}\;\Varid{c2}\;\Varid{c'}){}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\Conid{ParTerm}\;\Varid{c1}{}\<[23]%
	\>[23]{}\to {}\<[23E]%
	\>[27]{}\Conid{ParTerm}\;(\Varid{fillWithContext}\;\Varid{c1}\;\Varid{c'}){}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\Conid{Fix}\;\Varid{c1}{}\<[23]%
	\>[23]{}\to {}\<[23E]%
	\>[27]{}\Conid{Fix}\;(\Varid{fillWithContext}\;\Varid{c1}\;\Varid{c'}){}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\Conid{LetT}\;\Varid{v1}\;\Varid{c2}\;\Varid{t}_{3}{}\<[23]%
	\>[23]{}\to {}\<[23E]%
	\>[27]{}\Conid{LetT}\;\Varid{v1}\;(\Varid{fillWithContext}\;\Varid{c2}\;\Varid{c'})\;\Varid{t}_{3}{}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\Conid{LetV}\;\Varid{v1}\;\Varid{t}_{2}\;\Varid{c3}{}\<[23]%
	\>[23]{}\to {}\<[23E]%
	\>[27]{}\Conid{LetV}\;\Varid{v1}\;\Varid{t}_{2}\;(\Varid{fillWithContext}\;\Varid{c3}\;\Varid{c'}){}\<[E]%
	\ColumnHook
\end{hscode}\resethooks

\horrule{0.5pt} \\[0.2cm]

\subsubsection{Standard Reduction}

When forming the evaluation contexts, if a term is a redex, then it should be the next thing reduced.  Otherwise the first subterm that is not a value should be searched for a redex.  In our implementation this is accomplished by returning the evaluation context (Term, E.Hole) if the term is a redexe. Otherwise, the first non-value subterm is passed to a helper function that uses makeEvalContext and E.fillWithContext to recursively search for a redex within that subterm to reduce. makeContractum is responsible for reducing the redex once it is found.\\

The textual machine recursively evaluates a term, splitting it into an evaluation context and a subterm.  If this subterm is a redex, it is reduced to obtain a contractum, and the evaluation context is filled with this contractum. This machine is inherently inefficient, since it essentially returns to the root of the tree and then searches for the location of the next redex.  This does not provide  any means of localization that could enhance efficiency.\\

\textit{Source Code:}\\

\begin{hscode}\SaveRestoreHook
	\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{3}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{5}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{7}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{8}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{9}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{25}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{29}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{49}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
	\>[B]{}\mathbf{module}\;\Conid{ReductionSemantics}\;\mathbf{where}{}\<[E]%
	\\
	\>[B]{}\mathbf{import}\;\Varid{qualified}\;\Conid{AbstractSyntax}\;\Varid{as}\;\Conid{S}{}\<[E]%
	\\
	\>[B]{}\mathbf{import}\;\Varid{qualified}\;\Conid{EvaluationContext}\;\Varid{as}\;\Conid{E}{}\<[E]%
	\\
	\>[B]{}\mathbf{import}\;\Varid{qualified}\;\Conid{IntegerArithmetic}\;\Varid{as}\;\Conid{I}{}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\Varid{makeEvalContext}\mathbin{::}\Conid{\Conid{S}.Term}\to \Conid{Maybe}\;(\Conid{\Conid{S}.Term},\Conid{\Conid{E}.Context}){}\<[E]%
	\\
	\>[B]{}\Varid{makeEvalContext}\;\Varid{t}\mathrel{=}\mathbf{case}\;\Varid{t}\;\mathbf{of}{}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\hsindent{7}{}\<[7]%
	\>[7]{}\Conid{\Conid{S}.App}\;(\Conid{\Conid{S}.Abs}\;\Varid{x}\;\tau_{11}\;\Varid{t}_{12})\;\Varid{t}_{2}{}\<[E]%
	\\
	\>[7]{}\hsindent{2}{}\<[9]%
	\>[9]{}\mid \Varid{\Conid{S}.isValue}\;\Varid{t}_{2}{}\<[29]%
	\>[29]{}\to \Conid{Just}\;(\Varid{t},\Conid{E}.\square){}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\hsindent{7}{}\<[7]%
	\>[7]{}\Conid{\Conid{S}.App}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[E]%
	\\
	\>[7]{}\hsindent{2}{}\<[9]%
	\>[9]{}\mid \Varid{\Conid{S}.isValue}\;\Varid{t}_{1}{}\<[25]%
	\>[25]{}\to \Varid{nextEC}\;(\Varid{t}_{2},(\Conid{\Conid{E}.AppV}\;\Varid{t}_{1}\;\Conid{E}.\square)){}\<[E]%
	\\
	\>[7]{}\hsindent{2}{}\<[9]%
	\>[9]{}\mid \Varid{otherwise}{}\<[25]%
	\>[25]{}\to \Varid{nextEC}\;(\Varid{t}_{1},(\Conid{\Conid{E}.AppT}\;\Conid{E}.\square\;\Varid{t}_{2})){}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\hsindent{7}{}\<[7]%
	\>[7]{}\Conid{\Conid{S}.If}\;(\Conid{\Conid{S}.Fls})\;\Varid{t}_{2}\;\Varid{t}_{3}{}\<[29]%
	\>[29]{}\to \Conid{Just}\;(\Varid{t},\Conid{E}.\square){}\<[E]%
	\\
	\>[B]{}\hsindent{7}{}\<[7]%
	\>[7]{}\Conid{\Conid{S}.If}\;(\Conid{\Conid{S}.Tru})\;\Varid{t}_{2}\;\Varid{t}_{3}{}\<[29]%
	\>[29]{}\to \Conid{Just}\;(\Varid{t},\Conid{E}.\square){}\<[E]%
	\\
	\>[B]{}\hsindent{7}{}\<[7]%
	\>[7]{}\Conid{\Conid{S}.If}\;\Varid{t}_{1}\;\Varid{t}_{2}\;\Varid{t}_{3}{}\<[29]%
	\>[29]{}\to \Varid{nextEC}\;(\Varid{t}_{1},(\Conid{\Conid{E}.If}\;\Conid{E}.\square\;\Varid{t}_{2}\;\Varid{t}_{3})){}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\hsindent{7}{}\<[7]%
	\>[7]{}\Conid{\Conid{S}.IntAdd}\;(\Conid{\Conid{S}.IntConst}\;\Varid{t}_{1})\;(\Conid{\Conid{S}.IntConst}\;\Varid{t}_{2})\to \Conid{Just}\;(\Varid{t},\Conid{E}.\square){}\<[E]%
	\\
	\>[B]{}\hsindent{7}{}\<[7]%
	\>[7]{}\Conid{\Conid{S}.IntAdd}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[E]%
	\\
	\>[7]{}\hsindent{2}{}\<[9]%
	\>[9]{}\mid \Varid{\Conid{S}.isValue}\;\Varid{t}_{1}{}\<[25]%
	\>[25]{}\to \Varid{nextEC}\;(\Varid{t}_{2},(\Conid{\Conid{E}.IntAddV}\;\Varid{t}_{1}\;\Conid{E}.\square)){}\<[E]%
	\\
	\>[7]{}\hsindent{2}{}\<[9]%
	\>[9]{}\mid \Varid{otherwise}{}\<[25]%
	\>[25]{}\to \Varid{nextEC}\;(\Varid{t}_{1},(\Conid{\Conid{E}.IntAddT}\;\Conid{E}.\square\;\Varid{t}_{2})){}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\hsindent{7}{}\<[7]%
	\>[7]{}\Conid{\Conid{S}.IntSub}\;(\Conid{\Conid{S}.IntConst}\;\Varid{t}_{1})\;(\Conid{\Conid{S}.IntConst}\;\Varid{t}_{2})\to \Conid{Just}\;(\Varid{t},\Conid{E}.\square){}\<[E]%
	\\
	\>[B]{}\hsindent{7}{}\<[7]%
	\>[7]{}\Conid{\Conid{S}.IntSub}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[E]%
	\\
	\>[7]{}\hsindent{2}{}\<[9]%
	\>[9]{}\mid \Varid{\Conid{S}.isValue}\;\Varid{t}_{1}{}\<[25]%
	\>[25]{}\to \Varid{nextEC}\;(\Varid{t}_{2},(\Conid{\Conid{E}.IntSubV}\;\Varid{t}_{1}\;\Conid{E}.\square)){}\<[E]%
	\\
	\>[7]{}\hsindent{2}{}\<[9]%
	\>[9]{}\mid \Varid{otherwise}{}\<[25]%
	\>[25]{}\to \Varid{nextEC}\;(\Varid{t}_{1},(\Conid{\Conid{E}.IntSubT}\;\Conid{E}.\square\;\Varid{t}_{2})){}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\hsindent{7}{}\<[7]%
	\>[7]{}\Conid{\Conid{S}.IntMul}\;(\Conid{\Conid{S}.IntConst}\;\Varid{t}_{1})\;(\Conid{\Conid{S}.IntConst}\;\Varid{t}_{2})\to \Conid{Just}\;(\Varid{t},\Conid{E}.\square){}\<[E]%
	\\
	\>[B]{}\hsindent{7}{}\<[7]%
	\>[7]{}\Conid{\Conid{S}.IntMul}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[E]%
	\\
	\>[7]{}\hsindent{2}{}\<[9]%
	\>[9]{}\mid \Varid{\Conid{S}.isValue}\;\Varid{t}_{1}{}\<[25]%
	\>[25]{}\to \Varid{nextEC}\;(\Varid{t}_{2},(\Conid{\Conid{E}.IntMulV}\;\Varid{t}_{1}\;\Conid{E}.\square)){}\<[E]%
	\\
	\>[7]{}\hsindent{2}{}\<[9]%
	\>[9]{}\mid \Varid{otherwise}{}\<[25]%
	\>[25]{}\to \Varid{nextEC}\;(\Varid{t}_{1},(\Conid{\Conid{E}.IntMulT}\;\Conid{E}.\square\;\Varid{t}_{2})){}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\hsindent{7}{}\<[7]%
	\>[7]{}\Conid{\Conid{S}.IntDiv}\;(\Conid{\Conid{S}.IntConst}\;\Varid{t}_{1})\;(\Conid{\Conid{S}.IntConst}\;\Varid{t}_{2})\to \Conid{Just}\;(\Varid{t},\Conid{E}.\square){}\<[E]%
	\\
	\>[B]{}\hsindent{7}{}\<[7]%
	\>[7]{}\Conid{\Conid{S}.IntDiv}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[E]%
	\\
	\>[7]{}\hsindent{2}{}\<[9]%
	\>[9]{}\mid \Varid{\Conid{S}.isValue}\;\Varid{t}_{1}{}\<[25]%
	\>[25]{}\to \Varid{nextEC}\;(\Varid{t}_{2},(\Conid{\Conid{E}.IntDivV}\;\Varid{t}_{1}\;\Conid{E}.\square)){}\<[E]%
	\\
	\>[7]{}\hsindent{2}{}\<[9]%
	\>[9]{}\mid \Varid{otherwise}{}\<[25]%
	\>[25]{}\to \Varid{nextEC}\;(\Varid{t}_{1},(\Conid{\Conid{E}.IntDivT}\;\Conid{E}.\square\;\Varid{t}_{2})){}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\hsindent{7}{}\<[7]%
	\>[7]{}\Conid{\Conid{S}.IntNand}\;(\Conid{\Conid{S}.IntConst}\;\Varid{t}_{1})\;(\Conid{\Conid{S}.IntConst}\;\Varid{t}_{2})\to \Conid{Just}\;(\Varid{t},\Conid{E}.\square){}\<[E]%
	\\
	\>[B]{}\hsindent{7}{}\<[7]%
	\>[7]{}\Conid{\Conid{S}.IntNand}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[E]%
	\\
	\>[7]{}\hsindent{2}{}\<[9]%
	\>[9]{}\mid \Varid{\Conid{S}.isValue}\;\Varid{t}_{1}{}\<[25]%
	\>[25]{}\to \Varid{nextEC}\;(\Varid{t}_{2},(\Conid{\Conid{E}.IntNandV}\;\Varid{t}_{1}\;\Conid{E}.\square)){}\<[E]%
	\\
	\>[7]{}\hsindent{2}{}\<[9]%
	\>[9]{}\mid \Varid{otherwise}{}\<[25]%
	\>[25]{}\to \Varid{nextEC}\;(\Varid{t}_{1},(\Conid{\Conid{E}.IntNandT}\;\Conid{E}.\square\;\Varid{t}_{2})){}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\hsindent{7}{}\<[7]%
	\>[7]{}\Conid{\Conid{S}.IntEq}\;(\Conid{\Conid{S}.IntConst}\;\Varid{t}_{1})\;(\Conid{\Conid{S}.IntConst}\;\Varid{t}_{2})\to \Conid{Just}\;(\Varid{t},\Conid{E}.\square){}\<[E]%
	\\
	\>[B]{}\hsindent{7}{}\<[7]%
	\>[7]{}\Conid{\Conid{S}.IntEq}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[E]%
	\\
	\>[7]{}\hsindent{2}{}\<[9]%
	\>[9]{}\mid \Varid{\Conid{S}.isValue}\;\Varid{t}_{1}{}\<[25]%
	\>[25]{}\to \Varid{nextEC}\;(\Varid{t}_{2},(\Conid{\Conid{E}.IntEqV}\;\Varid{t}_{1}\;\Conid{E}.\square)){}\<[E]%
	\\
	\>[7]{}\hsindent{2}{}\<[9]%
	\>[9]{}\mid \Varid{otherwise}{}\<[25]%
	\>[25]{}\to \Varid{nextEC}\;(\Varid{t}_{1},(\Conid{\Conid{E}.IntEqT}\;\Conid{E}.\square\;\Varid{t}_{2})){}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\hsindent{7}{}\<[7]%
	\>[7]{}\Conid{\Conid{S}.IntLt}\;(\Conid{\Conid{S}.IntConst}\;\Varid{t}_{1})\;(\Conid{\Conid{S}.IntConst}\;\Varid{t}_{2})\to \Conid{Just}\;(\Varid{t},\Conid{E}.\square){}\<[E]%
	\\
	\>[B]{}\hsindent{7}{}\<[7]%
	\>[7]{}\Conid{\Conid{S}.IntLt}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[E]%
	\\
	\>[7]{}\hsindent{2}{}\<[9]%
	\>[9]{}\mid \Varid{\Conid{S}.isValue}\;\Varid{t}_{1}{}\<[25]%
	\>[25]{}\to \Varid{nextEC}\;(\Varid{t}_{2},(\Conid{\Conid{E}.IntLtV}\;\Varid{t}_{1}\;\Conid{E}.\square)){}\<[E]%
	\\
	\>[7]{}\hsindent{2}{}\<[9]%
	\>[9]{}\mid \Varid{otherwise}{}\<[25]%
	\>[25]{}\to \Varid{nextEC}\;(\Varid{t}_{1},(\Conid{\Conid{E}.IntLtT}\;\Conid{E}.\square\;\Varid{t}_{2})){}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\hsindent{7}{}\<[7]%
	\>[7]{}\Conid{\Conid{S}.Let}\;\Varid{x}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[E]%
	\\
	\>[7]{}\hsindent{2}{}\<[9]%
	\>[9]{}\mid \Varid{\Conid{S}.isValue}\;\Varid{t}_{1}{}\<[29]%
	\>[29]{}\to \Conid{Just}\;(\Varid{t},\Conid{E}.\square){}\<[E]%
	\\
	\>[7]{}\hsindent{2}{}\<[9]%
	\>[9]{}\mid \Varid{otherwise}\to {}\<[25]%
	\>[25]{}\Varid{nextEC}\;(\Varid{t}_{1},(\Conid{\Conid{E}.LetT}\;\Varid{x}\;\Conid{E}.\square\;\Varid{t}_{2})){}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\hsindent{7}{}\<[7]%
	\>[7]{}\Conid{\Conid{S}.Fix}\;(\Conid{\Conid{S}.Abs}\;\Varid{x}\;\tau_{11}\;\Varid{t}_{12})\to \Conid{Just}\;(\Varid{t},\Conid{E}.\square){}\<[E]%
	\\
	\>[B]{}\hsindent{7}{}\<[7]%
	\>[7]{}\Conid{\Conid{S}.Fix}\;\Varid{t}\to \Conid{Just}\;(\Varid{t},\Conid{\Conid{E}.Fix}\;\Conid{E}.\square){}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\hsindent{7}{}\<[7]%
	\>[7]{}\anonymous {}\<[29]%
	\>[29]{}\to \Conid{Nothing}{}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\Varid{nextEC}\mathbin{::}(\Conid{\Conid{S}.Term},\Conid{\Conid{E}.Context})\to \Conid{Maybe}\;(\Conid{\Conid{S}.Term},\Conid{\Conid{E}.Context}){}\<[E]%
	\\
	\>[B]{}\Varid{nextEC}\;(\Varid{t},\Varid{c})\mathrel{=}\mathbf{do}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}(\Varid{t'},\Varid{c'})\leftarrow \Varid{makeEvalContext}\;\Varid{t}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Varid{return}\;(\Varid{t'},\Varid{\Conid{E}.fillWithContext}\;\Varid{c}\;\Varid{c'}){}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\Varid{makeContractum}\mathbin{::}\Conid{\Conid{S}.Term}\to \Conid{\Conid{S}.Term}{}\<[E]%
	\\
	\>[B]{}\Varid{makeContractum}\;\Varid{t}\mathrel{=}\mathbf{case}\;\Varid{t}\;\mathbf{of}{}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\Conid{\Conid{S}.App}\;(\Conid{\Conid{S}.Abs}\;\Varid{x}\;\tau_{11}\;\Varid{t}_{12})\;\Varid{t}_{2}{}\<[49]%
	\>[49]{}\to \Varid{\Conid{S}.subst}\;\Varid{x}\;\Varid{t}_{2}\;\Varid{t}_{12}{}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\Conid{\Conid{S}.If}\;(\Conid{\Conid{S}.Tru})\;\Varid{t}_{2}\;\Varid{t}_{3}{}\<[49]%
	\>[49]{}\to \Varid{t}_{2}{}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\Conid{\Conid{S}.If}\;(\Conid{\Conid{S}.Fls})\;\Varid{t}_{2}\;\Varid{t}_{3}{}\<[49]%
	\>[49]{}\to \Varid{t}_{3}{}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\Conid{\Conid{S}.IntAdd}\;(\Conid{\Conid{S}.IntConst}\;\Varid{n1})\;(\Conid{\Conid{S}.IntConst}\;\Varid{n2}){}\<[49]%
	\>[49]{}\to \Conid{\Conid{S}.IntConst}\;(\Varid{\Conid{I}.intAdd}\;\Varid{n1}\;\Varid{n2}){}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\Conid{\Conid{S}.IntSub}\;(\Conid{\Conid{S}.IntConst}\;\Varid{n1})\;(\Conid{\Conid{S}.IntConst}\;\Varid{n2}){}\<[49]%
	\>[49]{}\to \Conid{\Conid{S}.IntConst}\;(\Varid{\Conid{I}.intSub}\;\Varid{n1}\;\Varid{n2}){}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\Conid{\Conid{S}.IntMul}\;(\Conid{\Conid{S}.IntConst}\;\Varid{n1})\;(\Conid{\Conid{S}.IntConst}\;\Varid{n2}){}\<[49]%
	\>[49]{}\to \Conid{\Conid{S}.IntConst}\;(\Varid{\Conid{I}.intMul}\;\Varid{n1}\;\Varid{n2}){}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\Conid{\Conid{S}.IntDiv}\;(\Conid{\Conid{S}.IntConst}\;\Varid{n1})\;(\Conid{\Conid{S}.IntConst}\;\Varid{n2}){}\<[49]%
	\>[49]{}\to \Conid{\Conid{S}.IntConst}\;(\Varid{\Conid{I}.intDiv}\;\Varid{n1}\;\Varid{n2}){}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\Conid{\Conid{S}.IntNand}\;(\Conid{\Conid{S}.IntConst}\;\Varid{n1})\;(\Conid{\Conid{S}.IntConst}\;\Varid{n2}){}\<[49]%
	\>[49]{}\to \Conid{\Conid{S}.IntConst}\;(\Varid{\Conid{I}.intNand}\;\Varid{n1}\;\Varid{n2}){}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\Conid{\Conid{S}.IntLt}\;(\Conid{\Conid{S}.IntConst}\;\Varid{n1})\;(\Conid{\Conid{S}.IntConst}\;\Varid{n2}){}\<[49]%
	\>[49]{}\to \mathbf{if}\;(\Varid{\Conid{I}.intLt}\;\Varid{n1}\;\Varid{n2})\;\mathbf{then}\;\Conid{\Conid{S}.Tru}\;\mathbf{else}\;\Conid{\Conid{S}.Fls}{}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\Conid{\Conid{S}.IntEq}\;(\Conid{\Conid{S}.IntConst}\;\Varid{n1})\;(\Conid{\Conid{S}.IntConst}\;\Varid{n2}){}\<[49]%
	\>[49]{}\to \mathbf{if}\;(\Varid{\Conid{I}.intEq}\;\Varid{n1}\;\Varid{n2})\;\mathbf{then}\;\Conid{\Conid{S}.Tru}\;\mathbf{else}\;\Conid{\Conid{S}.Fls}{}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\Conid{\Conid{S}.Let}\;\Varid{x}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[49]%
	\>[49]{}\to \Varid{\Conid{S}.subst}\;\Varid{x}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[E]%
	\\
	\>[B]{}\hsindent{5}{}\<[5]%
	\>[5]{}\Conid{\Conid{S}.Fix}\;(\Conid{\Conid{S}.Abs}\;\Varid{x}\;\tau_{11}\;\Varid{t}_{12}){}\<[49]%
	\>[49]{}\to \Varid{\Conid{S}.subst}\;\Varid{x}\;(\Conid{\Conid{S}.Fix}\;(\Conid{\Conid{S}.Abs}\;\Varid{x}\;\tau_{11}\;\Varid{t}_{12}))\;\Varid{t}_{12}{}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\Varid{textualMachineStep}\mathbin{::}\Conid{\Conid{S}.Term}\to \Conid{Maybe}\;\Conid{\Conid{S}.Term}{}\<[E]%
	\\
	\>[B]{}\Varid{textualMachineStep}\;\Varid{t}\mathrel{=}\mathbf{case}\;\Varid{makeEvalContext}\;\Varid{t}\;\mathbf{of}{}\<[E]%
	\\
	\>[B]{}\hsindent{8}{}\<[8]%
	\>[8]{}\Conid{Just}\;(\Varid{t'},\Varid{c}){}\<[29]%
	\>[29]{}\to \Conid{Just}\;(\Varid{\Conid{E}.fillWithTerm}\;\Varid{c}\;(\Varid{makeContractum}\;\Varid{t'})){}\<[E]%
	\\
	\>[B]{}\hsindent{8}{}\<[8]%
	\>[8]{}\anonymous {}\<[29]%
	\>[29]{}\to \Conid{Nothing}{}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\Varid{textualMachineEval}\mathbin{::}\Conid{\Conid{S}.Term}\to \Conid{\Conid{S}.Term}{}\<[E]%
	\\
	\>[B]{}\Varid{textualMachineEval}\;\Varid{t}\mathrel{=}{}\<[25]%
	\>[25]{}\mathbf{case}\;\Varid{textualMachineStep}\;\Varid{t}\;\mathbf{of}{}\<[E]%
	\\
	\>[B]{}\hsindent{8}{}\<[8]%
	\>[8]{}\Conid{Just}\;\Varid{t'}{}\<[29]%
	\>[29]{}\to \Varid{textualMachineEval}\;\Varid{t'}{}\<[E]%
	\\
	\>[B]{}\hsindent{8}{}\<[8]%
	\>[8]{}\anonymous {}\<[29]%
	\>[29]{}\to \Varid{t}{}\<[E]%
	\ColumnHook
\end{hscode}\resethooks

\horrule{0.5pt} \\[0.2cm]

\subsection{Abstract Register Machines}

\horrule{1pt} \\[0.2cm]

\subsubsection{CCMachine}

\noindent This machine builds a context tree which is a copy of the program with a hole located where the current reduction is being handled.  Once the term is reduced its relative context will have further terms extracted and then reduced, and the context tree is rebuilt to reflect the structure surrounding these reductions.  Updating the context after a reduction is a little tricky because the context tree will be almost the same one level above the current reduction, inside this level a new context will be added as a child or a hole will be used because the next reduction will be handled on this level or a different branch of this level.   \\

\begin{hscode}\SaveRestoreHook
	\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{3}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{5}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{7}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{15}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{20}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{23}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{28}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{66}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
	\>[B]{}\mathbf{module}\;\Conid{CCMachine}\;\mathbf{where}{}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\mathbf{import}\;\Varid{qualified}\;\Conid{AbstractSyntax}\;\Varid{as}\;\Conid{S}{}\<[E]%
	\\
	\>[B]{}\mathbf{import}\;\Varid{qualified}\;\Conid{EvaluationContext}\;\Varid{as}\;\Conid{E}{}\<[E]%
	\\
	\>[B]{}\mathbf{import}\;\Varid{qualified}\;\Conid{IntegerArithmetic}\;\Varid{as}\;\Conid{I}{}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\Varid{ccMachineStep}\mathbin{::}(\Conid{\Conid{S}.Term},\Conid{\Conid{E}.Context})\to \Conid{Maybe}\;(\Conid{\Conid{S}.Term},\Conid{\Conid{E}.Context}){}\<[E]%
	\\
	\>[B]{}\Varid{ccMachineStep}\;(\Varid{t},\Varid{c})\mathrel{=}\mathbf{case}\;\Varid{t}\;\mathbf{of}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.App}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\mid \neg \;(\Varid{\Conid{S}.isValue}\;\Varid{t}_{1}){}\<[E]%
	\\
	\>[5]{}\hsindent{2}{}\<[7]%
	\>[7]{}\to \Conid{Just}\;(\Varid{t}_{1},\Varid{\Conid{E}.fillWithContext}\;\Varid{c}\;(\Conid{\Conid{E}.AppT}\;\Conid{E}.\square\;\Varid{t}_{2})){}\<[66]%
	\>[66]{}\mbox{\commentbegin cc1 \commentend}{}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\mid \Varid{\Conid{S}.isValue}\;\Varid{t}_{1}\mathrel{\wedge}\neg \;(\Varid{\Conid{S}.isValue}\;\Varid{t}_{2}){}\<[E]%
	\\
	\>[5]{}\hsindent{2}{}\<[7]%
	\>[7]{}\to \Conid{Just}\;(\Varid{t}_{2},\Varid{\Conid{E}.fillWithContext}\;\Varid{c}\;(\Conid{\Conid{E}.AppV}\;\Varid{t}_{1}\;\Conid{E}.\square)){}\<[66]%
	\>[66]{}\mbox{\commentbegin cc2 \commentend}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.App}\;(\Conid{\Conid{S}.Abs}\;\Varid{x}\;\anonymous \;\Varid{t}_{12})\;\Varid{t}_{2}\to \Conid{Just}\;(\Varid{\Conid{S}.subst}\;\Varid{x}\;\Varid{t}_{2}\;\Varid{t}_{12},\Varid{c}){}\<[66]%
	\>[66]{}\mbox{\commentbegin ccbeta \commentend}{}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.If}\;(\Conid{\Conid{S}.Tru})\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[28]%
	\>[28]{}\to \Conid{Just}\;(\Varid{t}_{1},\Varid{c}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.If}\;(\Conid{\Conid{S}.Fls})\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[28]%
	\>[28]{}\to \Conid{Just}\;(\Varid{t}_{2},\Varid{c}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.If}\;\Varid{t}_{1}\;\Varid{t}_{2}\;\Varid{t}_{3}{}\<[28]%
	\>[28]{}\to \Conid{Just}\;(\Varid{t}_{1},\Varid{\Conid{E}.fillWithContext}\;\Varid{c}\;(\Conid{\Conid{E}.If}\;\Conid{E}.\square\;\Varid{t}_{2}\;\Varid{t}_{3})){}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.Fix}\;(\Conid{\Conid{S}.Abs}\;\Varid{x}\;\Varid{y}\;\Varid{t}_{1}){}\<[28]%
	\>[28]{}\to \Conid{Just}\;((\Varid{\Conid{S}.subst}\;\Varid{x}\;\Varid{t}\;\Varid{t}_{1}),\Varid{c}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.Fix}\;\Varid{t}_{1}{}\<[28]%
	\>[28]{}\to \Conid{Just}\;(\Varid{t}_{1},\Varid{\Conid{E}.fillWithContext}\;\Varid{c}\;(\Conid{\Conid{E}.Fix}\;\Conid{E}.\square)){}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.Let}\;\Varid{x}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\mid \Varid{\Conid{S}.isValue}\;\Varid{t}_{1}\to \Conid{Just}\;((\Varid{\Conid{S}.subst}\;\Varid{x}\;\Varid{t}_{1}\;\Varid{t}_{2}),\Varid{c}){}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\mid \Varid{otherwise}{}\<[20]%
	\>[20]{}\to \Conid{Just}\;(\Varid{t}_{1},\Varid{\Conid{E}.fillWithContext}\;\Varid{c}\;(\Conid{\Conid{E}.LetT}\;\Varid{x}\;\Conid{E}.\square\;\Varid{t}_{2})){}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.IntAdd}\;(\Conid{\Conid{S}.IntConst}\;\Varid{t}_{1})\;(\Conid{\Conid{S}.IntConst}\;\Varid{t}_{2}){}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\to \Conid{Just}\;(\Conid{\Conid{S}.IntConst}\;(\Varid{\Conid{I}.intAdd}\;\Varid{t}_{1}\;\Varid{t}_{2}),\Varid{c}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.IntAdd}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\mid \Varid{\Conid{S}.isValue}\;\Varid{t}_{1}\to \Conid{Just}\;(\Varid{t}_{2},\Varid{\Conid{E}.fillWithContext}\;\Varid{c}\;(\Conid{\Conid{E}.IntAddV}\;\Varid{t}_{1}\;\Conid{E}.\square)){}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\mid \Varid{otherwise}{}\<[20]%
	\>[20]{}\to \Conid{Just}\;(\Varid{t}_{1},\Varid{\Conid{E}.fillWithContext}\;\Varid{c}\;(\Conid{\Conid{E}.IntAddT}\;\Conid{E}.\square\;\Varid{t}_{2})){}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.IntSub}\;(\Conid{\Conid{S}.IntConst}\;\Varid{t}_{1})\;(\Conid{\Conid{S}.IntConst}\;\Varid{t}_{2}){}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\to \Conid{Just}\;(\Conid{\Conid{S}.IntConst}\;(\Varid{\Conid{I}.intSub}\;\Varid{t}_{1}\;\Varid{t}_{2}),\Varid{c}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.IntSub}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\mid \Varid{\Conid{S}.isValue}\;\Varid{t}_{1}\to \Conid{Just}\;(\Varid{t}_{2},\Varid{\Conid{E}.fillWithContext}\;\Varid{c}\;(\Conid{\Conid{E}.IntSubV}\;\Varid{t}_{1}\;\Conid{E}.\square)){}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\mid \Varid{otherwise}{}\<[20]%
	\>[20]{}\to \Conid{Just}\;(\Varid{t}_{1},\Varid{\Conid{E}.fillWithContext}\;\Varid{c}\;(\Conid{\Conid{E}.IntSubT}\;\Conid{E}.\square\;\Varid{t}_{2})){}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.IntMul}\;(\Conid{\Conid{S}.IntConst}\;\Varid{t}_{1})\;(\Conid{\Conid{S}.IntConst}\;\Varid{t}_{2}){}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\to \Conid{Just}\;(\Conid{\Conid{S}.IntConst}\;(\Varid{\Conid{I}.intMul}\;\Varid{t}_{1}\;\Varid{t}_{2}),\Varid{c}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.IntMul}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\mid \Varid{\Conid{S}.isValue}\;\Varid{t}_{1}\to \Conid{Just}\;(\Varid{t}_{2},\Varid{\Conid{E}.fillWithContext}\;\Varid{c}\;(\Conid{\Conid{E}.IntMulV}\;\Varid{t}_{1}\;\Conid{E}.\square)){}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\mid \Varid{otherwise}{}\<[20]%
	\>[20]{}\to \Conid{Just}\;(\Varid{t}_{1},\Varid{\Conid{E}.fillWithContext}\;\Varid{c}\;(\Conid{\Conid{E}.IntMulT}\;\Conid{E}.\square\;\Varid{t}_{2})){}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.IntDiv}\;(\Conid{\Conid{S}.IntConst}\;\Varid{t}_{1})\;(\Conid{\Conid{S}.IntConst}\;\Varid{t}_{2}){}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\to \Conid{Just}\;(\Conid{\Conid{S}.IntConst}\;(\Varid{\Conid{I}.intDiv}\;\Varid{t}_{1}\;\Varid{t}_{2}),\Varid{c}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.IntDiv}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\mid \Varid{\Conid{S}.isValue}\;\Varid{t}_{1}\to \Conid{Just}\;(\Varid{t}_{2},\Varid{\Conid{E}.fillWithContext}\;\Varid{c}\;(\Conid{\Conid{E}.IntDivV}\;\Varid{t}_{1}\;\Conid{E}.\square)){}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\mid \Varid{otherwise}{}\<[20]%
	\>[20]{}\to \Conid{Just}\;(\Varid{t}_{1},\Varid{\Conid{E}.fillWithContext}\;\Varid{c}\;(\Conid{\Conid{E}.IntDivT}\;\Conid{E}.\square\;\Varid{t}_{2})){}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.IntNand}\;(\Conid{\Conid{S}.IntConst}\;\Varid{t}_{1})\;(\Conid{\Conid{S}.IntConst}\;\Varid{t}_{2}){}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\to \Conid{Just}\;(\Conid{\Conid{S}.IntConst}\;(\Varid{\Conid{I}.intNand}\;\Varid{t}_{1}\;\Varid{t}_{2}),\Varid{c}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.IntNand}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\mid \Varid{\Conid{S}.isValue}\;\Varid{t}_{1}\to \Conid{Just}\;(\Varid{t}_{2},\Varid{\Conid{E}.fillWithContext}\;\Varid{c}\;(\Conid{\Conid{E}.IntNandV}\;\Varid{t}_{1}\;\Conid{E}.\square)){}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\mid \Varid{otherwise}{}\<[20]%
	\>[20]{}\to \Conid{Just}\;(\Varid{t}_{1},\Varid{\Conid{E}.fillWithContext}\;\Varid{c}\;(\Conid{\Conid{E}.IntNandT}\;\Conid{E}.\square\;\Varid{t}_{2})){}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.IntEq}\;(\Conid{\Conid{S}.IntConst}\;\Varid{t}_{1})\;(\Conid{\Conid{S}.IntConst}\;\Varid{t}_{2}){}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\to \Conid{Just}\;((\mathbf{if}\;(\Varid{\Conid{I}.intEq}\;\Varid{t}_{1}\;\Varid{t}_{2})\;\mathbf{then}\;\Conid{\Conid{S}.Tru}\;\mathbf{else}\;\Conid{\Conid{S}.Fls}),\Varid{c}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.IntEq}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\mid \Varid{\Conid{S}.isValue}\;\Varid{t}_{1}\to \Conid{Just}\;(\Varid{t}_{2},\Varid{\Conid{E}.fillWithContext}\;\Varid{c}\;(\Conid{\Conid{E}.IntEqV}\;\Varid{t}_{1}\;\Conid{E}.\square)){}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\mid \Varid{otherwise}{}\<[20]%
	\>[20]{}\to \Conid{Just}\;(\Varid{t}_{1},\Varid{\Conid{E}.fillWithContext}\;\Varid{c}\;(\Conid{\Conid{E}.IntEqT}\;\Conid{E}.\square\;\Varid{t}_{2})){}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.IntLt}\;(\Conid{\Conid{S}.IntConst}\;\Varid{t}_{1})\;(\Conid{\Conid{S}.IntConst}\;\Varid{t}_{2}){}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\to \Conid{Just}\;((\mathbf{if}\;(\Varid{\Conid{I}.intLt}\;\Varid{t}_{1}\;\Varid{t}_{2})\;\mathbf{then}\;\Conid{\Conid{S}.Tru}\;\mathbf{else}\;\Conid{\Conid{S}.Fls}),\Varid{c}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.IntLt}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\mid \Varid{\Conid{S}.isValue}\;\Varid{t}_{1}\to \Conid{Just}\;(\Varid{t}_{2},\Varid{\Conid{E}.fillWithContext}\;\Varid{c}\;(\Conid{\Conid{E}.IntLtV}\;\Varid{t}_{1}\;\Conid{E}.\square)){}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\mid \Varid{otherwise}{}\<[20]%
	\>[20]{}\to \Conid{Just}\;(\Varid{t}_{1},\Varid{\Conid{E}.fillWithContext}\;\Varid{c}\;(\Conid{\Conid{E}.IntLtT}\;\Conid{E}.\square\;\Varid{t}_{2})){}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Varid{otherwise}\to \mathbf{if}\;(\Varid{\Conid{S}.isValue}\;\Varid{t})\;\mathbf{then}\;(\Varid{fillTermHelper1}\;(\Varid{t},\Varid{c})\;\Conid{E}.\square)\;\mathbf{else}\;\Conid{Nothing}{}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\Varid{fillTermHelper1}\mathbin{::}(\Conid{\Conid{S}.Term},\Conid{\Conid{E}.Context})\to \Conid{\Conid{E}.Context}\to \Conid{Maybe}\;(\Conid{\Conid{S}.Term},\Conid{\Conid{E}.Context}){}\<[E]%
	\\
	\>[B]{}\Varid{fillTermHelper1}\;(\Varid{t},\Varid{c})\;\Varid{c1}\mathrel{=}\mathbf{case}\;\Varid{c}\;\mathbf{of}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{E}.\square\to \Conid{Nothing}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{E}.AppT}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[20]%
	\>[20]{}\to \Varid{fTH2}\;(\Varid{t},\Varid{c},\Varid{c1},\Varid{t}_{1},(\Conid{\Conid{E}.AppT}\;\Conid{E}.\square\;\Varid{t}_{2})){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{E}.AppV}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[20]%
	\>[20]{}\to \Varid{fTH2}\;(\Varid{t},\Varid{c},\Varid{c1},\Varid{t}_{2},(\Conid{\Conid{E}.AppV}\;\Varid{t}_{1}\;\Conid{E}.\square)){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{E}.If}\;\Varid{t}_{1}\;\Varid{t}_{2}\;\Varid{t}_{3}{}\<[20]%
	\>[20]{}\to \Varid{fTH2}\;(\Varid{t},\Varid{c},\Varid{c1},\Varid{t}_{1},(\Conid{\Conid{E}.If}\;\Conid{E}.\square\;\Varid{t}_{2}\;\Varid{t}_{3})){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{E}.Fix}\;\Varid{t}_{1}{}\<[20]%
	\>[20]{}\to \Varid{fTH2}\;(\Varid{t},\Varid{c},\Varid{c1},\Varid{t}_{1},(\Conid{\Conid{E}.Fix}\;\Conid{E}.\square)){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{E}.LetT}\;\Varid{x}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[20]%
	\>[20]{}\to \Varid{fTH2}\;(\Varid{t},\Varid{c},\Varid{c1},\Varid{t}_{1},(\Conid{\Conid{E}.LetT}\;\Varid{x}\;\Conid{E}.\square\;\Varid{t}_{2})){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{E}.IntAddV}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[20]%
	\>[20]{}\to \Varid{fTH2}\;(\Varid{t},\Varid{c},\Varid{c1},\Varid{t}_{2},(\Conid{\Conid{E}.IntAddV}\;\Varid{t}_{1}\;\Conid{E}.\square)){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{E}.IntAddT}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[20]%
	\>[20]{}\to \Varid{fTH2}\;(\Varid{t},\Varid{c},\Varid{c1},\Varid{t}_{1},(\Conid{\Conid{E}.IntAddT}\;\Conid{E}.\square\;\Varid{t}_{2})){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{E}.IntSubV}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[20]%
	\>[20]{}\to \Varid{fTH2}\;(\Varid{t},\Varid{c},\Varid{c1},\Varid{t}_{2},(\Conid{\Conid{E}.IntSubV}\;\Varid{t}_{1}\;\Conid{E}.\square)){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{E}.IntSubT}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[20]%
	\>[20]{}\to \Varid{fTH2}\;(\Varid{t},\Varid{c},\Varid{c1},\Varid{t}_{1},(\Conid{\Conid{E}.IntSubT}\;\Conid{E}.\square\;\Varid{t}_{2})){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{E}.IntMulV}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[20]%
	\>[20]{}\to \Varid{fTH2}\;(\Varid{t},\Varid{c},\Varid{c1},\Varid{t}_{2},(\Conid{\Conid{E}.IntMulV}\;\Varid{t}_{1}\;\Conid{E}.\square)){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{E}.IntMulT}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[20]%
	\>[20]{}\to \Varid{fTH2}\;(\Varid{t},\Varid{c},\Varid{c1},\Varid{t}_{1},(\Conid{\Conid{E}.IntMulT}\;\Conid{E}.\square\;\Varid{t}_{2})){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{E}.IntDivV}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[20]%
	\>[20]{}\to \Varid{fTH2}\;(\Varid{t},\Varid{c},\Varid{c1},\Varid{t}_{2},(\Conid{\Conid{E}.IntDivV}\;\Varid{t}_{1}\;\Conid{E}.\square)){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{E}.IntDivT}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[20]%
	\>[20]{}\to \Varid{fTH2}\;(\Varid{t},\Varid{c},\Varid{c1},\Varid{t}_{1},(\Conid{\Conid{E}.IntDivT}\;\Conid{E}.\square\;\Varid{t}_{2})){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{E}.IntNandV}\;\Varid{t}_{1}\;\Varid{t}_{2}\to \Varid{fTH2}\;(\Varid{t},\Varid{c},\Varid{c1},\Varid{t}_{2},(\Conid{\Conid{E}.IntNandV}\;\Varid{t}_{1}\;\Conid{E}.\square)){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{E}.IntNandT}\;\Varid{t}_{1}\;\Varid{t}_{2}\to \Varid{fTH2}\;(\Varid{t},\Varid{c},\Varid{c1},\Varid{t}_{1},(\Conid{\Conid{E}.IntNandT}\;\Conid{E}.\square\;\Varid{t}_{2})){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{E}.IntEqV}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[20]%
	\>[20]{}\to \Varid{fTH2}\;(\Varid{t},\Varid{c},\Varid{c1},\Varid{t}_{2},(\Conid{\Conid{E}.IntEqV}\;\Varid{t}_{1}\;\Conid{E}.\square)){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{E}.IntEqT}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[20]%
	\>[20]{}\to \Varid{fTH2}\;(\Varid{t},\Varid{c},\Varid{c1},\Varid{t}_{1},(\Conid{\Conid{E}.IntEqT}\;\Conid{E}.\square\;\Varid{t}_{2})){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{E}.IntLtV}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[20]%
	\>[20]{}\to \Varid{fTH2}\;(\Varid{t},\Varid{c},\Varid{c1},\Varid{t}_{2},(\Conid{\Conid{E}.IntLtV}\;\Varid{t}_{1}\;\Conid{E}.\square)){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{E}.IntLtT}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[20]%
	\>[20]{}\to \Varid{fTH2}\;(\Varid{t},\Varid{c},\Varid{c1},\Varid{t}_{1},(\Conid{\Conid{E}.IntLtT}\;\Conid{E}.\square\;\Varid{t}_{2})){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Varid{otherwise}{}\<[20]%
	\>[20]{}\to \Conid{Nothing}{}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\mbox{\onelinecomment  This function takes a term t and a context c, this context may fill a hole in}{}\<[E]%
	\\
	\>[B]{}\mbox{\onelinecomment  context c1, context c2 is the nested context in c if c2 is not a hole to be}{}\<[E]%
	\\
	\>[B]{}\mbox{\onelinecomment  filled by t then we recur and c3 pererves the structure of c at that level, }{}\<[E]%
	\\
	\>[B]{}\mbox{\onelinecomment  with a hole where c2 is taken from.}{}\<[E]%
	\\
	\>[B]{}\Varid{fTH2}\mathbin{::}(\Conid{\Conid{S}.Term},\Conid{\Conid{E}.Context},\Conid{\Conid{E}.Context},\Conid{\Conid{E}.Context},\Conid{\Conid{E}.Context})\to \Conid{Maybe}\;(\Conid{\Conid{S}.Term},\Conid{\Conid{E}.Context}){}\<[E]%
	\\
	\>[B]{}\Varid{fTH2}\;(\Varid{t},\Varid{c},\Varid{c1},\Varid{c2},\Varid{c3})\mathrel{=}\mathbf{if}\;(\Varid{isHole}\;\Varid{c2})\;\mathbf{then}\;\Conid{Just}\;(\Varid{\Conid{E}.fillWithTerm}\;\Varid{c}\;\Varid{t},\Varid{c1}){}\<[E]%
	\\
	\>[B]{}\hsindent{23}{}\<[23]%
	\>[23]{}\mathbf{else}\;(\Varid{fillTermHelper1}\;(\Varid{t},\Varid{c2})\;(\Varid{\Conid{E}.fillWithContext}\;\Varid{c1}\;\Varid{c3})){}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\Varid{isHole}\mathbin{::}\Conid{\Conid{E}.Context}\to \Conid{Bool}{}\<[E]%
	\\
	\>[B]{}\Varid{isHole}\;\Conid{E}.\square\mathrel{=}\Conid{True}{}\<[E]%
	\\
	\>[B]{}\Varid{isHole}\;\anonymous {}\<[15]%
	\>[15]{}\mathrel{=}\Conid{False}{}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\Varid{ccMachineEvalHelp}\mathbin{::}(\Conid{\Conid{S}.Term},\Conid{\Conid{E}.Context})\to (\Conid{\Conid{S}.Term},\Conid{\Conid{E}.Context}){}\<[E]%
	\\
	\>[B]{}\Varid{ccMachineEvalHelp}\;(\Varid{t},\Varid{c})\mathrel{=}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\mathbf{case}\;\Varid{ccMachineStep}\;(\Varid{t},\Varid{c})\;\mathbf{of}{}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\Conid{Just}\;\Varid{t'}\to \Varid{ccMachineEvalHelp}\;\Varid{t'}{}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\Conid{Nothing}\to (\Varid{t},\Varid{c}){}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\Varid{ccMachineEval}\mathbin{::}\Conid{\Conid{S}.Term}\to \Conid{\Conid{S}.Term}{}\<[E]%
	\\
	\>[B]{}\Varid{ccMachineEval}\;\Varid{t}\mathrel{=}\Varid{fst}\;(\Varid{ccMachineEvalHelp}\;(\Varid{t},\Conid{E}.\square)){}\<[E]%
	\ColumnHook
\end{hscode}\resethooks

\horrule{0.5pt} \\[0.2cm]

\subsubsection{SCCMachine}

\noindent Very similar to the CCMachine, this machine however will look at the context once a term is reduced to a value in order to decide what to do next.  This allows for applications and operations to be done immediately once the terms needed are reduced to values.  This does the same thing as the CCMachine but it combines steps which make its evaluation much simpler.    \\

\begin{hscode}\SaveRestoreHook
	\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{3}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{5}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{15}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{20}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{23}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{24}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{41}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
	\>[B]{}\mathbf{module}\;\Conid{SCCMachine}\;\mathbf{where}{}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\mathbf{import}\;\Varid{qualified}\;\Conid{AbstractSyntax}\;\Varid{as}\;\Conid{S}{}\<[E]%
	\\
	\>[B]{}\mathbf{import}\;\Varid{qualified}\;\Conid{EvaluationContext}\;\Varid{as}\;\Conid{E}{}\<[E]%
	\\
	\>[B]{}\mathbf{import}\;\Varid{qualified}\;\Conid{IntegerArithmetic}\;\Varid{as}\;\Conid{I}{}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\Varid{sccMachineStep}\mathbin{::}(\Conid{\Conid{S}.Term},\Conid{\Conid{E}.Context})\to \Conid{Maybe}\;(\Conid{\Conid{S}.Term},\Conid{\Conid{E}.Context}){}\<[E]%
	\\
	\>[B]{}\Varid{sccMachineStep}\;(\Varid{t},\Varid{c})\mathrel{=}\mathbf{case}\;\Varid{t}\;\mathbf{of}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.App}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[24]%
	\>[24]{}\to \Conid{Just}\;(\Varid{t}_{1},\Varid{\Conid{E}.fillWithContext}\;\Varid{c}\;(\Conid{\Conid{E}.AppT}\;\Conid{E}.\square\;\Varid{t}_{2})){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.If}\;\Varid{t}_{1}\;\Varid{t}_{2}\;\Varid{t}_{3}{}\<[24]%
	\>[24]{}\to \Conid{Just}\;(\Varid{t}_{1},\Varid{\Conid{E}.fillWithContext}\;\Varid{c}\;(\Conid{\Conid{E}.If}\;\Conid{E}.\square\;\Varid{t}_{2}\;\Varid{t}_{3})){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.Fix}\;\Varid{t}_{1}{}\<[24]%
	\>[24]{}\to \Conid{Just}\;(\Varid{t}_{1},\Varid{\Conid{E}.fillWithContext}\;\Varid{c}\;(\Conid{\Conid{E}.Fix}\;\Conid{E}.\square)){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.Let}\;\Varid{x}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[24]%
	\>[24]{}\to \Conid{Just}\;(\Varid{t}_{1},\Varid{\Conid{E}.fillWithContext}\;\Varid{c}\;(\Conid{\Conid{E}.LetT}\;\Varid{x}\;\Conid{E}.\square\;\Varid{t}_{2})){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.IntAdd}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[24]%
	\>[24]{}\to \Conid{Just}\;(\Varid{t}_{1},\Varid{\Conid{E}.fillWithContext}\;\Varid{c}\;(\Conid{\Conid{E}.IntAddT}\;\Conid{E}.\square\;\Varid{t}_{2})){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.IntSub}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[24]%
	\>[24]{}\to \Conid{Just}\;(\Varid{t}_{1},\Varid{\Conid{E}.fillWithContext}\;\Varid{c}\;(\Conid{\Conid{E}.IntSubT}\;\Conid{E}.\square\;\Varid{t}_{2})){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.IntMul}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[24]%
	\>[24]{}\to \Conid{Just}\;(\Varid{t}_{1},\Varid{\Conid{E}.fillWithContext}\;\Varid{c}\;(\Conid{\Conid{E}.IntMulT}\;\Conid{E}.\square\;\Varid{t}_{2})){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.IntDiv}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[24]%
	\>[24]{}\to \Conid{Just}\;(\Varid{t}_{1},\Varid{\Conid{E}.fillWithContext}\;\Varid{c}\;(\Conid{\Conid{E}.IntDivT}\;\Conid{E}.\square\;\Varid{t}_{2})){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.IntNand}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[24]%
	\>[24]{}\to \Conid{Just}\;(\Varid{t}_{1},\Varid{\Conid{E}.fillWithContext}\;\Varid{c}\;(\Conid{\Conid{E}.IntNandT}\;\Conid{E}.\square\;\Varid{t}_{2})){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.IntEq}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[24]%
	\>[24]{}\to \Conid{Just}\;(\Varid{t}_{1},\Varid{\Conid{E}.fillWithContext}\;\Varid{c}\;(\Conid{\Conid{E}.IntEqT}\;\Conid{E}.\square\;\Varid{t}_{2})){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.IntLt}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[24]%
	\>[24]{}\to \Conid{Just}\;(\Varid{t}_{1},\Varid{\Conid{E}.fillWithContext}\;\Varid{c}\;(\Conid{\Conid{E}.IntLtT}\;\Conid{E}.\square\;\Varid{t}_{2})){}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Varid{otherwise}\to \mathbf{if}\;(\Varid{\Conid{S}.isValue}\;\Varid{t})\;\mathbf{then}\;(\Varid{fillTermHelper1}\;(\Varid{t},\Varid{c})\;\Conid{E}.\square)\;\mathbf{else}\;\Conid{Nothing}{}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\mbox{\onelinecomment  Similar to the one in the CC machine but this handles cases of flipping }{}\<[E]%
	\\
	\>[B]{}\mbox{\onelinecomment  contexts like E.AppT E.Hole t2 for E.AppV t1 E.Hole where t1 is a value this}{}\<[E]%
	\\
	\>[B]{}\mbox{\onelinecomment  also handles cases where terms can be applied such as addition or application}{}\<[E]%
	\\
	\>[B]{}\mbox{\onelinecomment  this context is removed and used to create a new value, leaving a E.Hole in }{}\<[E]%
	\\
	\>[B]{}\mbox{\onelinecomment  since that particular redux is complete. }{}\<[E]%
	\\
	\>[B]{}\Varid{fillTermHelper1}\mathbin{::}(\Conid{\Conid{S}.Term},\Conid{\Conid{E}.Context})\to \Conid{\Conid{E}.Context}\to \Conid{Maybe}\;(\Conid{\Conid{S}.Term},\Conid{\Conid{E}.Context}){}\<[E]%
	\\
	\>[B]{}\Varid{fillTermHelper1}\;(\Varid{t},\Varid{c})\;\Varid{c1}\mathrel{=}\mathbf{case}\;\Varid{c}\;\mathbf{of}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{E}.\square\to \Conid{Nothing}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{E}.AppT}\;\Conid{E}.\square\;\Varid{t}_{2}\to \Conid{Just}\;(\Varid{t}_{2},\Varid{\Conid{E}.fillWithContext}\;\Varid{c1}\;(\Conid{\Conid{E}.AppV}\;\Varid{t}\;\Conid{E}.\square)){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{E}.AppT}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[20]%
	\>[20]{}\to \Varid{fTH2}\;(\Varid{t},\Varid{c},\Varid{c1},\Varid{t}_{1},(\Conid{\Conid{E}.AppT}\;\Conid{E}.\square\;\Varid{t}_{2})){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{E}.AppV}\;(\Conid{\Conid{S}.Abs}\;\Varid{x}\;\anonymous \;\Varid{t}_{12})\;\Conid{E}.\square{}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\to \Conid{Just}\;((\Varid{\Conid{S}.subst}\;\Varid{x}\;\Varid{t}\;\Varid{t}_{12}),\Varid{c1}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{E}.AppV}\;\anonymous \;\Conid{E}.\square{}\<[20]%
	\>[20]{}\to \Conid{Nothing}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{E}.AppV}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[20]%
	\>[20]{}\to \Varid{fTH2}\;(\Varid{t},\Varid{c},\Varid{c1},\Varid{t}_{2},(\Conid{\Conid{E}.AppV}\;\Varid{t}_{1}\;\Conid{E}.\square)){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{E}.If}\;\Conid{E}.\square\;\Varid{t}_{2}\;\Varid{t}_{3}{}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\mid \Varid{t}\equiv \Conid{\Conid{S}.Tru}{}\<[20]%
	\>[20]{}\to \Conid{Just}\;(\Varid{t}_{2},\Varid{c1}){}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\mid \Varid{t}\equiv \Conid{\Conid{S}.Fls}{}\<[20]%
	\>[20]{}\to \Conid{Just}\;(\Varid{t}_{3},\Varid{c1}){}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\mid \Varid{otherwise}{}\<[20]%
	\>[20]{}\to \Conid{Nothing}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{E}.If}\;\Varid{t}_{1}\;\Varid{t}_{2}\;\Varid{t}_{3}{}\<[20]%
	\>[20]{}\to \Varid{fTH2}\;(\Varid{t},\Varid{c},\Varid{c1},\Varid{t}_{1},(\Conid{\Conid{E}.If}\;\Conid{E}.\square\;\Varid{t}_{2}\;\Varid{t}_{3})){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{E}.Fix}\;\Conid{E}.\square{}\<[20]%
	\>[20]{}\to \Varid{fixHelper}\;(\Conid{\Conid{S}.Fix}\;\Varid{t},\Varid{c1}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{E}.Fix}\;\Varid{t}_{1}{}\<[20]%
	\>[20]{}\to \Varid{fTH2}\;(\Varid{t},\Varid{c},\Varid{c1},\Varid{t}_{1},(\Conid{\Conid{E}.Fix}\;\Conid{E}.\square)){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{E}.LetT}\;\Varid{x}\;\Conid{E}.\square\;\Varid{t}_{2}{}\<[E]%
	\\
	\>[3]{}\hsindent{17}{}\<[20]%
	\>[20]{}\to \Conid{Just}\;((\Varid{\Conid{S}.subst}\;\Varid{x}\;\Varid{t}\;\Varid{t}_{2}),\Varid{c1}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{E}.LetT}\;\Varid{x}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[20]%
	\>[20]{}\to \Varid{fTH2}\;(\Varid{t},\Varid{c},\Varid{c1},\Varid{t}_{1},(\Conid{\Conid{E}.LetT}\;\Varid{x}\;\Conid{E}.\square\;\Varid{t}_{2})){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{E}.IntAddV}\;\Varid{t}_{1}\;\Conid{E}.\square{}\<[E]%
	\\
	\>[3]{}\hsindent{17}{}\<[20]%
	\>[20]{}\to \Varid{binaryOpHelp}\;((\Conid{\Conid{S}.IntAdd}\;\Varid{t}_{1}\;\Varid{t}),\Varid{c1}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{E}.IntAddV}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[20]%
	\>[20]{}\to \Varid{fTH2}\;(\Varid{t},\Varid{c},\Varid{c1},\Varid{t}_{2},(\Conid{\Conid{E}.IntAddV}\;\Varid{t}_{1}\;\Conid{E}.\square)){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{E}.IntAddT}\;\Conid{E}.\square\;\Varid{t}_{2}{}\<[E]%
	\\
	\>[3]{}\hsindent{17}{}\<[20]%
	\>[20]{}\to \Conid{Just}\;(\Varid{t}_{2},\Varid{\Conid{E}.fillWithContext}\;\Varid{c1}\;(\Conid{\Conid{E}.IntAddV}\;\Varid{t}\;\Conid{E}.\square)){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{E}.IntAddT}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[20]%
	\>[20]{}\to \Varid{fTH2}\;(\Varid{t},\Varid{c},\Varid{c1},\Varid{t}_{1},(\Conid{\Conid{E}.IntAddT}\;\Conid{E}.\square\;\Varid{t}_{2})){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{E}.IntSubV}\;\Varid{t}_{1}\;\Conid{E}.\square{}\<[E]%
	\\
	\>[3]{}\hsindent{17}{}\<[20]%
	\>[20]{}\to \Varid{binaryOpHelp}\;((\Conid{\Conid{S}.IntSub}\;\Varid{t}_{1}\;\Varid{t}),\Varid{c1}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{E}.IntSubV}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[20]%
	\>[20]{}\to \Varid{fTH2}\;(\Varid{t},\Varid{c},\Varid{c1},\Varid{t}_{2},(\Conid{\Conid{E}.IntSubV}\;\Varid{t}_{1}\;\Conid{E}.\square)){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{E}.IntSubT}\;\Conid{E}.\square\;\Varid{t}_{2}{}\<[E]%
	\\
	\>[3]{}\hsindent{17}{}\<[20]%
	\>[20]{}\to \Conid{Just}\;(\Varid{t}_{2},\Varid{\Conid{E}.fillWithContext}\;\Varid{c1}\;(\Conid{\Conid{E}.IntSubV}\;\Varid{t}\;\Conid{E}.\square)){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{E}.IntSubT}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[20]%
	\>[20]{}\to \Varid{fTH2}\;(\Varid{t},\Varid{c},\Varid{c1},\Varid{t}_{1},(\Conid{\Conid{E}.IntSubT}\;\Conid{E}.\square\;\Varid{t}_{2})){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{E}.IntMulV}\;\Varid{t}_{1}\;\Conid{E}.\square{}\<[E]%
	\\
	\>[3]{}\hsindent{17}{}\<[20]%
	\>[20]{}\to \Varid{binaryOpHelp}\;((\Conid{\Conid{S}.IntMul}\;\Varid{t}_{1}\;\Varid{t}),\Varid{c1}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{E}.IntMulV}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[20]%
	\>[20]{}\to \Varid{fTH2}\;(\Varid{t},\Varid{c},\Varid{c1},\Varid{t}_{2},(\Conid{\Conid{E}.IntMulV}\;\Varid{t}_{1}\;\Conid{E}.\square)){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{E}.IntMulT}\;\Conid{E}.\square\;\Varid{t}_{2}{}\<[E]%
	\\
	\>[3]{}\hsindent{17}{}\<[20]%
	\>[20]{}\to \Conid{Just}\;(\Varid{t}_{2},\Varid{\Conid{E}.fillWithContext}\;\Varid{c1}\;(\Conid{\Conid{E}.IntMulV}\;\Varid{t}\;\Conid{E}.\square)){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{E}.IntMulT}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[20]%
	\>[20]{}\to \Varid{fTH2}\;(\Varid{t},\Varid{c},\Varid{c1},\Varid{t}_{1},(\Conid{\Conid{E}.IntMulT}\;\Conid{E}.\square\;\Varid{t}_{2})){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{E}.IntDivV}\;\Varid{t}_{1}\;\Conid{E}.\square{}\<[E]%
	\\
	\>[3]{}\hsindent{17}{}\<[20]%
	\>[20]{}\to \Varid{binaryOpHelp}\;((\Conid{\Conid{S}.IntDiv}\;\Varid{t}_{1}\;\Varid{t}),\Varid{c1}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{E}.IntDivV}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[20]%
	\>[20]{}\to \Varid{fTH2}\;(\Varid{t},\Varid{c},\Varid{c1},\Varid{t}_{2},(\Conid{\Conid{E}.IntDivV}\;\Varid{t}_{1}\;\Conid{E}.\square)){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{E}.IntDivT}\;\Conid{E}.\square\;\Varid{t}_{2}{}\<[E]%
	\\
	\>[3]{}\hsindent{17}{}\<[20]%
	\>[20]{}\to \Conid{Just}\;(\Varid{t}_{2},\Varid{\Conid{E}.fillWithContext}\;\Varid{c1}\;(\Conid{\Conid{E}.IntDivV}\;\Varid{t}\;\Conid{E}.\square)){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{E}.IntDivT}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[20]%
	\>[20]{}\to \Varid{fTH2}\;(\Varid{t},\Varid{c},\Varid{c1},\Varid{t}_{1},(\Conid{\Conid{E}.IntDivT}\;\Conid{E}.\square\;\Varid{t}_{2})){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{E}.IntNandV}\;\Varid{t}_{1}\;\Conid{E}.\square{}\<[E]%
	\\
	\>[3]{}\hsindent{17}{}\<[20]%
	\>[20]{}\to \Varid{binaryOpHelp}\;((\Conid{\Conid{S}.IntNand}\;\Varid{t}_{1}\;\Varid{t}),\Varid{c1}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{E}.IntNandV}\;\Varid{t}_{1}\;\Varid{t}_{2}\to \Varid{fTH2}\;(\Varid{t},\Varid{c},\Varid{c1},\Varid{t}_{2},(\Conid{\Conid{E}.IntNandV}\;\Varid{t}_{1}\;\Conid{E}.\square)){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{E}.IntNandT}\;\Conid{E}.\square\;\Varid{t}_{2}{}\<[E]%
	\\
	\>[3]{}\hsindent{17}{}\<[20]%
	\>[20]{}\to \Conid{Just}\;(\Varid{t}_{2},\Varid{\Conid{E}.fillWithContext}\;\Varid{c1}\;(\Conid{\Conid{E}.IntNandV}\;\Varid{t}\;\Conid{E}.\square)){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{E}.IntNandT}\;\Varid{t}_{1}\;\Varid{t}_{2}\to \Varid{fTH2}\;(\Varid{t},\Varid{c},\Varid{c1},\Varid{t}_{1},(\Conid{\Conid{E}.IntNandT}\;\Conid{E}.\square\;\Varid{t}_{2})){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{E}.IntEqV}\;\Varid{t}_{1}\;\Conid{E}.\square{}\<[E]%
	\\
	\>[3]{}\hsindent{17}{}\<[20]%
	\>[20]{}\to \Varid{binaryOpHelp}\;((\Conid{\Conid{S}.IntEq}\;\Varid{t}_{1}\;\Varid{t}),\Varid{c1}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{E}.IntEqV}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[20]%
	\>[20]{}\to \Varid{fTH2}\;(\Varid{t},\Varid{c},\Varid{c1},\Varid{t}_{2},(\Conid{\Conid{E}.IntEqV}\;\Varid{t}_{1}\;\Conid{E}.\square)){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{E}.IntEqT}\;\Conid{E}.\square\;\Varid{t}_{2}{}\<[E]%
	\\
	\>[3]{}\hsindent{17}{}\<[20]%
	\>[20]{}\to \Conid{Just}\;(\Varid{t}_{2},\Varid{\Conid{E}.fillWithContext}\;\Varid{c1}\;(\Conid{\Conid{E}.IntEqV}\;\Varid{t}\;\Conid{E}.\square)){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{E}.IntEqT}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[20]%
	\>[20]{}\to \Varid{fTH2}\;(\Varid{t},\Varid{c},\Varid{c1},\Varid{t}_{1},(\Conid{\Conid{E}.IntEqT}\;\Conid{E}.\square\;\Varid{t}_{2})){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{E}.IntLtV}\;\Varid{t}_{1}\;\Conid{E}.\square{}\<[E]%
	\\
	\>[3]{}\hsindent{17}{}\<[20]%
	\>[20]{}\to \Varid{binaryOpHelp}\;((\Conid{\Conid{S}.IntLt}\;\Varid{t}_{1}\;\Varid{t}),\Varid{c1}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{E}.IntLtV}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[20]%
	\>[20]{}\to \Varid{fTH2}\;(\Varid{t},\Varid{c},\Varid{c1},\Varid{t}_{2},(\Conid{\Conid{E}.IntLtV}\;\Varid{t}_{1}\;\Conid{E}.\square)){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{E}.IntLtT}\;\Conid{E}.\square\;\Varid{t}_{2}{}\<[E]%
	\\
	\>[3]{}\hsindent{17}{}\<[20]%
	\>[20]{}\to \Conid{Just}\;(\Varid{t}_{2},\Varid{\Conid{E}.fillWithContext}\;\Varid{c1}\;(\Conid{\Conid{E}.IntLtV}\;\Varid{t}\;\Conid{E}.\square)){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{E}.IntLtT}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[20]%
	\>[20]{}\to \Varid{fTH2}\;(\Varid{t},\Varid{c},\Varid{c1},\Varid{t}_{1},(\Conid{\Conid{E}.IntLtT}\;\Conid{E}.\square\;\Varid{t}_{2})){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Varid{otherwise}{}\<[20]%
	\>[20]{}\to \Conid{Nothing}{}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\mbox{\onelinecomment  This function takes a term t and a context c, this context may fill a hole in}{}\<[E]%
	\\
	\>[B]{}\mbox{\onelinecomment  context c1, context c2 is the nested context in c if c2 is not a hole to be}{}\<[E]%
	\\
	\>[B]{}\mbox{\onelinecomment  filled by t then we recur and c3 pererves the structure of c at that level, }{}\<[E]%
	\\
	\>[B]{}\mbox{\onelinecomment  with a hole where c2 is taken from.}{}\<[E]%
	\\
	\>[B]{}\Varid{fTH2}\mathbin{::}(\Conid{\Conid{S}.Term},\Conid{\Conid{E}.Context},\Conid{\Conid{E}.Context},\Conid{\Conid{E}.Context},\Conid{\Conid{E}.Context})\to \Conid{Maybe}\;(\Conid{\Conid{S}.Term},\Conid{\Conid{E}.Context}){}\<[E]%
	\\
	\>[B]{}\Varid{fTH2}\;(\Varid{t},\Varid{c},\Varid{c1},\Varid{c2},\Varid{c3})\mathrel{=}\mathbf{if}\;(\Varid{isHole}\;\Varid{c2})\;\mathbf{then}\;\Conid{Just}\;(\Varid{\Conid{E}.fillWithTerm}\;\Varid{c}\;\Varid{t},\Varid{c1}){}\<[E]%
	\\
	\>[B]{}\hsindent{23}{}\<[23]%
	\>[23]{}\mathbf{else}\;(\Varid{fillTermHelper1}\;(\Varid{t},\Varid{c2})\;(\Varid{\Conid{E}.fillWithContext}\;\Varid{c1}\;\Varid{c3})){}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\Varid{fixHelper}\mathbin{::}(\Conid{\Conid{S}.Term},\Conid{\Conid{E}.Context})\to \Conid{Maybe}\;(\Conid{\Conid{S}.Term},\Conid{\Conid{E}.Context}){}\<[E]%
	\\
	\>[B]{}\Varid{fixHelper}\;(\Varid{t}\mathord{@}(\Conid{\Conid{S}.Fix}\;(\Conid{\Conid{S}.Abs}\;\Varid{x}\;\Varid{y}\;\Varid{t}_{1})),\Varid{c})\mathrel{=}\Conid{Just}\;((\Varid{\Conid{S}.subst}\;\Varid{x}\;\Varid{t}\;\Varid{t}_{1}),\Varid{c}){}\<[E]%
	\\
	\>[B]{}\Varid{fixHelper}\;(\anonymous ,\Varid{c}){}\<[41]%
	\>[41]{}\mathrel{=}\Conid{Nothing}{}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\Varid{binaryOpHelp}\mathbin{::}(\Conid{\Conid{S}.Term},\Conid{\Conid{E}.Context})\to \Conid{Maybe}\;(\Conid{\Conid{S}.Term},\Conid{\Conid{E}.Context}){}\<[E]%
	\\
	\>[B]{}\Varid{binaryOpHelp}\;(\Varid{t},\Varid{c})\mathrel{=}\mathbf{case}\;\Varid{t}\;\mathbf{of}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.IntAdd}\;(\Conid{\Conid{S}.IntConst}\;\Varid{t}_{1})\;(\Conid{\Conid{S}.IntConst}\;\Varid{t}_{2}){}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\to \Conid{Just}\;(\Conid{\Conid{S}.IntConst}\;(\Varid{\Conid{I}.intAdd}\;\Varid{t}_{1}\;\Varid{t}_{2}),\Varid{c}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.IntSub}\;(\Conid{\Conid{S}.IntConst}\;\Varid{t}_{1})\;(\Conid{\Conid{S}.IntConst}\;\Varid{t}_{2}){}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\to \Conid{Just}\;(\Conid{\Conid{S}.IntConst}\;(\Varid{\Conid{I}.intSub}\;\Varid{t}_{1}\;\Varid{t}_{2}),\Varid{c}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.IntMul}\;(\Conid{\Conid{S}.IntConst}\;\Varid{t}_{1})\;(\Conid{\Conid{S}.IntConst}\;\Varid{t}_{2}){}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\to \Conid{Just}\;(\Conid{\Conid{S}.IntConst}\;(\Varid{\Conid{I}.intMul}\;\Varid{t}_{1}\;\Varid{t}_{2}),\Varid{c}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.IntDiv}\;(\Conid{\Conid{S}.IntConst}\;\Varid{t}_{1})\;(\Conid{\Conid{S}.IntConst}\;\Varid{t}_{2}){}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\to \Conid{Just}\;(\Conid{\Conid{S}.IntConst}\;(\Varid{\Conid{I}.intDiv}\;\Varid{t}_{1}\;\Varid{t}_{2}),\Varid{c}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.IntNand}\;(\Conid{\Conid{S}.IntConst}\;\Varid{t}_{1})\;(\Conid{\Conid{S}.IntConst}\;\Varid{t}_{2}){}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\to \Conid{Just}\;(\Conid{\Conid{S}.IntConst}\;(\Varid{\Conid{I}.intNand}\;\Varid{t}_{1}\;\Varid{t}_{2}),\Varid{c}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.IntEq}\;(\Conid{\Conid{S}.IntConst}\;\Varid{t}_{1})\;(\Conid{\Conid{S}.IntConst}\;\Varid{t}_{2}){}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\to \Conid{Just}\;((\mathbf{if}\;(\Varid{\Conid{I}.intEq}\;\Varid{t}_{1}\;\Varid{t}_{2})\;\mathbf{then}\;\Conid{\Conid{S}.Tru}\;\mathbf{else}\;\Conid{\Conid{S}.Fls}),\Varid{c}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.IntLt}\;(\Conid{\Conid{S}.IntConst}\;\Varid{t}_{1})\;(\Conid{\Conid{S}.IntConst}\;\Varid{t}_{2}){}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\to \Conid{Just}\;((\mathbf{if}\;(\Varid{\Conid{I}.intLt}\;\Varid{t}_{1}\;\Varid{t}_{2})\;\mathbf{then}\;\Conid{\Conid{S}.Tru}\;\mathbf{else}\;\Conid{\Conid{S}.Fls}),\Varid{c}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Varid{otherwise}{}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\to \Conid{Nothing}{}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\Varid{isHole}\mathbin{::}\Conid{\Conid{E}.Context}\to \Conid{Bool}{}\<[E]%
	\\
	\>[B]{}\Varid{isHole}\;\Conid{E}.\square\mathrel{=}\Conid{True}{}\<[E]%
	\\
	\>[B]{}\Varid{isHole}\;\anonymous {}\<[15]%
	\>[15]{}\mathrel{=}\Conid{False}{}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\Varid{sccMachineEvalHelp}\mathbin{::}(\Conid{\Conid{S}.Term},\Conid{\Conid{E}.Context})\to (\Conid{\Conid{S}.Term},\Conid{\Conid{E}.Context}){}\<[E]%
	\\
	\>[B]{}\Varid{sccMachineEvalHelp}\;(\Varid{t},\Varid{c})\mathrel{=}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\mathbf{case}\;\Varid{sccMachineStep}\;(\Varid{t},\Varid{c})\;\mathbf{of}{}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\Conid{Just}\;\Varid{t'}\to \Varid{sccMachineEvalHelp}\;\Varid{t'}{}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\Conid{Nothing}\to (\Varid{t},\Varid{c}){}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\Varid{sccMachineEval}\mathbin{::}\Conid{\Conid{S}.Term}\to \Conid{\Conid{S}.Term}{}\<[E]%
	\\
	\>[B]{}\Varid{sccMachineEval}\;\Varid{t}\mathrel{=}\Varid{fst}\;(\Varid{sccMachineEvalHelp}\;(\Varid{t},\Conid{E}.\square)){}\<[E]%
	\ColumnHook
\end{hscode}\resethooks

\horrule{0.5pt} \\[0.2cm]

\subsubsection{CKMachine}

\noindent This machine does something similar to the CC and SCC machines but this uses a continuation structure rather then a context tree.  Allowing for the machine to use the head of the continuation structure when a reduction is done, instead of requiring that the context tree be traversed in order for the programs state to be updated. \\

\begin{hscode}\SaveRestoreHook
	\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{3}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{5}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{12}{@{}>{\hspre}c<{\hspost}@{}}%
	\column{12E}{@{}l@{}}%
	\column{15}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{20}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{24}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{32}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{41}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
	\>[B]{}\mathbf{module}\;\Conid{CKMachine}\;\mathbf{where}{}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\mathbf{import}\;\Varid{qualified}\;\Conid{AbstractSyntax}\;\Varid{as}\;\Conid{S}{}\<[E]%
	\\
	\>[B]{}\mathbf{import}\;\Varid{qualified}\;\Conid{IntegerArithmetic}\;\Varid{as}\;\Conid{I}{}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\mathbf{data}\;\Conid{Cont}{}\<[12]%
	\>[12]{}\mathrel{=}{}\<[12E]%
	\>[15]{}\varodot{}\<[E]%
	\\
	\>[12]{}\mid {}\<[12E]%
	\>[15]{}\Conid{Fun}\;{}\<[32]%
	\>[32]{}\Conid{\Conid{S}.Term}\;\Conid{Cont}\mbox{\onelinecomment  where Term is a value}{}\<[E]%
	\\
	\>[12]{}\mid {}\<[12E]%
	\>[15]{}\Conid{Arg}\;{}\<[32]%
	\>[32]{}\Conid{\Conid{S}.Term}\;\Conid{Cont}{}\<[E]%
	\\
	\>[12]{}\mid {}\<[12E]%
	\>[15]{}\Conid{If}\;{}\<[32]%
	\>[32]{}\Conid{\Conid{S}.Term}\;\Conid{\Conid{S}.Term}\;\Conid{Cont}{}\<[E]%
	\\
	\>[12]{}\mid {}\<[12E]%
	\>[15]{}\Conid{Fix}\;{}\<[32]%
	\>[32]{}\Conid{Cont}{}\<[E]%
	\\
	\>[12]{}\mid {}\<[12E]%
	\>[15]{}\Conid{Let}\;{}\<[32]%
	\>[32]{}\Conid{\Conid{S}.Var}\;\Conid{\Conid{S}.Term}\;\Conid{Cont}{}\<[E]%
	\\
	\>[12]{}\mid {}\<[12E]%
	\>[15]{}\Conid{Plus1}\;{}\<[32]%
	\>[32]{}\Conid{\Conid{S}.Term}\;\Conid{Cont}{}\<[E]%
	\\
	\>[12]{}\mid {}\<[12E]%
	\>[15]{}\Conid{Plus2}\;{}\<[32]%
	\>[32]{}\Conid{\Conid{S}.Term}\;\Conid{Cont}{}\<[E]%
	\\
	\>[12]{}\mid {}\<[12E]%
	\>[15]{}\Conid{Minus1}\;{}\<[32]%
	\>[32]{}\Conid{\Conid{S}.Term}\;\Conid{Cont}{}\<[E]%
	\\
	\>[12]{}\mid {}\<[12E]%
	\>[15]{}\Conid{Minus2}\;{}\<[32]%
	\>[32]{}\Conid{\Conid{S}.Term}\;\Conid{Cont}{}\<[E]%
	\\
	\>[12]{}\mid {}\<[12E]%
	\>[15]{}\Conid{Times1}\;{}\<[32]%
	\>[32]{}\Conid{\Conid{S}.Term}\;\Conid{Cont}{}\<[E]%
	\\
	\>[12]{}\mid {}\<[12E]%
	\>[15]{}\Conid{Times2}\;{}\<[32]%
	\>[32]{}\Conid{\Conid{S}.Term}\;\Conid{Cont}{}\<[E]%
	\\
	\>[12]{}\mid {}\<[12E]%
	\>[15]{}\Conid{Div1}\;{}\<[32]%
	\>[32]{}\Conid{\Conid{S}.Term}\;\Conid{Cont}{}\<[E]%
	\\
	\>[12]{}\mid {}\<[12E]%
	\>[15]{}\Conid{Div2}\;{}\<[32]%
	\>[32]{}\Conid{\Conid{S}.Term}\;\Conid{Cont}{}\<[E]%
	\\
	\>[12]{}\mid {}\<[12E]%
	\>[15]{}\Conid{Nand1}\;{}\<[32]%
	\>[32]{}\Conid{\Conid{S}.Term}\;\Conid{Cont}{}\<[E]%
	\\
	\>[12]{}\mid {}\<[12E]%
	\>[15]{}\Conid{Nand2}\;{}\<[32]%
	\>[32]{}\Conid{\Conid{S}.Term}\;\Conid{Cont}{}\<[E]%
	\\
	\>[12]{}\mid {}\<[12E]%
	\>[15]{}\Conid{Eq1}\;{}\<[32]%
	\>[32]{}\Conid{\Conid{S}.Term}\;\Conid{Cont}{}\<[E]%
	\\
	\>[12]{}\mid {}\<[12E]%
	\>[15]{}\Conid{Eq2}\;{}\<[32]%
	\>[32]{}\Conid{\Conid{S}.Term}\;\Conid{Cont}{}\<[E]%
	\\
	\>[12]{}\mid {}\<[12E]%
	\>[15]{}\Conid{Lt1}\;{}\<[32]%
	\>[32]{}\Conid{\Conid{S}.Term}\;\Conid{Cont}{}\<[E]%
	\\
	\>[12]{}\mid {}\<[12E]%
	\>[15]{}\Conid{Lt2}\;{}\<[32]%
	\>[32]{}\Conid{\Conid{S}.Term}\;\Conid{Cont}{}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\Varid{ckMachineStep}\mathbin{::}(\Conid{\Conid{S}.Term},\Conid{Cont})\to \Conid{Maybe}\;(\Conid{\Conid{S}.Term},\Conid{Cont}){}\<[E]%
	\\
	\>[B]{}\Varid{ckMachineStep}\;(\Varid{t},\Varid{k})\mathrel{=}\mathbf{case}\;\Varid{t}\;\mathbf{of}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.App}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[24]%
	\>[24]{}\to \Conid{Just}\;(\Varid{t}_{1},\Conid{Arg}\;\Varid{t}_{2}\;\Varid{k}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.If}\;\Varid{t}_{1}\;\Varid{t}_{2}\;\Varid{t}_{3}{}\<[24]%
	\>[24]{}\to \Conid{Just}\;(\Varid{t}_{1},\Conid{If}\;\Varid{t}_{2}\;\Varid{t}_{3}\;\Varid{k}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.Fix}\;\Varid{t}_{1}{}\<[24]%
	\>[24]{}\to \Conid{Just}\;(\Varid{t}_{1},\Conid{Fix}\;\Varid{k}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.Let}\;\Varid{x}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[24]%
	\>[24]{}\to \Conid{Just}\;(\Varid{t}_{1},\Conid{Let}\;\Varid{x}\;\Varid{t}_{2}\;\Varid{k}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.IntAdd}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[24]%
	\>[24]{}\to \Conid{Just}\;(\Varid{t}_{1},\Conid{Plus1}\;\Varid{t}_{2}\;\Varid{k}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.IntSub}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[24]%
	\>[24]{}\to \Conid{Just}\;(\Varid{t}_{1},\Conid{Minus1}\;\Varid{t}_{2}\;\Varid{k}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.IntMul}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[24]%
	\>[24]{}\to \Conid{Just}\;(\Varid{t}_{1},\Conid{Times1}\;\Varid{t}_{2}\;\Varid{k}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.IntDiv}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[24]%
	\>[24]{}\to \Conid{Just}\;(\Varid{t}_{1},\Conid{Div1}\;\Varid{t}_{2}\;\Varid{k}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.IntNand}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[24]%
	\>[24]{}\to \Conid{Just}\;(\Varid{t}_{1},\Conid{Nand1}\;\Varid{t}_{2}\;\Varid{k}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.IntEq}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[24]%
	\>[24]{}\to \Conid{Just}\;(\Varid{t}_{1},\Conid{Eq1}\;\Varid{t}_{2}\;\Varid{k}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.IntLt}\;\Varid{t}_{1}\;\Varid{t}_{2}{}\<[24]%
	\>[24]{}\to \Conid{Just}\;(\Varid{t}_{1},\Conid{Lt1}\;\Varid{t}_{2}\;\Varid{k}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Varid{otherwise}\to \mathbf{if}\;(\Varid{\Conid{S}.isValue}\;\Varid{t})\;\mathbf{then}\;\Varid{ckContHelp}\;(\Varid{t},\Varid{k})\;\mathbf{else}\;\Conid{Nothing}{}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\Varid{ckContHelp}\mathbin{::}(\Conid{\Conid{S}.Term},\Conid{Cont})\to \Conid{Maybe}\;(\Conid{\Conid{S}.Term},\Conid{Cont}){}\<[E]%
	\\
	\>[B]{}\Varid{ckContHelp}\;(\Varid{t},\Varid{k})\mathrel{=}\mathbf{case}\;\Varid{k}\;\mathbf{of}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\varodot\to \Conid{Nothing}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{Fun}\;(\Conid{\Conid{S}.Abs}\;\Varid{x}\;\anonymous \;\Varid{t}_{12})\;\Varid{k'}{}\<[E]%
	\\
	\>[3]{}\hsindent{17}{}\<[20]%
	\>[20]{}\to \Conid{Just}\;((\Varid{\Conid{S}.subst}\;\Varid{x}\;\Varid{t}\;\Varid{t}_{12}),\Varid{k'}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{Arg}\;\Varid{t}_{2}\;\Varid{k'}{}\<[20]%
	\>[20]{}\to \Conid{Just}\;(\Varid{t}_{2},\Conid{Fun}\;\Varid{t}\;\Varid{k'}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{If}\;\Varid{t}_{2}\;\Varid{t}_{3}\;\Varid{k'}{}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\mid \Varid{t}\equiv \Conid{\Conid{S}.Tru}{}\<[20]%
	\>[20]{}\to \Conid{Just}\;(\Varid{t}_{2},\Varid{k'}){}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\mid \Varid{t}\equiv \Conid{\Conid{S}.Fls}{}\<[20]%
	\>[20]{}\to \Conid{Just}\;(\Varid{t}_{3},\Varid{k'}){}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\mid \Varid{otherwise}{}\<[20]%
	\>[20]{}\to \Conid{Nothing}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{Fix}\;\Varid{k'}{}\<[20]%
	\>[20]{}\to \Varid{fixHelper}\;(\Conid{\Conid{S}.Fix}\;\Varid{t},\Varid{k'}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{Let}\;\Varid{x}\;\Varid{t}_{2}\;\Varid{k'}{}\<[20]%
	\>[20]{}\to \Conid{Just}\;((\Varid{\Conid{S}.subst}\;\Varid{x}\;\Varid{t}\;\Varid{t}_{2}),\Varid{k'}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{Plus1}\;\Varid{t}_{2}\;\Varid{k'}{}\<[20]%
	\>[20]{}\to \Conid{Just}\;(\Varid{t}_{2},\Conid{Plus2}\;\Varid{t}\;\Varid{k'}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{Plus2}\;\Varid{v1}\;\Varid{k'}{}\<[20]%
	\>[20]{}\to \Varid{binaryOpHelp}\;((\Conid{\Conid{S}.IntAdd}\;\Varid{v1}\;\Varid{t}),\Varid{k'}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{Minus1}\;\Varid{t}_{2}\;\Varid{k'}{}\<[20]%
	\>[20]{}\to \Conid{Just}\;(\Varid{t}_{2},\Conid{Minus2}\;\Varid{t}\;\Varid{k'}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{Minus2}\;\Varid{v1}\;\Varid{k'}{}\<[20]%
	\>[20]{}\to \Varid{binaryOpHelp}\;((\Conid{\Conid{S}.IntSub}\;\Varid{v1}\;\Varid{t}),\Varid{k'}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{Times1}\;\Varid{t}_{2}\;\Varid{k'}{}\<[20]%
	\>[20]{}\to \Conid{Just}\;(\Varid{t}_{2},\Conid{Times2}\;\Varid{t}\;\Varid{k'}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{Times2}\;\Varid{v1}\;\Varid{k'}{}\<[20]%
	\>[20]{}\to \Varid{binaryOpHelp}\;((\Conid{\Conid{S}.IntMul}\;\Varid{v1}\;\Varid{t}),\Varid{k'}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{Div1}\;\Varid{t}_{2}\;\Varid{k'}{}\<[20]%
	\>[20]{}\to \Conid{Just}\;(\Varid{t}_{2},\Conid{Div2}\;\Varid{t}\;\Varid{k'}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{Div2}\;\Varid{v1}\;\Varid{k'}{}\<[20]%
	\>[20]{}\to \Varid{binaryOpHelp}\;((\Conid{\Conid{S}.IntDiv}\;\Varid{v1}\;\Varid{t}),\Varid{k'}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{Nand1}\;\Varid{t}_{2}\;\Varid{k'}{}\<[20]%
	\>[20]{}\to \Conid{Just}\;(\Varid{t}_{2},\Conid{Nand2}\;\Varid{t}\;\Varid{k'}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{Nand2}\;\Varid{v1}\;\Varid{k'}{}\<[20]%
	\>[20]{}\to \Varid{binaryOpHelp}\;((\Conid{\Conid{S}.IntNand}\;\Varid{v1}\;\Varid{t}),\Varid{k'}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{Eq1}\;\Varid{t}_{2}\;\Varid{k'}{}\<[20]%
	\>[20]{}\to \Conid{Just}\;(\Varid{t}_{2},\Conid{Eq2}\;\Varid{t}\;\Varid{k'}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{Eq2}\;\Varid{v1}\;\Varid{k'}{}\<[20]%
	\>[20]{}\to \Varid{binaryOpHelp}\;((\Conid{\Conid{S}.IntEq}\;\Varid{v1}\;\Varid{t}),\Varid{k'}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{Lt1}\;\Varid{t}_{2}\;\Varid{k'}{}\<[20]%
	\>[20]{}\to \Conid{Just}\;(\Varid{t}_{2},\Conid{Lt2}\;\Varid{t}\;\Varid{k'}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{Lt2}\;\Varid{v1}\;\Varid{k'}{}\<[20]%
	\>[20]{}\to \Varid{binaryOpHelp}\;((\Conid{\Conid{S}.IntLt}\;\Varid{v1}\;\Varid{t}),\Varid{k'}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Varid{otherwise}{}\<[20]%
	\>[20]{}\to \Conid{Nothing}{}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\Varid{fixHelper}\mathbin{::}(\Conid{\Conid{S}.Term},\Conid{Cont})\to \Conid{Maybe}\;(\Conid{\Conid{S}.Term},\Conid{Cont}){}\<[E]%
	\\
	\>[B]{}\Varid{fixHelper}\;(\Varid{t}\mathord{@}(\Conid{\Conid{S}.Fix}\;(\Conid{\Conid{S}.Abs}\;\Varid{x}\;\Varid{y}\;\Varid{t}_{1})),\Varid{k})\mathrel{=}\Conid{Just}\;((\Varid{\Conid{S}.subst}\;\Varid{x}\;\Varid{t}\;\Varid{t}_{1}),\Varid{k}){}\<[E]%
	\\
	\>[B]{}\Varid{fixHelper}\;(\anonymous ,\Varid{k}){}\<[41]%
	\>[41]{}\mathrel{=}\Conid{Nothing}{}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\Varid{binaryOpHelp}\mathbin{::}(\Conid{\Conid{S}.Term},\Conid{Cont})\to \Conid{Maybe}\;(\Conid{\Conid{S}.Term},\Conid{Cont}){}\<[E]%
	\\
	\>[B]{}\Varid{binaryOpHelp}\;(\Varid{t},\Varid{k})\mathrel{=}\mathbf{case}\;\Varid{t}\;\mathbf{of}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.IntAdd}\;(\Conid{\Conid{S}.IntConst}\;\Varid{t}_{1})\;(\Conid{\Conid{S}.IntConst}\;\Varid{t}_{2}){}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\to \Conid{Just}\;(\Conid{\Conid{S}.IntConst}\;(\Varid{\Conid{I}.intAdd}\;\Varid{t}_{1}\;\Varid{t}_{2}),\Varid{k}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.IntSub}\;(\Conid{\Conid{S}.IntConst}\;\Varid{t}_{1})\;(\Conid{\Conid{S}.IntConst}\;\Varid{t}_{2}){}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\to \Conid{Just}\;(\Conid{\Conid{S}.IntConst}\;(\Varid{\Conid{I}.intSub}\;\Varid{t}_{1}\;\Varid{t}_{2}),\Varid{k}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.IntMul}\;(\Conid{\Conid{S}.IntConst}\;\Varid{t}_{1})\;(\Conid{\Conid{S}.IntConst}\;\Varid{t}_{2}){}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\to \Conid{Just}\;(\Conid{\Conid{S}.IntConst}\;(\Varid{\Conid{I}.intMul}\;\Varid{t}_{1}\;\Varid{t}_{2}),\Varid{k}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.IntDiv}\;(\Conid{\Conid{S}.IntConst}\;\Varid{t}_{1})\;(\Conid{\Conid{S}.IntConst}\;\Varid{t}_{2}){}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\to \Conid{Just}\;(\Conid{\Conid{S}.IntConst}\;(\Varid{\Conid{I}.intDiv}\;\Varid{t}_{1}\;\Varid{t}_{2}),\Varid{k}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.IntNand}\;(\Conid{\Conid{S}.IntConst}\;\Varid{t}_{1})\;(\Conid{\Conid{S}.IntConst}\;\Varid{t}_{2}){}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\to \Conid{Just}\;(\Conid{\Conid{S}.IntConst}\;(\Varid{\Conid{I}.intNand}\;\Varid{t}_{1}\;\Varid{t}_{2}),\Varid{k}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.IntEq}\;(\Conid{\Conid{S}.IntConst}\;\Varid{t}_{1})\;(\Conid{\Conid{S}.IntConst}\;\Varid{t}_{2}){}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\to \Conid{Just}\;((\mathbf{if}\;(\Varid{\Conid{I}.intEq}\;\Varid{t}_{1}\;\Varid{t}_{2})\;\mathbf{then}\;\Conid{\Conid{S}.Tru}\;\mathbf{else}\;\Conid{\Conid{S}.Fls}),\Varid{k}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.IntLt}\;(\Conid{\Conid{S}.IntConst}\;\Varid{t}_{1})\;(\Conid{\Conid{S}.IntConst}\;\Varid{t}_{2}){}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\to \Conid{Just}\;((\mathbf{if}\;(\Varid{\Conid{I}.intLt}\;\Varid{t}_{1}\;\Varid{t}_{2})\;\mathbf{then}\;\Conid{\Conid{S}.Tru}\;\mathbf{else}\;\Conid{\Conid{S}.Fls}),\Varid{k}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Varid{otherwise}{}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\to \Conid{Nothing}{}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\Varid{ckMachineEvalHelp}\mathbin{::}(\Conid{\Conid{S}.Term},\Conid{Cont})\to (\Conid{\Conid{S}.Term},\Conid{Cont}){}\<[E]%
	\\
	\>[B]{}\Varid{ckMachineEvalHelp}\;(\Varid{t},\Varid{k})\mathrel{=}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\mathbf{case}\;\Varid{ckMachineStep}\;(\Varid{t},\Varid{k})\;\mathbf{of}{}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\Conid{Just}\;\Varid{t'}\to \Varid{ckMachineEvalHelp}\;\Varid{t'}{}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\Conid{Nothing}\to (\Varid{t},\Varid{k}){}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\Varid{ckMachineEval}\mathbin{::}\Conid{\Conid{S}.Term}\to \Conid{\Conid{S}.Term}{}\<[E]%
	\\
	\>[B]{}\Varid{ckMachineEval}\;\Varid{t}\mathrel{=}\Varid{fst}\;(\Varid{ckMachineEvalHelp}\;(\Varid{t},\varodot)){}\<[E]%
	\ColumnHook
\end{hscode}\resethooks

\horrule{0.5pt} \\[0.2cm]


\subsubsection{CEKMachine}

\noindent The CEKMachine builds upon the CKMachine by adding closure and environment this allows for variables to be updated as the terms are being reduced rather than calling a recursive substitution function.  The environment fuctions as a lookup table that is only called when a value is required for a variable.

\begin{hscode}\SaveRestoreHook
	\column{B}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{3}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{5}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{6}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{12}{@{}>{\hspre}c<{\hspost}@{}}%
	\column{12E}{@{}l@{}}%
	\column{15}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{16}{@{}>{\hspre}c<{\hspost}@{}}%
	\column{16E}{@{}l@{}}%
	\column{19}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{23}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{27}{@{}>{\hspre}c<{\hspost}@{}}%
	\column{27E}{@{}l@{}}%
	\column{32}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{34}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{35}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{37}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{41}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{46}{@{}>{\hspre}l<{\hspost}@{}}%
	\column{E}{@{}>{\hspre}l<{\hspost}@{}}%
	\>[B]{}\mathbf{module}\;\Conid{CEKMachine}\;\mathbf{where}{}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\mathbf{import}\;\Varid{qualified}\;\Conid{AbstractSyntax}\;\Varid{as}\;\Conid{S}{}\<[E]%
	\\
	\>[B]{}\mathbf{import}\;\Varid{qualified}\;\Conid{IntegerArithmetic}\;\Varid{as}\;\Conid{I}{}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\mathbf{newtype}\;\Conid{Closure}\mathrel{=}\Conid{Cls}\;(\Conid{\Conid{S}.Term},\Conid{Environment}){}\<[E]%
	\\
	\>[B]{}\hsindent{19}{}\<[19]%
	\>[19]{}\mathbf{deriving}\;\Conid{Show}{}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\mathbf{newtype}\;\Conid{Environment}\mathrel{=}\Conid{Env}\;[\mskip1.5mu (\Conid{\Conid{S}.Var},\Conid{Closure})\mskip1.5mu]{}\<[E]%
	\\
	\>[B]{}\hsindent{23}{}\<[23]%
	\>[23]{}\mathbf{deriving}\;\Conid{Show}{}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\Varid{emptyEnv}\mathbin{::}\Conid{Environment}{}\<[E]%
	\\
	\>[B]{}\Varid{emptyEnv}\mathrel{=}\Conid{Env}\;[\mskip1.5mu \mskip1.5mu]{}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\Varid{lookupEnv}\mathbin{::}\Conid{Environment}\to \Conid{\Conid{S}.Var}\to \Conid{Closure}{}\<[E]%
	\\
	\>[B]{}\Varid{lookupEnv}\;(\Varid{e}\mathord{@}(\Conid{Env}\;[\mskip1.5mu \mskip1.5mu]))\;\Varid{x}{}\<[27]%
	\>[27]{}\mathrel{=}{}\<[27E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Varid{error}\;(\text{\tt \char34 variable~\char34}\plus \Varid{x}\plus \text{\tt \char34 ~not~bound~in~environment~\char34}\plus \Varid{show}\;\Varid{e}){}\<[E]%
	\\
	\>[B]{}\Varid{lookupEnv}\;(\Conid{Env}\;((\Varid{v},\Varid{c})\mathbin{:}\Varid{t}))\;\Varid{x}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\mid \Varid{x}\equiv \Varid{v}{}\<[16]%
	\>[16]{}\mathrel{=}{}\<[16E]%
	\>[19]{}\Varid{c}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\mid \Varid{otherwise}{}\<[16]%
	\>[16]{}\mathrel{=}{}\<[16E]%
	\>[19]{}\Varid{lookupEnv}\;(\Conid{Env}\;\Varid{t})\;\Varid{x}{}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\mathbf{data}\;\Conid{Cont}{}\<[12]%
	\>[12]{}\mathrel{=}{}\<[12E]%
	\>[15]{}\varodot{}\<[E]%
	\\
	\>[12]{}\mid {}\<[12E]%
	\>[15]{}\Conid{Fun}\;{}\<[34]%
	\>[34]{}\Conid{Closure}\;\Conid{Cont}\mbox{\onelinecomment  where Closure is a value}{}\<[E]%
	\\
	\>[12]{}\mid {}\<[12E]%
	\>[15]{}\Conid{Arg}\;{}\<[34]%
	\>[34]{}\Conid{Closure}\;\Conid{Cont}{}\<[E]%
	\\
	\>[12]{}\mid {}\<[12E]%
	\>[15]{}\Conid{If}\;{}\<[34]%
	\>[34]{}\Conid{Closure}\;\Conid{Closure}\;\Conid{Cont}\mbox{\onelinecomment  lazy }{}\<[E]%
	\\
	\>[12]{}\mid {}\<[12E]%
	\>[15]{}\Conid{Fix}\;{}\<[34]%
	\>[34]{}\Conid{Cont}{}\<[E]%
	\\
	\>[12]{}\mid {}\<[12E]%
	\>[15]{}\Conid{Let}\;{}\<[34]%
	\>[34]{}\Conid{\Conid{S}.Var}\;\Conid{Closure}\;\Conid{Cont}{}\<[E]%
	\\
	\>[12]{}\mid {}\<[12E]%
	\>[15]{}\Conid{Plus1}\;{}\<[34]%
	\>[34]{}\Conid{Closure}\;\Conid{Cont}{}\<[E]%
	\\
	\>[12]{}\mid {}\<[12E]%
	\>[15]{}\Conid{Plus2}\;{}\<[34]%
	\>[34]{}\Conid{Closure}\;\Conid{Cont}{}\<[E]%
	\\
	\>[12]{}\mid {}\<[12E]%
	\>[15]{}\Conid{Minus1}\;{}\<[34]%
	\>[34]{}\Conid{Closure}\;\Conid{Cont}{}\<[E]%
	\\
	\>[12]{}\mid {}\<[12E]%
	\>[15]{}\Conid{Minus2}\;{}\<[34]%
	\>[34]{}\Conid{Closure}\;\Conid{Cont}{}\<[E]%
	\\
	\>[12]{}\mid {}\<[12E]%
	\>[15]{}\Conid{Times1}\;{}\<[34]%
	\>[34]{}\Conid{Closure}\;\Conid{Cont}{}\<[E]%
	\\
	\>[12]{}\mid {}\<[12E]%
	\>[15]{}\Conid{Times2}\;{}\<[34]%
	\>[34]{}\Conid{Closure}\;\Conid{Cont}{}\<[E]%
	\\
	\>[12]{}\mid {}\<[12E]%
	\>[15]{}\Conid{Div1}\;{}\<[34]%
	\>[34]{}\Conid{Closure}\;\Conid{Cont}{}\<[E]%
	\\
	\>[12]{}\mid {}\<[12E]%
	\>[15]{}\Conid{Div2}\;{}\<[34]%
	\>[34]{}\Conid{Closure}\;\Conid{Cont}{}\<[E]%
	\\
	\>[12]{}\mid {}\<[12E]%
	\>[15]{}\Conid{Nand1}\;{}\<[34]%
	\>[34]{}\Conid{Closure}\;\Conid{Cont}{}\<[E]%
	\\
	\>[12]{}\mid {}\<[12E]%
	\>[15]{}\Conid{Nand2}\;{}\<[34]%
	\>[34]{}\Conid{Closure}\;\Conid{Cont}{}\<[E]%
	\\
	\>[12]{}\mid {}\<[12E]%
	\>[15]{}\Conid{Eq1}\;{}\<[34]%
	\>[34]{}\Conid{Closure}\;\Conid{Cont}{}\<[E]%
	\\
	\>[12]{}\mid {}\<[12E]%
	\>[15]{}\Conid{Eq2}\;{}\<[34]%
	\>[34]{}\Conid{Closure}\;\Conid{Cont}{}\<[E]%
	\\
	\>[12]{}\mid {}\<[12E]%
	\>[15]{}\Conid{Lt1}\;{}\<[34]%
	\>[34]{}\Conid{Closure}\;\Conid{Cont}{}\<[E]%
	\\
	\>[12]{}\mid {}\<[12E]%
	\>[15]{}\Conid{Lt2}\;{}\<[34]%
	\>[34]{}\Conid{Closure}\;\Conid{Cont}{}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\Varid{cekMachineStep}\mathbin{::}(\Conid{Closure},\Conid{Cont})\to \Conid{Maybe}\;(\Conid{Closure},\Conid{Cont}){}\<[E]%
	\\
	\>[B]{}\Varid{cekMachineStep}\;(\Varid{cl},\Varid{k})\mathrel{=}\mathbf{case}\;\Varid{cl}\;\mathbf{of}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{Cls}\;(\Conid{\Conid{S}.App}\;\Varid{t}_{1}\;\Varid{t}_{2},\Varid{e}){}\<[32]%
	\>[32]{}\to \Conid{Just}\;(\Conid{Cls}\;(\Varid{t}_{1},\Varid{e}),\Conid{Arg}\;(\Conid{Cls}\;(\Varid{t}_{2},\Varid{e}))\;\Varid{k}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{Cls}\;(\Conid{\Conid{S}.If}\;\Varid{t}_{1}\;\Varid{t}_{2}\;\Varid{t}_{3},\Varid{e}){}\<[32]%
	\>[32]{}\to \Conid{Just}\;(\Conid{Cls}\;(\Varid{t}_{1},\Varid{e}),{}\<[E]%
	\\
	\>[32]{}\hsindent{9}{}\<[41]%
	\>[41]{}\Conid{If}\;(\Conid{Cls}\;(\Varid{t}_{2},\Varid{e}))\;(\Conid{Cls}\;(\Varid{t}_{3},\Varid{e}))\;\Varid{k}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{Cls}\;(\Conid{\Conid{S}.Fix}\;\Varid{t}_{1},\Varid{e}){}\<[32]%
	\>[32]{}\to \Conid{Just}\;(\Conid{Cls}\;(\Varid{t}_{1},\Varid{e}),\Conid{Fix}\;\Varid{k}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{Cls}\;(\Conid{\Conid{S}.Let}\;\Varid{x}\;\Varid{t}_{1}\;\Varid{t}_{2},\Varid{e}){}\<[32]%
	\>[32]{}\to \Conid{Just}\;(\Conid{Cls}\;(\Varid{t}_{1},\Varid{e}),\Conid{Let}\;\Varid{x}\;(\Conid{Cls}\;(\Varid{t}_{2},\Varid{e}))\;\Varid{k}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{Cls}\;(\Conid{\Conid{S}.IntAdd}\;\Varid{t}_{1}\;\Varid{t}_{2},\Varid{e}){}\<[32]%
	\>[32]{}\to \Conid{Just}\;(\Conid{Cls}\;(\Varid{t}_{1},\Varid{e}),\Conid{Plus1}\;(\Conid{Cls}\;(\Varid{t}_{2},\Varid{e}))\;\Varid{k}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{Cls}\;(\Conid{\Conid{S}.IntSub}\;\Varid{t}_{1}\;\Varid{t}_{2},\Varid{e}){}\<[32]%
	\>[32]{}\to \Conid{Just}\;(\Conid{Cls}\;(\Varid{t}_{1},\Varid{e}),\Conid{Minus1}\;(\Conid{Cls}\;(\Varid{t}_{2},\Varid{e}))\;\Varid{k}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{Cls}\;(\Conid{\Conid{S}.IntMul}\;\Varid{t}_{1}\;\Varid{t}_{2},\Varid{e}){}\<[32]%
	\>[32]{}\to \Conid{Just}\;(\Conid{Cls}\;(\Varid{t}_{1},\Varid{e}),\Conid{Times1}\;(\Conid{Cls}\;(\Varid{t}_{2},\Varid{e}))\;\Varid{k}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{Cls}\;(\Conid{\Conid{S}.IntDiv}\;\Varid{t}_{1}\;\Varid{t}_{2},\Varid{e}){}\<[32]%
	\>[32]{}\to \Conid{Just}\;(\Conid{Cls}\;(\Varid{t}_{1},\Varid{e}),\Conid{Div1}\;(\Conid{Cls}\;(\Varid{t}_{2},\Varid{e}))\;\Varid{k}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{Cls}\;(\Conid{\Conid{S}.IntNand}\;\Varid{t}_{1}\;\Varid{t}_{2},\Varid{e}){}\<[32]%
	\>[32]{}\to \Conid{Just}\;(\Conid{Cls}\;(\Varid{t}_{1},\Varid{e}),\Conid{Nand1}\;(\Conid{Cls}\;(\Varid{t}_{2},\Varid{e}))\;\Varid{k}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{Cls}\;(\Conid{\Conid{S}.IntEq}\;\Varid{t}_{1}\;\Varid{t}_{2},\Varid{e}){}\<[32]%
	\>[32]{}\to \Conid{Just}\;(\Conid{Cls}\;(\Varid{t}_{1},\Varid{e}),\Conid{Eq1}\;(\Conid{Cls}\;(\Varid{t}_{2},\Varid{e}))\;\Varid{k}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{Cls}\;(\Conid{\Conid{S}.IntLt}\;\Varid{t}_{1}\;\Varid{t}_{2},\Varid{e}){}\<[32]%
	\>[32]{}\to \Conid{Just}\;(\Conid{Cls}\;(\Varid{t}_{1},\Varid{e}),\Conid{Lt1}\;(\Conid{Cls}\;(\Varid{t}_{2},\Varid{e}))\;\Varid{k}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{Cls}\;(\Conid{\Conid{S}.Var}\;\Varid{x},\Varid{e}){}\<[32]%
	\>[32]{}\to \Conid{Just}\;(\Varid{lookupEnv}\;\Varid{e}\;\Varid{x},\Varid{k}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{Cls}\;(\Varid{t},\Varid{e}){}\<[32]%
	\>[32]{}\to \mathbf{if}\;(\Varid{\Conid{S}.isValue}\;\Varid{t})\;\mathbf{then}\;\Varid{cekHelper}\;(\Varid{cl},\Varid{k}){}\<[E]%
	\\
	\>[32]{}\hsindent{3}{}\<[35]%
	\>[35]{}\mathbf{else}\;\Conid{Nothing}{}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\Varid{cekHelper}\mathbin{::}(\Conid{Closure},\Conid{Cont})\to \Conid{Maybe}\;(\Conid{Closure},\Conid{Cont}){}\<[E]%
	\\
	\>[B]{}\Varid{cekHelper}\;(\Varid{cl}\mathord{@}(\Conid{Cls}\;(\Varid{t},\Varid{e})),\Varid{k})\mathrel{=}\mathbf{case}\;\Varid{k}\;\mathbf{of}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\varodot{}\<[37]%
	\>[37]{}\to \Conid{Nothing}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{Fun}\;(\Conid{Cls}\;((\Conid{\Conid{S}.Abs}\;\Varid{x}\;\anonymous \;\Varid{t}_{12}),(\Conid{Env}\;\Varid{e'})))\;\Varid{k'}{}\<[E]%
	\\
	\>[3]{}\hsindent{34}{}\<[37]%
	\>[37]{}\to \Conid{Just}\;(\Conid{Cls}\;(\Varid{t}_{12},\Conid{Env}\;((\Varid{x},\Varid{cl})\mathbin{:}\Varid{e'})),\Varid{k'}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{Arg}\;(\Conid{Cls}\;(\Varid{t}_{2},\Varid{e'}))\;\Varid{k'}{}\<[37]%
	\>[37]{}\to \Conid{Just}\;(\Conid{Cls}\;(\Varid{t}_{2},\Varid{e'}),\Conid{Fun}\;\Varid{cl}\;\Varid{k'}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{If}\;(\Conid{Cls}\;(\Varid{t}_{2},\Varid{e1}))\;(\Conid{Cls}\;(\Varid{t}_{3},\Varid{e2}))\;\Varid{k'}{}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\mid \Varid{t}\equiv \Conid{\Conid{S}.Tru}{}\<[37]%
	\>[37]{}\to \Conid{Just}\;(\Conid{Cls}\;(\Varid{t}_{2},\Varid{e1}),\Varid{k'}){}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\mid \Varid{t}\equiv \Conid{\Conid{S}.Fls}{}\<[37]%
	\>[37]{}\to \Conid{Just}\;(\Conid{Cls}\;(\Varid{t}_{3},\Varid{e2}),\Varid{k'}){}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\mid \Varid{otherwise}{}\<[37]%
	\>[37]{}\to \Conid{Nothing}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{Fix}\;\Varid{k'}{}\<[37]%
	\>[37]{}\to \Varid{fixHelper}\;(\Conid{Cls}\;(\Conid{\Conid{S}.Fix}\;\Varid{t},\Varid{e}),\Varid{k'}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{Let}\;\Varid{x}\;(\Conid{Cls}\;(\Varid{t}_{2},(\Conid{Env}\;\Varid{e'})))\;\Varid{k'}{}\<[37]%
	\>[37]{}\to \Conid{Just}\;(\Conid{Cls}\;(\Varid{t}_{2},\Conid{Env}\;((\Varid{x},\Varid{cl})\mathbin{:}\Varid{e'})),\Varid{k'}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{Plus1}\;(\Conid{Cls}\;(\Varid{t}_{2},\Varid{e'}))\;\Varid{k'}{}\<[37]%
	\>[37]{}\to \Conid{Just}\;(\Conid{Cls}\;(\Varid{t}_{2},\Varid{e'}),\Conid{Plus2}\;\Varid{cl}\;\Varid{k'}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{Plus2}\;(\Conid{Cls}\;(\Varid{v1},\Varid{e'}))\;\Varid{k'}{}\<[37]%
	\>[37]{}\to \Varid{biOpHelp}\;(\Conid{Cls}\;((\Conid{\Conid{S}.IntAdd}\;\Varid{v1}\;\Varid{t}),\Varid{e'}),\Varid{k'}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{Minus1}\;(\Conid{Cls}\;(\Varid{t}_{2},\Varid{e'}))\;\Varid{k'}{}\<[37]%
	\>[37]{}\to \Conid{Just}\;(\Conid{Cls}\;(\Varid{t}_{2},\Varid{e'}),\Conid{Minus2}\;\Varid{cl}\;\Varid{k'}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{Minus2}\;(\Conid{Cls}\;(\Varid{v1},\Varid{e'}))\;\Varid{k'}{}\<[37]%
	\>[37]{}\to \Varid{biOpHelp}\;(\Conid{Cls}\;((\Conid{\Conid{S}.IntSub}\;\Varid{v1}\;\Varid{t}),\Varid{e'}),\Varid{k'}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{Times1}\;(\Conid{Cls}\;(\Varid{t}_{2},\Varid{e'}))\;\Varid{k'}{}\<[37]%
	\>[37]{}\to \Conid{Just}\;(\Conid{Cls}\;(\Varid{t}_{2},\Varid{e'}),\Conid{Times2}\;\Varid{cl}\;\Varid{k'}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{Times2}\;(\Conid{Cls}\;(\Varid{v1},\Varid{e'}))\;\Varid{k'}{}\<[37]%
	\>[37]{}\to \Varid{biOpHelp}\;(\Conid{Cls}\;((\Conid{\Conid{S}.IntMul}\;\Varid{v1}\;\Varid{t}),\Varid{e'}),\Varid{k'}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{Div1}\;(\Conid{Cls}\;(\Varid{t}_{2},\Varid{e'}))\;\Varid{k'}{}\<[37]%
	\>[37]{}\to \Conid{Just}\;(\Conid{Cls}\;(\Varid{t}_{2},\Varid{e'}),\Conid{Div2}\;\Varid{cl}\;\Varid{k'}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{Div2}\;(\Conid{Cls}\;(\Varid{v1},\Varid{e'}))\;\Varid{k'}{}\<[37]%
	\>[37]{}\to \Varid{biOpHelp}\;(\Conid{Cls}\;((\Conid{\Conid{S}.IntDiv}\;\Varid{v1}\;\Varid{t}),\Varid{e'}),\Varid{k'}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{Nand1}\;(\Conid{Cls}\;(\Varid{t}_{2},\Varid{e'}))\;\Varid{k'}{}\<[37]%
	\>[37]{}\to \Conid{Just}\;(\Conid{Cls}\;(\Varid{t}_{2},\Varid{e'}),\Conid{Nand2}\;\Varid{cl}\;\Varid{k'}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{Nand2}\;(\Conid{Cls}\;(\Varid{v1},\Varid{e'}))\;\Varid{k'}{}\<[37]%
	\>[37]{}\to \Varid{biOpHelp}\;(\Conid{Cls}\;((\Conid{\Conid{S}.IntNand}\;\Varid{v1}\;\Varid{t}),\Varid{e'}),\Varid{k'}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{Eq1}\;(\Conid{Cls}\;(\Varid{t}_{2},\Varid{e'}))\;\Varid{k'}{}\<[37]%
	\>[37]{}\to \Conid{Just}\;(\Conid{Cls}\;(\Varid{t}_{2},\Varid{e'}),\Conid{Eq2}\;\Varid{cl}\;\Varid{k'}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{Eq2}\;(\Conid{Cls}\;(\Varid{v1},\Varid{e'}))\;\Varid{k'}{}\<[37]%
	\>[37]{}\to \Varid{biOpHelp}\;(\Conid{Cls}\;((\Conid{\Conid{S}.IntEq}\;\Varid{v1}\;\Varid{t}),\Varid{e'}),\Varid{k'}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{Lt1}\;(\Conid{Cls}\;(\Varid{t}_{2},\Varid{e'}))\;\Varid{k'}{}\<[37]%
	\>[37]{}\to \Conid{Just}\;(\Conid{Cls}\;(\Varid{t}_{2},\Varid{e'}),\Conid{Lt2}\;\Varid{cl}\;\Varid{k'}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{Lt2}\;(\Conid{Cls}\;(\Varid{v1},\Varid{e'}))\;\Varid{k'}{}\<[37]%
	\>[37]{}\to \Varid{biOpHelp}\;(\Conid{Cls}\;((\Conid{\Conid{S}.IntLt}\;\Varid{v1}\;\Varid{t}),\Varid{e'}),\Varid{k'}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Varid{otherwise}{}\<[37]%
	\>[37]{}\to \Conid{Nothing}{}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\Varid{fixHelper}\mathbin{::}(\Conid{Closure},\Conid{Cont})\to \Conid{Maybe}\;(\Conid{Closure},\Conid{Cont}){}\<[E]%
	\\
	\>[B]{}\Varid{fixHelper}\;(\Varid{t}\mathord{@}(\Conid{Cls}\;(\Conid{\Conid{S}.Fix}\;(\Conid{\Conid{S}.Abs}\;\Varid{x}\;\Varid{y}\;\Varid{t}_{1}),(\Conid{Env}\;\Varid{e}))),\Varid{k})\mathrel{=}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{Just}\;(\Conid{Cls}\;(\Varid{t}_{1},\Conid{Env}\;((\Varid{x},\Varid{t})\mathbin{:}\Varid{e})),\Varid{k}){}\<[E]%
	\\
	\>[B]{}\Varid{fixHelper}\;(\anonymous ,\Varid{k}){}\<[46]%
	\>[46]{}\mathrel{=}\Conid{Nothing}{}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\Varid{biOpHelp}\mathbin{::}(\Conid{Closure},\Conid{Cont})\to \Conid{Maybe}\;(\Conid{Closure},\Conid{Cont}){}\<[E]%
	\\
	\>[B]{}\Varid{biOpHelp}\;(\Conid{Cls}\;(\Varid{t},\Varid{e}),\Varid{k})\mathrel{=}\mathbf{case}\;\Varid{t}\;\mathbf{of}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.IntAdd}\;(\Conid{\Conid{S}.IntConst}\;\Varid{t}_{1})\;(\Conid{\Conid{S}.IntConst}\;\Varid{t}_{2}){}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\to \Conid{Just}\;(\Conid{Cls}\;(\Conid{\Conid{S}.IntConst}\;(\Varid{\Conid{I}.intAdd}\;\Varid{t}_{1}\;\Varid{t}_{2}),\Varid{e}),\Varid{k}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.IntSub}\;(\Conid{\Conid{S}.IntConst}\;\Varid{t}_{1})\;(\Conid{\Conid{S}.IntConst}\;\Varid{t}_{2}){}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\to \Conid{Just}\;(\Conid{Cls}\;(\Conid{\Conid{S}.IntConst}\;(\Varid{\Conid{I}.intSub}\;\Varid{t}_{1}\;\Varid{t}_{2}),\Varid{e}),\Varid{k}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.IntMul}\;(\Conid{\Conid{S}.IntConst}\;\Varid{t}_{1})\;(\Conid{\Conid{S}.IntConst}\;\Varid{t}_{2}){}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\to \Conid{Just}\;(\Conid{Cls}\;(\Conid{\Conid{S}.IntConst}\;(\Varid{\Conid{I}.intMul}\;\Varid{t}_{1}\;\Varid{t}_{2}),\Varid{e}),\Varid{k}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.IntDiv}\;(\Conid{\Conid{S}.IntConst}\;\Varid{t}_{1})\;(\Conid{\Conid{S}.IntConst}\;\Varid{t}_{2}){}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\to \Conid{Just}\;(\Conid{Cls}\;(\Conid{\Conid{S}.IntConst}\;(\Varid{\Conid{I}.intDiv}\;\Varid{t}_{1}\;\Varid{t}_{2}),\Varid{e}),\Varid{k}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.IntNand}\;(\Conid{\Conid{S}.IntConst}\;\Varid{t}_{1})\;(\Conid{\Conid{S}.IntConst}\;\Varid{t}_{2}){}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\to \Conid{Just}\;(\Conid{Cls}\;(\Conid{\Conid{S}.IntConst}\;(\Varid{\Conid{I}.intNand}\;\Varid{t}_{1}\;\Varid{t}_{2}),\Varid{e}),\Varid{k}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.IntEq}\;(\Conid{\Conid{S}.IntConst}\;\Varid{t}_{1})\;(\Conid{\Conid{S}.IntConst}\;\Varid{t}_{2}){}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\to \Conid{Just}\;((\mathbf{if}\;(\Varid{\Conid{I}.intEq}\;\Varid{t}_{1}\;\Varid{t}_{2})\;\mathbf{then}\;\Conid{Cls}\;(\Conid{\Conid{S}.Tru},\Varid{e})\;\mathbf{else}\;\Conid{Cls}\;(\Conid{\Conid{S}.Fls},\Varid{e})),\Varid{k}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Conid{\Conid{S}.IntLt}\;(\Conid{\Conid{S}.IntConst}\;\Varid{t}_{1})\;(\Conid{\Conid{S}.IntConst}\;\Varid{t}_{2}){}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\to \Conid{Just}\;((\mathbf{if}\;(\Varid{\Conid{I}.intLt}\;\Varid{t}_{1}\;\Varid{t}_{2})\;\mathbf{then}\;\Conid{Cls}\;(\Conid{\Conid{S}.Tru},\Varid{e})\;\mathbf{else}\;\Conid{Cls}\;(\Conid{\Conid{S}.Fls},\Varid{e})),\Varid{k}){}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\Varid{otherwise}{}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\to \Conid{Nothing}{}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\Varid{cekMachineEvalHelp}\mathbin{::}(\Conid{Closure},\Conid{Cont})\to (\Conid{Closure},\Conid{Cont}){}\<[E]%
	\\
	\>[B]{}\Varid{cekMachineEvalHelp}\;(\Varid{cl},\Varid{k})\mathrel{=}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\mathbf{case}\;\Varid{cekMachineStep}\;(\Varid{cl},\Varid{k})\;\mathbf{of}{}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\Conid{Just}\;\Varid{clk'}\to \Varid{cekMachineEvalHelp}\;\Varid{clk'}{}\<[E]%
	\\
	\>[3]{}\hsindent{2}{}\<[5]%
	\>[5]{}\Conid{Nothing}\to (\Varid{cl},\varodot){}\<[E]%
	\\[\blanklineskip]%
	\>[B]{}\Varid{cekMachineEval}\mathbin{::}\Conid{\Conid{S}.Term}\to \Conid{\Conid{S}.Term}{}\<[E]%
	\\
	\>[B]{}\Varid{cekMachineEval}\;\Varid{t}\mathrel{=}{}\<[E]%
	\\
	\>[B]{}\hsindent{3}{}\<[3]%
	\>[3]{}\mathbf{let}\;\Conid{Cls}\;(\Varid{t'},\Varid{k})\mathrel{=}\Varid{fst}\;(\Varid{cekMachineEvalHelp}\;(\Conid{Cls}\;(\Varid{t},\Varid{emptyEnv}),\varodot)){}\<[E]%
	\\
	\>[3]{}\hsindent{3}{}\<[6]%
	\>[6]{}\mathbf{in}\;\Varid{t'}{}\<[E]%
	\ColumnHook
\end{hscode}\resethooks

\horrule{0.5pt} \\[0.2cm]


\section*{Test Cases}

\horrule{1pt} \\[0.2cm]	

\subsubsection*{Test Case 1:}

\begin{lstlisting}
---Input:---
let
	iseven =
		let
			mod = abs (m:Int. abs (n:Int. -(m,*(n,/(m,n)))))
		in
			abs (k:Int. =(0, app(app(mod,k),2)))
		end
in
	app (iseven, 7)
end

---Term:---
let iseven = let mod = abs(m:Int.abs(n:Int.-(m,*(n,/(m,n)))))
in abs(k:Int.=(0,app(app(mod,k),2))) end in app(iseven,7) end

---Type:---
Bool

---Structural Semanitcs - Normal form:---
false
---Natural Semanitcs - Normal form:---
false
---Reduction Semantics - Normal form:---
false
---CCMachine - Normal form:---
false
---SCCMachine - Normal form:---
false
---CKMachine - Normal form:---
false
---CEKMachine - Normal form:---
false
\end{lstlisting}

\horrule{0.5pt} \\[0.2cm]	

\subsubsection*{Test Case 2:}

\begin{lstlisting}
---Input:---
app (fix (abs (ie:->(Int,Bool). abs (x:Int. if =(0,x) then true else
if =(0, -(x,1)) then false else app (ie, -(x,2)) fi fi))), 7)

---Term:---
app(fix abs(ie:->(Int,Bool).abs(x:Int.if =(0,x) then true else if
 =(0,-(x,1)) then false else app(ie,-(x,2)) fi fi)),7)

---Type:---
Bool

---Structural Semanitcs - Normal form:---
false
---Natural Semanitcs - Normal form:---
false
---Reduction Semantics - Normal form:---
false
---CCMachine - Normal form:---
false
---SCCMachine - Normal form:---
false
---CKMachine - Normal form:---
false
---CEKMachine - Normal form:---
false
\end{lstlisting}

\horrule{0.5pt} \\[0.2cm]	

\subsubsection*{Test Case 3:}

\begin{lstlisting}
---Input:---
app (app (fix (abs (e:->(Int,->(Int,Int)). abs (x:Int. abs (y: Int.
if =(0,y) then 1 else *(x,app(app(e,x),-(y,1))) fi)))), 2), 3)

---Term:---
app(app(fix abs(e:->(Int,->(Int,Int)).abs(x:Int.abs(y:Int.if =(0,y)
then 1 else *(x,app(app(e,x),-(y,1))) fi))),2),3)

---Type:---
Int

---Structural Semanitcs - Normal form:---
8
---Natural Semanitcs - Normal form:---
8
---Reduction Semantics - Normal form:---
8
---CCMachine - Normal form:---
8
---SCCMachine - Normal form:---
8
---CKMachine - Normal form:---
8
---CEKMachine - Normal form:---
8
\end{lstlisting}

\horrule{0.5pt} \\[0.2cm]	

\subsubsection*{Test Case 4:}

\begin{lstlisting}
---Input:---
app (fix (abs (f:->(Int,Int). abs (x: Int. if =(0,x) then 1 else
*(x, app(f, -(x,1))) fi))), app (fix (abs (f:->(Int,Int).
abs (x: Int. if =(0,x) then 1 else *(x, app(f, -(x,1))) fi))), 3))

---Term:---
app(fix abs(f:->(Int,Int).abs(x:Int.if =(0,x) then 1 else *(x,app(f,-(x,1))) fi)),
app(fix abs(f:->(Int,Int).abs(x:Int.if =(0,x) then 1 else *(x,app(f,-(x,1))) fi)),3))

---Type:---
Int

---Structural Semanitcs - Normal form:---
720
---Natural Semanitcs - Normal form:---
720
---Reduction Semantics - Normal form:---
720
---CCMachine - Normal form:---
720
---SCCMachine - Normal form:---
720
---CKMachine - Normal form:---
720
---CEKMachine - Normal form:---
720
\end{lstlisting}

\horrule{0.5pt} \\[0.2cm]	

\subsubsection*{Test Case 5:}

\begin{lstlisting}
let
	iseven = fix (abs (ie:->(Int,Bool). abs (x:Int.
		if =(0,x) then true else
		 if =(1,x) then false else
		  app (ie, -(x,2)) fi fi)))
in
	let
		collatz = fix (abs (collatz:->(Int,Int). abs (x: Int.
		 if app (iseven, x) then app (collatz, /(x,2)) else
		  if =(x,1) then 1 else
		   app (collatz, +(*(3,x),1)) fi fi)))
	in
	  app (collatz, 1000)
	end
end

---Term:---
let iseven = fix abs(ie:->(Int,Bool).abs(x:Int.if =(0,x) then true
 else if =(1,x) then false else app(ie,-(x,2)) fi fi)) in
  let collatz = fix abs(collatz:->(Int,Int).abs(x:Int.if app(iseven,x)
   then app(collatz,/(x,2)) else if =(x,1) then 1 else
    app(collatz,+(*(3,x),1)) fi fi)) in app(collatz,1000) end end

---Type:---
Int

---Structural Semanitcs - Normal form:---
1
---Natural Semanitcs - Normal form:---
1
---Reduction Semantics - Normal form:---
1
---CCMachine - Normal form:---
1
---SCCMachine - Normal form:---
1
---CKMachine - Normal form:---
1
---CEKMachine - Normal form:---
1
\end{lstlisting}

\horrule{0.5pt} \\[0.2cm]	

\end{document}
		
		



